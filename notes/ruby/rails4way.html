<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>rails4way</title>
<!-- 2017-05-02 Tue 10:43 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="your name" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

         <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Galdeano|Open+Sans:600italic,400,600|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
         <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://harrifeng.github.io/sitemap.html"> UP </a>
 |
 <a accesskey="H" href="http://harrifeng.github.io/index.html"> HOME </a>
</div><div id="preamble" class="status">

         <div id="header">
            <div id="header-top">
                <div id="blog-title">Harrifeng's Path</div>
                <div id="blog-sub-title">纸上得来终觉浅,绝知此事要Coding</div>
            </div>
            <div id="nav">
                <ul>
                    <li><a href="/">首页</a></li>
                    <li><a href="/about.html">About Me</a></li>
                    <li>
                    </li>
                </ul>
            </div>
         </div>
</div>
<div id="content">
<h1 class="title">rails4way</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Rails Enovironments and Configuration</a>
<ul>
<li><a href="#sec-1-1">Bundler</a>
<ul>
<li><a href="#sec-1-1-1">Gemfile</a>
<ul>
<li><a href="#sec-1-1-1-1">Loading Gems Directory From a Git Repository</a></li>
<li><a href="#sec-1-1-1-2">Loading Gems From the Files System</a></li>
</ul>
</li>
<li><a href="#sec-1-1-2">Installing Gems</a></li>
<li><a href="#sec-1-1-3">Gem Locking</a></li>
<li><a href="#sec-1-1-4">Packaging Gems</a></li>
</ul>
</li>
<li><a href="#sec-1-2">Startup and Application Settings</a>
<ul>
<li><a href="#sec-1-2-1">application.rb</a>
<ul>
<li><a href="#sec-1-2-1-1">Load Path Modifications</a></li>
<li><a href="#sec-1-2-1-2">Time Zones</a></li>
<li><a href="#sec-1-2-1-3">Localization</a></li>
<li><a href="#sec-1-2-1-4">Generator Default Settings</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">Initializers</a>
<ul>
<li><a href="#sec-1-2-2-1">Backtrace Silencers</a></li>
<li><a href="#sec-1-2-2-2">Filter Parameter Logging</a></li>
<li><a href="#sec-1-2-2-3">Inflections</a></li>
<li><a href="#sec-1-2-2-4">Custom MIME Types</a></li>
<li><a href="#sec-1-2-2-5">Secret Token</a></li>
<li><a href="#sec-1-2-2-6">Session Store</a></li>
<li><a href="#sec-1-2-2-7">Wrap Parameters</a></li>
</ul>
</li>
<li><a href="#sec-1-2-3">Additional Configuration</a>
<ul>
<li><a href="#sec-1-2-3-1">Log-Level Override</a></li>
<li><a href="#sec-1-2-3-2">Schema Dumper</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">Development Mode</a>
<ul>
<li><a href="#sec-1-3-1">Automatic Class Reloading</a>
<ul>
<li><a href="#sec-1-3-1-1">The Rails Class Loader</a></li>
<li><a href="#sec-1-3-1-2">Rails, Modules, and Auto-Loading Code</a></li>
</ul>
</li>
<li><a href="#sec-1-3-2">Eager Load</a></li>
<li><a href="#sec-1-3-3">Error Reports</a></li>
<li><a href="#sec-1-3-4">Caching</a></li>
<li><a href="#sec-1-3-5">Raise Delivery Errors</a></li>
<li><a href="#sec-1-3-6">Deprecation Notices</a></li>
<li><a href="#sec-1-3-7">Explain for Slow Queries</a></li>
<li><a href="#sec-1-3-8">Assets Debug Mode</a></li>
</ul>
</li>
<li><a href="#sec-1-4">Test Mode</a></li>
<li><a href="#sec-1-5">Production Mode</a>
<ul>
<li><a href="#sec-1-5-1">Assets</a></li>
<li><a href="#sec-1-5-2">Asset Hosts</a></li>
</ul>
</li>
<li><a href="#sec-1-6">Logging</a>
<ul>
<li><a href="#sec-1-6-1">Rails Log Files</a></li>
<li><a href="#sec-1-6-2">Tagged Logging</a></li>
<li><a href="#sec-1-6-3">Log File Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">Chapter 02: Routing</a>
<ul>
<li><a href="#sec-2-1">The Two Purposes of Routing</a></li>
<li><a href="#sec-2-2">The routes.rb File</a>
<ul>
<li><a href="#sec-2-2-1">Regular Routes</a></li>
<li><a href="#sec-2-2-2">Constraining Request Methods</a></li>
<li><a href="#sec-2-2-3">URL Patterns</a></li>
<li><a href="#sec-2-2-4">Segment Keys</a></li>
<li><a href="#sec-2-2-5">Spotlight on the :id Field</a></li>
<li><a href="#sec-2-2-6">Optional Segment Keys</a></li>
<li><a href="#sec-2-2-7">Redirect Routes</a></li>
<li><a href="#sec-2-2-8">The Format Segment</a></li>
<li><a href="#sec-2-2-9">Routes as Rack Endpoints</a></li>
<li><a href="#sec-2-2-10">Accept Header</a></li>
<li><a href="#sec-2-2-11">Segment Key Constraints</a></li>
<li><a href="#sec-2-2-12">The Root Route</a></li>
</ul>
</li>
<li><a href="#sec-2-3">Route Globbing</a></li>
<li><a href="#sec-2-4">Named Routes</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Rails Enovironments and Configuration</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>rails application拥有三个标准的mode: development, test, production. 不同mode
会有不同的设置
</li>
<li>除了三个不同的标准的mode外,你还可以设计自己的mode,所有的mode都会在config/environments
文件夹里面存储
</li>
<li>rails是通过环境变量(RAILS_ENV)来设置当前处于什么mode的.
</li>
</ul>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Bundler</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>Bundler是一个来帮助管理gem, 和gem 相互依赖关系的软件.
</li>
<li>在Rails里面gem的版本控制是比较宽泛的,比如可以要求是大于2.3.14的所有版本(&gt;= 2.3.14),
而bundler的作用,就是综合所有其他的版本要求,最终确定一个"准确的版本数字"
</li>
</ul>
</div>
<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">Gemfile</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>Rails application的根目录下面有一个文件叫做Gemfile, 它的列出了所有gem的版本,
起到了一个"载物清单"的作用.
</li>
<li>最近简单的用法是,只有gem和软件版本
<div class="org-src-container">

<pre class="src src-ruby">gem <span style="color: #2aa198;">'kaminari'</span>
gem <span style="color: #2aa198;">'nokogiri'</span>
</pre>
</div>
</li>
<li>我们还可以根据不同的版本来load不同的gem
<div class="org-src-container">

<pre class="src src-ruby">group <span style="color: #268bd2; font-weight: bold;">:development</span> <span style="color: #859900; font-weight: bold;">do</span>
  gem <span style="color: #2aa198;">'pry-rails'</span>
<span style="color: #859900; font-weight: bold;">end</span>

group <span style="color: #268bd2; font-weight: bold;">:test</span> <span style="color: #859900; font-weight: bold;">do</span>
  gem <span style="color: #2aa198;">'capybara'</span>
  gem <span style="color: #2aa198;">'database_cleaner'</span>
<span style="color: #859900; font-weight: bold;">end</span>

group <span style="color: #268bd2; font-weight: bold;">:development</span>, <span style="color: #268bd2; font-weight: bold;">:test</span> <span style="color: #859900; font-weight: bold;">do</span>
  gem <span style="color: #2aa198;">'rspec-rails'</span>
  gem <span style="color: #2aa198;">'factory_girl_rails'</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>gem指定的软件,如果不写版本的话,那么是默认的"最新stable版本". 如果要指定版本
那么要写出来
<div class="org-src-container">

<pre class="src src-ruby">gem <span style="color: #2aa198;">'nokogiri'</span> <span style="color: #2aa198;">'1.5.6'</span>
gem <span style="color: #2aa198;">'pry-rails'</span>, <span style="color: #2aa198;">'&gt; 0.2.2'</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Start from 2.0, no less than 2.0.1</span>
gem <span style="color: #2aa198;">'decent_exposure'</span>, <span style="color: #2aa198;">'~&gt; 2.0.1'</span>
gem <span style="color: #2aa198;">'draper'</span>, <span style="color: #2aa198;">'1.0.0beta6'</span>
</pre>
</div>
</li>
<li>有的时候如果require指定的名字和库本身的名字不同的话,要require:一下
<div class="org-src-container">

<pre class="src src-ruby">gem <span style="color: #2aa198;">'webmock'</span>, <span style="color: #657b83; font-weight: bold;">require</span>: <span style="color: #2aa198;">'webmock/rspec'</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-1-1-1-1" class="outline-5">
<h5 id="sec-1-1-1-1">Loading Gems Directory From a Git Repository</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<ul class="org-ul">
<li>还可以选择一个git的gem
<div class="org-src-container">

<pre class="src src-ruby">gem <span style="color: #2aa198;">'carrierwave'</span>, <span style="color: #268bd2; font-weight: bold;">git:</span> <span style="color: #2aa198;">'git@github.com:jnicklas/carrierwave.git'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-1-2" class="outline-5">
<h5 id="sec-1-1-1-2">Loading Gems From the Files System</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<ul class="org-ul">
<li>从文件系统load gem
<div class="org-src-container">

<pre class="src src-ruby">gem <span style="color: #2aa198;">'nokogiri'</span>, <span style="color: #268bd2; font-weight: bold;">path:</span> <span style="color: #2aa198;">'~/code/nokogiri'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2">Installing Gems</h4>
<div class="outline-text-4" id="text-1-1-2">
<ul class="org-ul">
<li>每当你更改了Gemfile的时候,或者你引入了新的dependency的时候,bundle install
是安装dependency的必要步骤
</li>
<li>bundle install会安装能够"和平共处"的最新版本的dependency
</li>
<li>你可以使用&#x2013;without option来选择性安装
<div class="org-src-container">

<pre class="src src-sh">$ bundle install --without development test
$ bundle install --without test
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3">Gem Locking</h4>
<div class="outline-text-4" id="text-1-1-3">
<ul class="org-ul">
<li>每当你install(或者update)的时候, Bundler都会把你们的依赖关系计算一下,然后
保存在一个叫做Gemfile.lock的文件里面.所以Gemfile.lock里面是精确的版本信息
</li>
<li>不要忘记Gemfile.lock,把它加入到git保存的列表里面.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4">Packaging Gems</h4>
<div class="outline-text-4" id="text-1-1-4">
<ul class="org-ul">
<li>你可以使用package命令来把所有的gem存放在你的rails 应用的vender/cache文件夹
里面.
</li>
<li>这很重要,因为你bundle package了以后,会在vender/cache 文件夹里面把你
所有的正在使用的gem都存在这里. 以后你在其他地方使用的时候, 加上 &#x2013;local,就不
会从rubygems.org下载了! 稳定的安全的gem很重要!
<div class="org-src-container">

<pre class="src src-sh">$ bundle package
</pre>
</div>
</li>
<li>在使用"非rails"指定的命令的时候,一定要在命令前面加"bundle exec",比如
<div class="org-src-container">

<pre class="src src-sh">$ bundle exec guard
</pre>
</div>
</li>
<li>这么做的"深层次"的原因, 是ruby的多版本的存在: 运行一次bundle exec some:task
确保你的some:task, 一定是在确保当前的bundle环境OK的情况下(如果有Gemfile的话,
bundle 会运行), 再去运行some:task
<a href="http://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean">http://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean</a>
</li>
<li>bundle 的参数&#x2013;binstubs 会生成RAILS_ROOT 下面的/bin文件,然后把所有可用的二进制
程序加上一个环境设置,写成ruby script方进去#TODO#
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Startup and Application Settings</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>每当我们启动Rails来处理request的时候,最先开始发生的事情就是config/boot.rb被
加载, 其实总共有三个文件被加载:
<ul class="org-ul">
<li>boot.rb来设置Bundler和load path
</li>
<li>application.rb来读取gem (可能会根据Rail.env的不同,读取不同的gem)
</li>
<li>environment.rb运行所有的initializer
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">application.rb</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>application.rb首先会想到load boot.rb
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #b58900;">File</span>.expand_path<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'../boot'</span>, <span style="color: #657b83; font-weight: bold;">__FILE__</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>下一行是读取所有的module
<div class="org-src-container">

<pre class="src src-ruby">raquire <span style="color: #2aa198;">'rails/all'</span>
</pre>
</div>
</li>
<li>你也可以选择性require(当然要把rails/all注释掉)
</li>
<li>configuration的主体,其实是创建一个新的module
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Hfeng</span>
  <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Application</span> &lt; <span style="color: #b58900;">Rails</span>::<span style="color: #b58900;">Application</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Settings in config/environments/* take precedence over those specified here.</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Application configuration should go into files in config/initializers</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-- all .rb files in that directory are automatically loaded.</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1">Load Path Modifications</h5>
<div class="outline-text-5" id="text-1-2-1-1">
<ul class="org-ul">
<li>后面的注释是说你可以自己添加一些自动加载的项目
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Custom directories with classes and modules you want to be autoloadable.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config.autoload_paths += %W(#{config.root}/extras)</span>
</pre>
</div>
</li>
<li>比如我们可以加载app文件夹下面的presenters文件夹,那么就如下
<div class="org-src-container">

<pre class="src src-ruby">config.autoload_paths += <span style="color: #2aa198;">%W(</span><span style="color: #268bd2;">#{config.root}</span><span style="color: #2aa198;">/app/presenters)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2">Time Zones</h5>
<div class="outline-text-5" id="text-1-2-1-2">
<ul class="org-ul">
<li>默认市区是UTC,你当然可以更改
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Run "rake -D time" for a list of tasks for finding time zone names. Default is UTC.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config.time_zone = 'Central Time (US &amp; Canada)'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3">Localization</h5>
<div class="outline-text-5" id="text-1-2-1-3">
<ul class="org-ul">
<li>默认的locale是:en,当然你也可以覆盖
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config.i18n.default_locale = :de</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-1-4" class="outline-5">
<h5 id="sec-1-2-1-4">Generator Default Settings</h5>
<div class="outline-text-5" id="text-1-2-1-4">
<ul class="org-ul">
<li>TODO
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Initializers</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>从Rails 2开始,引入了一个把初始化文件放入不同的ruby file,然后放置到config/initializers
里面的做法.你也可以把自己的自动初始化代码,放入confi/initializers里面
</li>
</ul>
</div>
<div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1">Backtrace Silencers</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<ul class="org-ul">
<li>exception会和很多backtrace代码一块抛出, 你可以使用一些设置让他们变的短一点
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Rails</span>.backtrace_cleaner.add_silencer <span style="color: #2aa198;">{</span>|line| line =~ <span style="color: #2aa198;">/my_noisy_library/</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>你甚至可以让他们完全消失
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Rails</span>.backtrace_cleaner.remove_silencers!
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2">Filter Parameter Logging</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<ul class="org-ul">
<li>Rails默认情况下会在log里面记录request详细的信息,为了安全起见(黑客可能会从
request信息里面分析出密码), 我们要把敏感信息过滤
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Configure sensitive parameters which will be filtered from the log file</span>
<span style="color: #b58900;">Rails</span>.application.config.filter_parameters += <span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:password</span><span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3">Inflections</h5>
<div class="outline-text-5" id="text-1-2-2-3">
<ul class="org-ul">
<li>rails里面有Inflection用来"自动命名": 我们只需要输入一个"单数形式"的名字,
它负责帮我们转换成"复数". 负责帮我们把class name转化成table name.等
</li>
<li>牛逼的是,我们可以使用rails console来看看转换的结果是什么
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ rails console
Loading development environment <span style="color: #2aa198;">(</span>Rails 3.0.20<span style="color: #2aa198;">)</span>
<span style="color: #268bd2;">irb</span><span style="color: #2aa198;">(</span>main<span style="color: #2aa198;">)</span>:001:0&gt; ActiveSupport::Inflector.pluralize <span style="color: #2aa198;">"project"</span>
=&gt; <span style="color: #2aa198;">"projects"</span>
<span style="color: #268bd2;">irb</span><span style="color: #2aa198;">(</span>main<span style="color: #2aa198;">)</span>:002:0&gt; ActiveSupport::Inflector.pluralize <span style="color: #2aa198;">"virus"</span>
=&gt; <span style="color: #2aa198;">"viri"</span>
<span style="color: #268bd2;">irb</span><span style="color: #2aa198;">(</span>main<span style="color: #2aa198;">)</span>:003:0&gt; <span style="color: #2aa198;">"pensum"</span>.pluralize
=&gt; <span style="color: #2aa198;">"pensums"</span>
</pre>
</div>
</li>
<li>很明显的,rails也不是万能的(关键不是词典), 所以这里pensum的复数它写错了,因
为pensum的复数其实是pensa.我们可以把这个"知识"插入进去
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">en means English</span>
<span style="color: #b58900;">ActiveSupport</span>::<span style="color: #b58900;">Inflector</span>.inflections<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:en</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |inflect|
  inflect.plural /^<span style="color: #2aa198;">(</span>ox<span style="color: #2aa198;">)</span><span style="color: #657b83; font-weight: bold;">$/</span>i, <span style="color: #2aa198;">'\1en'</span>
  inflect.singular /^<span style="color: #2aa198;">(</span>ox<span style="color: #2aa198;">)</span>en/i, <span style="color: #2aa198;">'\1'</span>
  inflect.irregular <span style="color: #2aa198;">'person'</span>, <span style="color: #2aa198;">'people'</span>
  inflect.uncountable <span style="color: #2aa198;">%w( fish sheep)</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-4" class="outline-5">
<h5 id="sec-1-2-2-4">Custom MIME Types</h5>
<div class="outline-text-5" id="text-1-2-2-4">
<ul class="org-ul">
<li>rails自己为每个MIME准备了一个symbol(ruby的枚举)
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">application/json</td>
<td class="left">:json</td>
</tr>

<tr>
<td class="left">application/xml</td>
<td class="left">:xml</td>
</tr>
</tbody>
</table>
</li>
<li>你也可以自己添加自己的类型到mime_types.rb
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-5" class="outline-5">
<h5 id="sec-1-2-2-5">Secret Token</h5>
<div class="outline-text-5" id="text-1-2-2-5">
<ul class="org-ul">
<li>有一种黑客欺骗server的方式,就是更改cookie的内容并且不通知server. server为
了保证自己的cookie不被修改,会把所有发给client的cookied进行数字签名.secret_token.rb
包含了secret key base
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Example</span>::<span style="color: #b58900;">Application</span>.config.secret_key_base=<span style="color: #2aa198;">'f32b1a3755e05a3d...'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-6" class="outline-5">
<h5 id="sec-1-2-2-6">Session Store</h5>
<div class="outline-text-5" id="text-1-2-2-6">
<ul class="org-ul">
<li>rails4开始,session也是被encrypted的
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-2-7" class="outline-5">
<h5 id="sec-1-2-2-7">Wrap Parameters</h5>
<div class="outline-text-5" id="text-1-2-2-7">
<ul class="org-ul">
<li>从Rails 3.1开始,引入了wrap_parameters.rb来配合JavaScript MVC framework的工作.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Enable parameter wrapping for JSON. You can disable thsi by setting</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">:format to an empty array.Now it only support json</span>
<span style="color: #b58900;">ActiveSupport</span>.on_load<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:action_controller</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span>
  wrap_parameters <span style="color: #657b83; font-weight: bold;">format</span>: <span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:json</span><span style="color: #2aa198;">]</span> <span style="color: #859900; font-weight: bold;">if</span> respond_to?<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:wrap_parameters</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>然后当你传递一个parameter给controller的时候, 你的JSON数据是这样的
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">{</span><span style="color: #2aa198;">"title"</span>: <span style="color: #2aa198;">"The Rails 4 Way"</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>然后这个是一个hash不错, rails还会包装一下你的hash:
<ul class="org-ul">
<li>在你的hash后面加一个新的成员
</li>
<li>新的成员的key是parameter的名字. 值是前面的json.于是就是这样
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">{</span><span style="color: #2aa198;">"title"</span>: <span style="color: #2aa198;">"The Rails 4 Way"</span>, <span style="color: #2aa198;">"article"</span> =&gt; <span style="color: #b58900;">{</span><span style="color: #2aa198;">"title"</span>: <span style="color: #2aa198;">"The Rails 4 Way"</span><span style="color: #b58900;">}</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">Additional Configuration</h4>
<div class="outline-text-4" id="text-1-2-3">
<ul class="org-ul">
<li>除了上面所述,你还可以使用额外的设置
</li>
</ul>
</div>
<div id="outline-container-sec-1-2-3-1" class="outline-5">
<h5 id="sec-1-2-3-1">Log-Level Override</h5>
<div class="outline-text-5" id="text-1-2-3-1">
<ul class="org-ul">
<li>默认的log 级别是debug, 你也可以override它.
<div class="org-src-container">

<pre class="src src-ruby">config.log_level = <span style="color: #268bd2; font-weight: bold;">:debug</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2-3-2" class="outline-5">
<h5 id="sec-1-2-3-2">Schema Dumper</h5>
<div class="outline-text-5" id="text-1-2-3-2">
<ul class="org-ul">
<li>每次你做测试的时候, Rails都会把你development的数据库拷贝到test database(
使用一个自动产生的schema.rb, 非常像Active Record生成的migration script)如
果你们够高级的话,可能会想使用自己的sql来实现这些.这个时候,可以如下设置
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use SQL instead of Active Record's schema dumper when creating the</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">test database. This is necessary if your schema can't be completely</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dumped by the schema dumper, for example, if you have constraints</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">or db-specific column types</span>
config.active_record.schema_format = <span style="color: #268bd2; font-weight: bold;">:sql</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Development Mode</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>Development是开发人员一直要使用的mode.这里我们来深入的解释一下这个mode,其主
要配置文件都写在config/environments/development.rb
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">File: config/environments/development.rb</span>
<span style="color: #b58900;">Example</span>::<span style="color: #b58900;">Application</span>.configure <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Settings specified here will take precedence over those in</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config/application.rb</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1">Automatic Class Reloading</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li>Development mode的最大特点是,代码的改动马上能够反映到网站上面.能够开关这个
重要特性的变量是config.cache_classes
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In the development environement your application's code is reloaded on</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">every request. This slows down response time but is perfect for</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">development since you don't have to restart the web server when you</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">make code changes</span>

config.cache_classes = <span style="color: #268bd2; font-weight: bold;">false</span>
</pre>
</div>
</li>
<li>其魔法性在于:
<ul class="org-ul">
<li>如果你使用像默认的情况下一样设置config.cache_classses为false.那么就使用
load来倒入代码,其特点是每次都导入,无论内存里面是否已经有了.这样虽然导入慢,
但是能够实时反映代码改动.
</li>
<li>如果设置为true,那么就使用require来导入代码了,就会使用内存中已有代码,不会
重复导入.
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-1-3-1-1" class="outline-5">
<h5 id="sec-1-3-1-1">The Rails Class Loader</h5>
<div class="outline-text-5" id="text-1-3-1-1">
<ul class="org-ul">
<li>ruby不像java,要求file的名字和其中class的名字相同甚至相似. 但是在Rails里面
file和其中class的名字是有联系的.
</li>
<li>Rails这么做的理论基础,是ruby的callback机制
<pre class="example">
当Rails遇到一个没有定义的constant的时候, 它会基于file-naming规则来调用在
load path里面的相应的Ruby Script
</pre>
</li>
<li>从上面的定义我们也能看到rails也有自己的load path的.load path可以再initializer.rb
里面定义,然后使用$LOAD_PATH查看
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ rails console
Loading development environment <span style="color: #2aa198;">(</span>Rails 3.0.20<span style="color: #2aa198;">)</span>
<span style="color: #268bd2;">irb</span><span style="color: #2aa198;">(</span>main<span style="color: #2aa198;">)</span>:001:0&gt; $<span style="color: #268bd2;">LOAD_PATH</span>
=&gt; <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"/usr/local/var/rbenv/versions/1.9.3-p484/lib/ruby/gems/1.9.1/gems/gdata_19-1.1.5/lib"</span>, ....
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-1-2" class="outline-5">
<h5 id="sec-1-3-1-2">Rails, Modules, and Auto-Loading Code</h5>
<div class="outline-text-5" id="text-1-3-1-2">
<ul class="org-ul">
<li>一般来说,在Ruby代码里面,你要想使用其他file里面的ruby代码,一句"require"是
最起码的要求. Rails改变了这个情况,Rails可以自动调用,你从不用require!
</li>
<li>Rails能做到这个,其实也不是无头无脑的全部require, 其原理还基于naming convention:
<ul class="org-ul">
<li>如果名字没有nested,那么就把Class名字的驼峰变成小写,然后驼峰之间加入下划
线
<pre class="example">
EstimationCalculator ==&gt; estimation_calculator
KittTurboBoost ==&gt; kitt_turbo_boost
</pre>
</li>
<li>如果有nested,除了上面的规定外,再把前面的"大环境"加上
<pre class="example">
MacGyver::SwissArmKnife ==&gt; mac_gyver/swiss_army_knife
</pre>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2">Eager Load</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>默认情况下,rails不会把所有内容放入内存(那会极大提高开启网站的速度). 但是在
development mode下你可以设置为放入内存(反正你也不常开). 放入内存会提高速度
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Do not eager lod code on boot</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You can set it to true in development mode</span>
config.eager_load = <span style="color: #268bd2; font-weight: bold;">false</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3">Error Reports</h4>
<div class="outline-text-4" id="text-1-3-3">
<ul class="org-ul">
<li>从local发出的request会得到更好的出错信息.所以你可以设置下面的config为true.
来把非local的request理解成local的
<div class="org-src-container">

<pre class="src src-ruby">config.consider_all_requests_local = <span style="color: #268bd2; font-weight: bold;">true</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-4" class="outline-4">
<h4 id="sec-1-3-4">Caching</h4>
<div class="outline-text-4" id="text-1-3-4">
<ul class="org-ul">
<li>development mode下不要设置cache. 即便为了测试设置一次,也要马上改回来!cache
是奇怪错误的发源地
<div class="org-src-container">

<pre class="src src-ruby">config.action_controller.perform_caching = <span style="color: #268bd2; font-weight: bold;">true</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-5" class="outline-4">
<h4 id="sec-1-3-5">Raise Delivery Errors</h4>
<div class="outline-text-4" id="text-1-3-5">
<ul class="org-ul">
<li>在development mode下面默认rails不会设置Aciton Mailer来为用户发送邮件.可以
通过如下设置来屏蔽mail的错误
<div class="org-src-container">

<pre class="src src-ruby">config.action_mailer.raise_delivery_errors = <span style="color: #268bd2; font-weight: bold;">false</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-6" class="outline-4">
<h4 id="sec-1-3-6">Deprecation Notices</h4>
<div class="outline-text-4" id="text-1-3-6">
<ul class="org-ul">
<li>Deprecation warnings非常重要,需要加入到log里面:通过如下设置
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Print deprecation notices to the Rails logger</span>
config.active_support.deprecation = <span style="color: #268bd2; font-weight: bold;">:log</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-7" class="outline-4">
<h4 id="sec-1-3-7">Explain for Slow Queries</h4>
<div class="outline-text-4" id="text-1-3-7">
<ul class="org-ul">
<li>从Rails 3.2开始, Active Record会为SQL查询设置一个"阈值". 超过这个阈值的查询
都会被log. 设置"阈值"的代码为
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Log the query plan for queries taking more than this</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(works with SQLite, MySQL, and PostgreSQL)</span>
config.active_record.auto_explain_threshold_in_seconds = 0.5
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-8" class="outline-4">
<h4 id="sec-1-3-8">Assets Debug Mode</h4>
<div class="outline-text-4" id="text-1-3-8">
<ul class="org-ul">
<li>Development模式下面, 会阻止一些javascript的设置
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Debug mode disables concatenation and preprocessing of assets</span>
config.assets.debug = <span style="color: #268bd2; font-weight: bold;">true</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Test Mode</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>如果RAILS_ENV被设置为test的话,那么久说明你进入了test mode. 其设置为
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">File: config/environments/test.rb</span>

<span style="color: #b58900;">Example</span>::<span style="color: #b58900;">Application</span>.configure <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Settings specified here will take precedence over those in</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config/application.rb</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The test environment is used exclusively to run your application's</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">test suite. You never need to work with it otherwise. Rember that</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">your test databse is "scratch space" for the test suite and is wiped</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">and recreated between test runs. Don't rely on the data there!</span>
  config.cache_classes = <span style="color: #268bd2; font-weight: bold;">true</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Do not eager load code on boot. This avoids loading your whole</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">application just for the purpose of running a single test. If you are</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">using a tool that preloads Rails for running tests, you may have to</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">set it to true</span>
  config.eager_load = <span style="color: #268bd2; font-weight: bold;">false</span>
</pre>
</div>
</li>
<li>在production mode下发生问题的时候,我们可以创建一个custom 的 mode(需要在
config/environments里面写一个rb文件).
<ul class="org-ul">
<li>所有的config和development mode都类似(比如可以不重启server而读取设置).
</li>
<li>单单数据使用production mode的设置.数据库就可以连接production mode的数据库
这样就可以定位线上问题.
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">Production Mode</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>production mode是你的应用真正使用的mode, 其最追求的肯定是速度. 不会为了一个
request而读取所有的application class
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">File: config/environments/production.rb</span>
<span style="color: #b58900;">Example</span>::<span style="color: #b58900;">Application</span>.configure <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Settings specified here will take precedence over those in</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config/application.rb</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Code is not reloaded between requests</span>
  config.cache_classes = <span style="color: #268bd2; font-weight: bold;">true</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Eager load code on boot. This eager loads most of Rails</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">and your application in memory, allowing both thread web servers</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">and those relying on copy on write to perform better</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Rake tasks automatically ignore this option for performance</span>
  config.eager_load = <span style="color: #268bd2; font-weight: bold;">true</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Full error reports are disabled and caching is turned on</span>
  config.consider_all_requests_local        = <span style="color: #268bd2; font-weight: bold;">false</span>
  config.action_controller.perform_caching  = <span style="color: #268bd2; font-weight: bold;">true</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Enable Rake::Cache to put a simple HTTP cache in front of your</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">application</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Add 'rake-cache' to your Gemfile before enabling this</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">For large-scale production use, consider using a caching reverse proxy</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">like nginx, varnish or squid</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">config.action_dispatch.rack_cache = true</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Disable rails's static assert server</span>
  config.serve_static_assets = <span style="color: #268bd2; font-weight: bold;">false</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Compress JavaScripts and CSS</span>
  config.assets.js_compressor = <span style="color: #268bd2; font-weight: bold;">:uglifier</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1">Assets</h4>
<div class="outline-text-4" id="text-1-5-1">
<ul class="org-ul">
<li>css 和 javascript统称为asset
</li>
<li>在production mode下面, assets都是被提前压缩好的.放入到public/assets里面,
名字保持不变设置config.assets.compile为asset的编译设置
</li>
<li>处理application.js和application.css以外如果还想加其他asset的话,那么要如下
<div class="org-src-container">

<pre class="src src-ruby">config.assets.precompile += <span style="color: #2aa198;">%w( administration.css)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-5-2" class="outline-4">
<h4 id="sec-1-5-2">Asset Hosts</h4>
<div class="outline-text-4" id="text-1-5-2">
<ul class="org-ul">
<li>一般来说我们都把asset文件放入public文件夹,你也可以另外指定地方
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">Logging</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li>大部分的Rails成员(MVC三剑客model, controller, view)都有logger attribute. 这
个attribute是一个ref,指向一个Logger class
</li>
<li>Rails.logger 函数会产生一个默认的logger,请随便使用吧.
</li>
</ul>
</div>
<div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1">Rails Log Files</h4>
<div class="outline-text-4" id="text-1-6-1">
<ul class="org-ul">
<li>log文件可能会增长特别快, rake专门有个命令来清理
<div class="org-src-container">

<pre class="src src-sh">rake log:clear                  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Truncates all *.log files in log/ to zero bytes</span>
</pre>
</div>
</li>
<li>development mode下的log非常有价值,其会详细列举HTTP request和response的内容
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2">Tagged Logging</h4>
<div class="outline-text-4" id="text-1-6-2">
<ul class="org-ul">
<li>我们可以给log加上类似"标签"的功能.
<div class="org-src-container">

<pre class="src src-ruby">config.log_tags = <span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:subdomain</span><span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
<li>然后log就是这样的了
<pre class="example">
[admin]StartedGET"/articles"for127.0.0.1at2013-02-0111:49:09-0500
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3">Log File Analysis</h4>
<div class="outline-text-4" id="text-1-6-3">
<ul class="org-ul">
<li>log里面引入了时间,是为了做performance的调查,但是这个时间并不一定准确
</li>
<li>Active Record生成的SQL也有可能不对,log里面有
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Chapter 02: Routing</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>Routing在rails里面的作用，就是判断来袭的URL是什么意思，然后决定采取什么行动
</li>
<li>routing的主要配置文件在config/routes.rb
</li>
</ul>
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">The Two Purposes of Routing</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>routing有两个作用：
<ul class="org-ul">
<li>把URL 转给相应的controller method。
</li>
<li>维护动态生成URL的函数，比如link_to, redirect_to
</li>
</ul>
</li>
<li>routing其实是把url和action映射成key/value形式的行为
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'recipes/:ingredient'</span> =&gt; <span style="color: #2aa198;">"recipes#index"</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">The routes.rb File</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>config/routes.rb是一开始就创建出来的.其默认内容为
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Example</span>::<span style="color: #b58900;">Application</span>.routes.draw <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The priority is based upon order of creation: first created -&gt; highest</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">priority</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">See how all your routes lay out with "rake routes"</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You can have the root of your site routed with "root"</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">root to: 'welcome#index'</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Example of regular route:</span>
  <span style="color: #93a1a1;">#  </span><span style="color: #93a1a1;">get 'products/:id' =&gt; 'catalog#view'</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Example of named route that can be invoked with</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">purchase_URL(id: procutd.id)</span>
  <span style="color: #93a1a1;">#  </span><span style="color: #93a1a1;">get 'products/:id/purchase' =&gt; 'catalog#purchase', as: :purchase</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Example resource route(maps HTTP verbs&#22836;controller actions)</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>整个文件其实就是一个函数调用:
<ul class="org-ul">
<li>函数名是:Example::Application.routes.draw
</li>
<li>函数参数是一个block 从do开始.end结束
</li>
</ul>
</li>
<li>rails系统在遇到URL的时候,就是来这个文件从头到尾找"match", 找到一个合适的,剩
下的就不会再继续找了.
</li>
</ul>
</div>
<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">Regular Routes</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>最常见的设置route单位的方法如下
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/:id'</span>, <span style="color: #268bd2; font-weight: bold;">to:</span> <span style="color: #2aa198;">'products#show'</span>
</pre>
</div>
</li>
<li>由于用法太常见, :to被省略成了=&gt;
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/:id'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">Constraining Request Methods</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>传统rails可以使用match,然后再最后通过via来确定URL使用哪些HTTP method
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">'products/:id'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>, <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:get</span>
</pre>
</div>
</li>
<li>时过境迁,现在最适合的方式是一个URL最好只有一个HTTP method
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/:id'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>
post <span style="color: #2aa198;">'products'</span> =&gt; <span style="color: #2aa198;">'products#create'</span>
</pre>
</div>
</li>
<li>实在需要一个url支持多个HTTP协议也可以
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">'products/:id'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>, <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:get</span>, <span style="color: #268bd2; font-weight: bold;">:post</span><span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
<li>还可以把所有http协议都支持(不过不推荐)
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">'products'</span> =&gt; <span style="color: #2aa198;">'products#index'</span>, <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:any</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3">URL Patterns</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li>URL会导致params的不同,但是我们在URL里面也可以只制定一部分,比如下面的例子
我们只指定id, 凡是只有id的情况我们"默认"使用product controller(这样做其实
是不怎么好的): <a href="http://localhost:3000/8">http://localhost:3000/8</a>  会使用product controller的show
而且params[:id]为8
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">":id"</span> =&gt; <span style="color: #2aa198;">"products#show"</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-4" class="outline-4">
<h4 id="sec-2-2-4">Segment Keys</h4>
<div class="outline-text-4" id="text-2-2-4">
<ul class="org-ul">
<li>URL pattern是可以带一个参数的(前面依靠冒号分割), 这个参数叫做segment key
下面例子中,id就是segment key
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/:id'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>
</pre>
</div>
</li>
<li>如果用户输入了<a href="http://example.com/products/4">http://example.com/products/4</a> 的话,那么id就会被赋值为4,然后
后台逻辑会跳转到procuts里面的show函数.
</li>
<li>我们随时可以在route设置的时候,就给它一个hardcode的参数,如下
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/special'</span> =&gt; <span style="color: #2aa198;">'products#show'</span>, <span style="color: #268bd2; font-weight: bold;">special:</span> <span style="color: #2aa198;">'true'</span>
</pre>
</div>
</li>
<li>但是这种方法是非常不值得推荐的,推荐做法应该是新建一个函数,如下
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'products/special'</span> =&gt; <span style="color: #2aa198;">'products#special'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-5" class="outline-4">
<h4 id="sec-2-2-5">Spotlight on the :id Field</h4>
<div class="outline-text-4" id="text-2-2-5">
<ul class="org-ul">
<li>前面的参数,也就是segment key叫做id,不是平白无故的叫的(是convention),它其实
是我们数据库里面的一个参数.在Controller里面会涉及的(其为一个变量params中的
一个enum key)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">ProductsController</span> &lt; <span style="color: #b58900;">ApplicationController</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">show</span>
    <span style="color: #268bd2;">@product</span> = <span style="color: #b58900;">Product</span>.find<span style="color: #2aa198;">(</span>params<span style="color: #b58900;">[</span><span style="color: #268bd2; font-weight: bold;">:id</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-6" class="outline-4">
<h4 id="sec-2-2-6">Optional Segment Keys</h4>
<div class="outline-text-4" id="text-2-2-6">
<ul class="org-ul">
<li>Rails3引入了"选用(optional)"的URL, 比如下例中的()里面的部分,就是optional的.
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">':controller(/:action(/:id(.:format)))'</span>, <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:any</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-7" class="outline-4">
<h4 id="sec-2-2-7">Redirect Routes</h4>
<div class="outline-text-4" id="text-2-2-7">
<ul class="org-ul">
<li>我们还可以使用redirect函数来重定向route定义
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">"/foo"</span>, <span style="color: #268bd2; font-weight: bold;">to:</span> redirect<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'/bar'</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">full URI is also OK</span>
get <span style="color: #2aa198;">"/google"</span>, <span style="color: #268bd2; font-weight: bold;">to:</span> redirect<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'http://google.com/'</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>redirect还可以接受block作为参数
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">"/api/v1/:api"</span>, <span style="color: #268bd2; font-weight: bold;">to:</span>
  redirect <span style="color: #2aa198;">{</span>|params| <span style="color: #2aa198;">"/api/v2/</span><span style="color: #268bd2;">#{params[:api].pluralize}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>,
  <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:any</span>
</pre>
</div>
</li>
<li>redirect函数还接受一个额外的:status参数
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">"/api/v1/:api"</span>, <span style="color: #268bd2; font-weight: bold;">:to</span> =&gt;
  redirect<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">status:</span> 302<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|params|  <span style="color: #2aa198;">"/api/v2/</span><span style="color: #268bd2;">#{params[:api].pluralize}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>,
  <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:any</span>
</pre>
</div>
</li>
<li>redirect函数的返回值,是一个ActionDispatch::Routing::Redirect的instance(也
就是一个Rack endpoint #TODO#).
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">AcationDispatch</span>
  <span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Routing</span>
    <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Redirect</span>
      <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
      <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">call</span><span style="color: #2aa198;">(</span>env<span style="color: #2aa198;">)</span>
        req = <span style="color: #b58900;">Request</span>.new<span style="color: #2aa198;">(</span>env<span style="color: #2aa198;">)</span>
        <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
      <span style="color: #859900; font-weight: bold;">end</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-8" class="outline-4">
<h4 id="sec-2-2-8">The Format Segment</h4>
<div class="outline-text-4" id="text-2-2-8">
<ul class="org-ul">
<li>我们再来看一遍legacy default route.它的样子是这样的.
<div class="org-src-container">

<pre class="src src-ruby">match <span style="color: #2aa198;">':controler(/:action(/:id(.:format)))'</span>, <span style="color: #268bd2; font-weight: bold;">via:</span> <span style="color: #268bd2; font-weight: bold;">:any</span>
</pre>
</div>
</li>
<li>其中的.:formt非常有意思,其实就是扩展名,比如下面的这个例子中, params[:format]
就会被设置为json, params[:format]非常有用,比如在respond_to源代码里面就默认
你设置了params[:format]
<pre class="example">
http://localhost:3000/products/show/3.json
</pre>
</li>
<li>所谓respond_to, 其作用是让你写自己的action,但是根据[:format]的不同,而返回不
同的结果. 也就是说如果params[:format]不同的话, 就不能使用redirect函数了, 而
必须要使用redirect_to函数.
</li>
<li>下面就是一个controller的show action:它调用函数respond_to
<ul class="org-ul">
<li>通过对[:format]的判断来决定自己的行为
</li>
<li>format只列举了html,json两种类型,那么其他类型我们不支持.
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">show</span>
  <span style="color: #268bd2;">@product</span> = <span style="color: #b58900;">Product</span>.find<span style="color: #2aa198;">(</span>params<span style="color: #b58900;">[</span><span style="color: #268bd2; font-weight: bold;">:id</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>
  respond_to <span style="color: #859900; font-weight: bold;">do</span> |format|
    format.html
    format.json <span style="color: #2aa198;">{</span> render <span style="color: #268bd2; font-weight: bold;">json:</span> <span style="color: #268bd2;">@product</span>.to_json<span style="color: #2aa198;">}</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>如果你请求的URL里面不包括html或者json,那么Rails就会返回406 Not Acceptable
这也就是为什么我们的cubetree"无法使用respond_to函数", 我们要自己来hack一下,
在api请求的url的情况下,把params[:format]设置为json
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-9" class="outline-4">
<h4 id="sec-2-2-9">Routes as Rack Endpoints</h4>
<div class="outline-text-4" id="text-2-2-9">
<ul class="org-ul">
<li>TODO
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-10" class="outline-4">
<h4 id="sec-2-2-10">Accept Header</h4>
<div class="outline-text-4" id="text-2-2-10">
<ul class="org-ul">
<li>在request里面设置Accept Header会让我们的respond_to选择合适的返回类型(但是
在实际操作中由于HTTP协议的不可靠性,这个header并不是每次都能传递成功)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-11" class="outline-4">
<h4 id="sec-2-2-11">Segment Key Constraints</h4>
<div class="outline-text-4" id="text-2-2-11">
<ul class="org-ul">
<li>有时候你想更加精细的控制你的url,比如下面这个url, show后面的id,如果是数字,
那么就正常处理,否则就要显示错误.我们可以使用constraints来做这个限制
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">':controller/show/:id'</span> =&gt; <span style="color: #268bd2; font-weight: bold;">:show</span>, <span style="color: #268bd2; font-weight: bold;">constraints:</span> <span style="color: #2aa198;">{</span><span style="color: #268bd2; font-weight: bold;">:id</span> =&gt; <span style="color: #2aa198;">/\d+/</span><span style="color: #2aa198;">}</span>
get <span style="color: #2aa198;">':controller/show/:id'</span> =&gt; <span style="color: #268bd2; font-weight: bold;">:show_error</span>
</pre>
</div>
</li>
<li>需要非常注意的是我们上面的正则表达式是这样的
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">/\d+/</span>
</pre>
</div>
</li>
<li>看上去好像"foo32bar"也会对应这个id,但其实不是的.因为Rails默认的给constraints
里面的正则表达式加上了\A和Z
</li>
<li>由于constraints如此的常用,后期rails直接把这个省略了
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">':controller/show/:id'</span> =&gt; <span style="color: #268bd2; font-weight: bold;">:show</span>, <span style="color: #268bd2; font-weight: bold;">id:</span> <span style="color: #2aa198;">/\d+/</span>
get <span style="color: #2aa198;">':controller/show/:id'</span> =&gt; <span style="color: #268bd2; font-weight: bold;">:show_error</span>
</pre>
</div>
</li>
<li>即便有constraints的帮助,你仍然需要在运行的时候对输入参数进行测试,因为正则表
达式不是万能的.
</li>
<li>constraints不仅仅是对params哈希表里面的参数有限制作用,它甚至可以去限制:subdomain,
或者:referrer
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">only allow users admin subdomain to do old-school routing</span>
get <span style="color: #2aa198;">':controller/:action/:id'</span> =&gt; <span style="color: #268bd2; font-weight: bold;">:show</span>, <span style="color: #268bd2; font-weight: bold;">constraints:</span> <span style="color: #2aa198;">{</span><span style="color: #268bd2; font-weight: bold;">subdomain:</span> <span style="color: #2aa198;">'admin'</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>更加精细的控制,需要传入一个block来做到(proc就是block的显性表达), 比如下面是
要求url必须是大于100的id
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">protect records with id under 100</span>
get <span style="color: #2aa198;">'records/:id'</span> =&gt; <span style="color: #2aa198;">"records#protected"</span>,
<span style="color: #268bd2; font-weight: bold;">constraints:</span> <span style="color: #657b83; font-weight: bold;">proc</span> <span style="color: #2aa198;">{</span>|req| req.params<span style="color: #b58900;">[</span><span style="color: #268bd2; font-weight: bold;">:id</span><span style="color: #b58900;">]</span>.to_i &lt; 100<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-12" class="outline-4">
<h4 id="sec-2-2-12">The Root Route</h4>
<div class="outline-text-4" id="text-2-2-12">
<ul class="org-ul">
<li>在config/routes.rb的前面有如下一行被注释掉的代码.其实就是让你选择自己网站
的root在哪里的. 如果你准备好了主页,可以改写这句代码
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You can have the root fo your site routed with "root"</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">root to: 'welcome#index'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Route Globbing</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>有些情况下,你可能不想把每个path都一个个的写出来, 因为太多了(而且有规则可循),
比如列出文件系统的结构:比如URL为列出dickens的短篇
<pre class="example">
/items/list/base/books/fictin/dickens/little_dorrit
</pre>
</li>
<li>可能从/items/list后面开始,就是文件系统的列表了,一个个把url列出来显然不明智
</li>
<li>rails的方法是"星号"
<div class="org-src-container">

<pre class="src src-ruby">get <span style="color: #2aa198;">'items/list/*specs'</span>, <span style="color: #268bd2; font-weight: bold;">controller:</span> <span style="color: #2aa198;">'items'</span>, <span style="color: #268bd2; font-weight: bold;">action:</span> <span style="color: #2aa198;">'list'</span>
</pre>
</div>
</li>
<li>我们再在函数list里面处理specs
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">list</span>
  specs = params<span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:specs</span><span style="color: #2aa198;">]</span>        <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">e.g, "base/books/fiction/dickens"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Named Routes</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

         <!-- Disqus Comment BEGIN -->
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'harrifeng';

              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

         <!-- Disqus Comment END -->
</div>
</body>
</html>
