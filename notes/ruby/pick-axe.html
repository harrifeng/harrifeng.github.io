<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>pick-axe</title>
<!-- 2017-05-02 Tue 10:43 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="your name" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

         <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Galdeano|Open+Sans:600italic,400,600|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
         <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://harrifeng.github.io/sitemap.html"> UP </a>
 |
 <a accesskey="H" href="http://harrifeng.github.io/index.html"> HOME </a>
</div><div id="preamble" class="status">

         <div id="header">
            <div id="header-top">
                <div id="blog-title">Harrifeng's Path</div>
                <div id="blog-sub-title">纸上得来终觉浅,绝知此事要Coding</div>
            </div>
            <div id="nav">
                <ul>
                    <li><a href="/">首页</a></li>
                    <li><a href="/about.html">About Me</a></li>
                    <li>
                    </li>
                </ul>
            </div>
         </div>
</div>
<div id="content">
<h1 class="title">pick-axe</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Chapter 01: Getting Started</a>
<ul>
<li><a href="#sec-1-1">The Command Prompt</a></li>
<li><a href="#sec-1-2">Installing Ruby</a></li>
<li><a href="#sec-1-3">Running Ruby</a>
<ul>
<li><a href="#sec-1-3-1">Interactive Ruby</a></li>
</ul>
</li>
<li><a href="#sec-1-4">Ruby Documentation:RDoc and ri</a></li>
</ul>
</li>
<li><a href="#sec-2">Chapter 02: Ruby.new</a>
<ul>
<li><a href="#sec-2-1">Ruby Is an Object-Oriented Language</a></li>
<li><a href="#sec-2-2">Some Basic Ruby</a></li>
<li><a href="#sec-2-3">Arrays and Hashes</a></li>
<li><a href="#sec-2-4">Symbols</a></li>
<li><a href="#sec-2-5">Control Structures</a></li>
<li><a href="#sec-2-6">Regular Expressions</a></li>
<li><a href="#sec-2-7">Blocks and Iterators</a></li>
<li><a href="#sec-2-8">Reading and Riting</a></li>
<li><a href="#sec-2-9">Command-Line Arguments</a></li>
</ul>
</li>
<li><a href="#sec-3">Chapter 03: Classes, Objects, and Variables</a>
<ul>
<li><a href="#sec-3-1">Objects and Attributes</a>
<ul>
<li><a href="#sec-3-1-1">Virtual Attributes</a></li>
<li><a href="#sec-3-1-2">Attributes, Instance Variables, and Methods</a></li>
</ul>
</li>
<li><a href="#sec-3-2">Classes Working with Other Classes</a></li>
<li><a href="#sec-3-3">Access Control</a>
<ul>
<li><a href="#sec-3-3-1">Specifying Access Control</a></li>
</ul>
</li>
<li><a href="#sec-3-4">Variables</a></li>
</ul>
</li>
<li><a href="#sec-4">Chapter 04: Containers, Blocks, and Iterators</a>
<ul>
<li><a href="#sec-4-1">Arrays</a></li>
<li><a href="#sec-4-2">Hashes</a>
<ul>
<li><a href="#sec-4-2-1">Word Frequency: Using Hashes and Arrays</a></li>
</ul>
</li>
<li><a href="#sec-4-3">Blocks and Iterators</a>
<ul>
<li><a href="#sec-4-3-1">Blocks</a></li>
<li><a href="#sec-4-3-2">Implementing Iterators</a></li>
<li><a href="#sec-4-3-3">Enumerators&#x2013;External Iterators</a></li>
<li><a href="#sec-4-3-4">Enumerators Are Objects</a></li>
<li><a href="#sec-4-3-5">Enumerators Are Generators and Filters</a></li>
<li><a href="#sec-4-3-6">Lazy Enumerators in Ruby 2</a></li>
<li><a href="#sec-4-3-7">Blocks for Transactions</a></li>
<li><a href="#sec-4-3-8">Blocks Can Be Objects</a></li>
<li><a href="#sec-4-3-9">Blocks Can Be Closures</a></li>
<li><a href="#sec-4-3-10">An Alternative Notation</a></li>
<li><a href="#sec-4-3-11">Block Parameter Lists</a></li>
</ul>
</li>
<li><a href="#sec-4-4">Containers Everywhere</a></li>
</ul>
</li>
<li><a href="#sec-5">Chapter 05: Sharing Functionality: Inheritance, Modules, and Mixins</a>
<ul>
<li><a href="#sec-5-1">Inheritance and Messages</a></li>
<li><a href="#sec-5-2">Modules</a>
<ul>
<li><a href="#sec-5-2-1">Namespaces</a></li>
</ul>
</li>
<li><a href="#sec-5-3">Mixins</a></li>
<li><a href="#sec-5-4">Iterators and the Numerable Module</a></li>
<li><a href="#sec-5-5">Composing Modules</a>
<ul>
<li><a href="#sec-5-5-1">Instance Variables in Mixins</a></li>
<li><a href="#sec-5-5-2">Resolving Ambiguous Method Names</a></li>
</ul>
</li>
<li><a href="#sec-5-6">Inheritance, Mixins, and Design</a></li>
</ul>
</li>
<li><a href="#sec-6">Chapter 06: Standard Types</a>
<ul>
<li><a href="#sec-6-1">Numbers</a>
<ul>
<li><a href="#sec-6-1-1">How Numbers Interact</a></li>
<li><a href="#sec-6-1-2">Looping Using Numbers</a></li>
</ul>
</li>
<li><a href="#sec-6-2">Strings</a>
<ul>
<li><a href="#sec-6-2-1">Strings and Encodings</a></li>
<li><a href="#sec-6-2-2">Character Constants</a></li>
<li><a href="#sec-6-2-3">Working with Strings</a></li>
</ul>
</li>
<li><a href="#sec-6-3">Ranges</a>
<ul>
<li><a href="#sec-6-3-1">Ranges as Sequences</a></li>
<li><a href="#sec-6-3-2">Ranges as Conditions</a></li>
<li><a href="#sec-6-3-3">Ranges as Intervals</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-7">Chapter 07: Regular Expressions</a>
<ul>
<li><a href="#sec-7-1">What Regular Expressions Let You Do</a></li>
<li><a href="#sec-7-2">Ruby's Regular Expressions</a>
<ul>
<li><a href="#sec-7-2-1">Matching Strings with Patterns</a></li>
<li><a href="#sec-7-2-2">Changing Strings with Patterns</a></li>
</ul>
</li>
<li><a href="#sec-7-3">Digging Deeper</a></li>
</ul>
</li>
<li><a href="#sec-8">Chapter 08: More About Methods</a>
<ul>
<li><a href="#sec-8-1">Defining a Method</a>
<ul>
<li><a href="#sec-8-1-1">Variable-Length Argument Lists</a></li>
<li><a href="#sec-8-1-2">Methods and Blocks</a></li>
</ul>
</li>
<li><a href="#sec-8-2">Calling a Method</a>
<ul>
<li><a href="#sec-8-2-1">Passing Parameters to a Method</a></li>
<li><a href="#sec-8-2-2">Method Return Values</a></li>
<li><a href="#sec-8-2-3">Splat! Expanding Collections in Method Calls</a></li>
<li><a href="#sec-8-2-4">Making Blocks More Synamic</a></li>
<li><a href="#sec-8-2-5">Hash and Keyword Arguments</a></li>
<li><a href="#sec-8-2-6">Keyword Argument Lists</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-9">Chapter 09: Expressions</a>
<ul>
<li><a href="#sec-9-1">Operator Expressions</a></li>
<li><a href="#sec-9-2">Miscellaneous Expressions</a>
<ul>
<li><a href="#sec-9-2-1">Command Expansion</a></li>
<li><a href="#sec-9-2-2">Redefining Backquotes</a></li>
</ul>
</li>
<li><a href="#sec-9-3">Assignment</a>
<ul>
<li><a href="#sec-9-3-1">Parallel Assignment</a></li>
<li><a href="#sec-9-3-2">Splats and Assignment</a></li>
<li><a href="#sec-9-3-3">Nested Assignments</a></li>
<li><a href="#sec-9-3-4">Other Forms of Assignment</a></li>
</ul>
</li>
<li><a href="#sec-9-4">Conditional Execution</a>
<ul>
<li><a href="#sec-9-4-1">Boolean Expressions</a></li>
<li><a href="#sec-9-4-2">And, Or, and Not</a></li>
<li><a href="#sec-9-4-3">defined?</a></li>
<li><a href="#sec-9-4-4">Comparing objects</a></li>
<li><a href="#sec-9-4-5">if and unless Expressions</a></li>
<li><a href="#sec-9-4-6">if and unless Modifiers</a></li>
</ul>
</li>
<li><a href="#sec-9-5">case Expressions</a></li>
<li><a href="#sec-9-6">Loops</a>
<ul>
<li><a href="#sec-9-6-1">Iterators</a></li>
<li><a href="#sec-9-6-2">for &#x2026; in</a></li>
<li><a href="#sec-9-6-3">break, redo, and next</a></li>
</ul>
</li>
<li><a href="#sec-9-7">Variable Scope</a></li>
</ul>
</li>
<li><a href="#sec-10">Chapter 10: Exceptions, catch, and throw</a>
<ul>
<li><a href="#sec-10-1">The Exception Class</a></li>
<li><a href="#sec-10-2">Handling Exceptions</a>
<ul>
<li><a href="#sec-10-2-1">System Erros</a></li>
<li><a href="#sec-10-2-2">Tidying Up</a></li>
<li><a href="#sec-10-2-3">Play It Again</a></li>
</ul>
</li>
<li><a href="#sec-10-3">Raising Exceptions</a>
<ul>
<li><a href="#sec-10-3-1">Adding Information to Exceptions</a></li>
</ul>
</li>
<li><a href="#sec-10-4">catch and throw</a></li>
</ul>
</li>
<li><a href="#sec-11">Chapter 11: Basic Input and Output</a>
<ul>
<li><a href="#sec-11-1">What Is an IO Object?</a>
<ul>
<li><a href="#sec-11-1-1">Writing to Files</a></li>
<li><a href="#sec-11-1-2">But I Miss My C++ iostream</a></li>
<li><a href="#sec-11-1-3">Doing I/O with Strings</a></li>
</ul>
</li>
<li><a href="#sec-11-2">Talking to Networks</a></li>
<li><a href="#sec-11-3">Parsing HTML</a></li>
<li><a href="#sec-11-4">Opening and Closing Files</a></li>
<li><a href="#sec-11-5">Reading and Writing Files</a>
<ul>
<li><a href="#sec-11-5-1">Iterators for Reading</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-12">Chapter 12: Fibers, Threads, and Processes</a>
<ul>
<li><a href="#sec-12-1">Fibers</a></li>
</ul>
</li>
<li><a href="#sec-13">Chapter 13: Unit Testing</a>
<ul>
<li><a href="#sec-13-1">The Testing Framework</a>
<ul>
<li><a href="#sec-13-1-1">Assertions == Expected Results</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-14">Chapter 14: When Troble Strikes!</a>
<ul>
<li><a href="#sec-14-1">Ruby Debugger</a></li>
<li><a href="#sec-14-2">Interactive Ruby</a></li>
<li><a href="#sec-14-3">Editor Support</a></li>
<li><a href="#sec-14-4">But It Doesn't Work!</a></li>
<li><a href="#sec-14-5">But It's Too Slow!</a>
<ul>
<li><a href="#sec-14-5-1">Benchmark</a></li>
<li><a href="#sec-14-5-2">Profiler</a></li>
<li><a href="#sec-14-5-3">Code Execution Coverage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Chapter 01: Getting Started</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>已经对这些问题都比较熟悉了,主要是一些unix-like的命令行操作介绍
</li>
</ul>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">The Command Prompt</h3>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Installing Ruby</h3>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Running Ruby</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>-v可以查看ruby的版本
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ ruby -v
ruby 2.0.0p247 <span style="color: #2aa198;">(</span>2013-06-27 revision 41674<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">[</span>universal.x86_64-darwin13<span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1">Interactive Ruby</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li>可以直接使用ruby
<div class="org-src-container">

<pre class="src src-sh">puts <span style="color: #2aa198;">"Hello, world!"</span>
^D
Hello, world!
</pre>
</div>
</li>
<li>最好可以使用irb
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Ruby Documentation:RDoc and ri</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>RDoc是HTML版本的文档.
</li>
<li>ri是本地版本的命令行文档. ri + ClassName开业找到对class的描述
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ ri GC
= GC

<span style="color: #2aa198;">(</span>from ruby core<span style="color: #2aa198;">)</span>
------------------------------------------------------------------------------
The GC module provides an interface to Ruby<span style="color: #2aa198;">'s mark and sweep garbage</span>
<span style="color: #2aa198;">collection mechanism.</span>

<span style="color: #2aa198;">Some of the underlying methods are also available via the ObjectSpace module.</span>

<span style="color: #2aa198;">You may obtain information about the operation of the GC through GC::Profiler.</span>
<span style="color: #2aa198;">------------------------------------------------------------------------------</span>
<span style="color: #2aa198;">= Class methods:</span>

<span style="color: #2aa198;">  count, disable, enable, malloc_allocated_size, malloc_allocations, start,</span>
<span style="color: #2aa198;">  stat, stress, stress=</span>

<span style="color: #2aa198;">= Instance methods:</span>

<span style="color: #2aa198;">  garbage_collect</span>
</pre>
</div>
</li>
<li>ri + ClassName + method可以了解某个函数,如下(enable可以从上面的ri GC里面看
到, 是GC的一个Class method)
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ ri GC::enable
ri GC::enable
= GC::enable

<span style="color: #2aa198;">(</span>from ruby core<span style="color: #2aa198;">)</span>
------------------------------------------------------------------------------
  GC.enable    -&gt; true or false

------------------------------------------------------------------------------

Enables garbage collection, returning true if garbage collection was
previously disabled.

  GC.disable   <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; false</span>
  GC.enable    <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; true</span>
  GC.enable    <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; false</span>
</pre>
</div>
</li>
<li>如果ri后面跟的参数出现在多个class或者module里面,那么ri会把他们都列出来
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ ri assoc
ri assoc
= .assoc

<span style="color: #2aa198;">(</span>from ruby core<span style="color: #2aa198;">)</span>
=== Implementation from Array
------------------------------------------------------------------------------
  ary.assoc<span style="color: #2aa198;">(</span>obj<span style="color: #2aa198;">)</span>   -&gt; new_ary  or  nil

------------------------------------------------------------------------------

Searches through an array whose elements are also arrays comparing obj with
the first element of each contained array using obj.==.

Returns the first contained array that matches <span style="color: #2aa198;">(</span>that is, the first associated
array<span style="color: #2aa198;">)</span>, or nil if no match is found.

See also Array#rassoc

  s1 = <span style="color: #2aa198;">[</span> <span style="color: #2aa198;">"colors"</span>, <span style="color: #2aa198;">"red"</span>, <span style="color: #2aa198;">"blue"</span>, <span style="color: #2aa198;">"green"</span> <span style="color: #2aa198;">]</span>
  s2 = <span style="color: #2aa198;">[</span> <span style="color: #2aa198;">"letters"</span>, <span style="color: #2aa198;">"a"</span>, <span style="color: #2aa198;">"b"</span>, <span style="color: #2aa198;">"c"</span> <span style="color: #2aa198;">]</span>
  s3 = <span style="color: #2aa198;">"foo"</span>
  a  = <span style="color: #2aa198;">[</span> s1, s2, s3 <span style="color: #2aa198;">]</span>
  a.assoc<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"letters"</span><span style="color: #2aa198;">)</span>  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; [ "letters", "a", "b", "c" ]</span>
  a.assoc<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"foo"</span><span style="color: #2aa198;">)</span>      <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; nil</span>


<span style="color: #2aa198;">(</span>from ruby core<span style="color: #2aa198;">)</span>
=== Implementation from ENV
------------------------------------------------------------------------------
  ENV.assoc<span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span> -&gt; Array or nil

------------------------------------------------------------------------------

Returns an Array of the name and value of the environment variable with name
or nil if the name cannot be found.


<span style="color: #2aa198;">(</span>from ruby core<span style="color: #2aa198;">)</span>
=== Implementation from Hash
------------------------------------------------------------------------------
  hash.assoc<span style="color: #2aa198;">(</span>obj<span style="color: #2aa198;">)</span>   -&gt;  an_array  or  nil

------------------------------------------------------------------------------

Searches through the hash comparing obj with the key using ==. Returns
the key-value pair <span style="color: #2aa198;">(</span>two elements array<span style="color: #2aa198;">)</span> or nil if no match is found.  See
Array#assoc.

  h = <span style="color: #2aa198;">{</span><span style="color: #2aa198;">"colors"</span>  =&gt; <span style="color: #b58900;">[</span><span style="color: #2aa198;">"red"</span>, <span style="color: #2aa198;">"blue"</span>, <span style="color: #2aa198;">"green"</span><span style="color: #b58900;">]</span>,
       <span style="color: #2aa198;">"letters"</span> =&gt; <span style="color: #b58900;">[</span><span style="color: #2aa198;">"a"</span>, <span style="color: #2aa198;">"b"</span>, <span style="color: #2aa198;">"c"</span> <span style="color: #b58900;">]</span><span style="color: #2aa198;">}</span>
  h.assoc<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"letters"</span><span style="color: #2aa198;">)</span>  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; ["letters", ["a", "b", "c"]]</span>
  h.assoc<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"foo"</span><span style="color: #2aa198;">)</span>      <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">=&gt; nil</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Chapter 02: Ruby.new</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Ruby Is an Object-Oriented Language</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>ruby是"纯面向对象"语言.ruby中的一切东西都是对象.
</li>
<li>ruby中创建新的object的方法是new
<div class="org-src-container">

<pre class="src src-ruby">song1 = <span style="color: #b58900;">Song</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Ruby Tuesday"</span><span style="color: #2aa198;">)</span>
song2 = <span style="color: #b58900;">Song</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Enveloped in Python"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>上面的objec都来自于Song class. 但是他们都拥有自己的object ID,所以会被系统严
格区分
</li>
<li>ruby中每个对象都有自己的method, 因为一切皆对象,那么下面的例子就不那么难以理
解了
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"gin joint"</span>.length
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Rick"</span>.index<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"c"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> 42.even?
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">9                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Java也是面向对象语言,只不过不是"纯的", 所以我们在java中,求绝对值方法如下:
<div class="org-src-container">

<pre class="src src-java">num = Math.abs<span style="color: #2aa198;">(</span>num<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>而在ruby中,绝对值这个东西是"对象数字"自己的method
<div class="org-src-container">

<pre class="src src-ruby">num = -1234
<span style="color: #657b83; font-weight: bold;">puts</span> num.abs
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1234                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Some Basic Ruby</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>先介绍一个简单的ruby程序
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say_goodnight</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
  result = <span style="color: #2aa198;">"Good night"</span> + name
  <span style="color: #859900; font-weight: bold;">return</span> result
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Time for bed...</span>
<span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"John-Boy"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Mary-Ellen"</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Good nightJohn-Boy                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Good nightMary-Ellen                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Ruby有很多script语言的特性:
<ul class="org-ul">
<li>没有分号结尾
</li>
<li>#是单行comment
</li>
<li>indentation不是像python那样强制的,但是两个空格的indentation是社区公认的
</li>
<li>def 后面是函数名, 函数名后面使用括号括起来的是参数列表(但其实参数列表可以
没有括号,为了好看我们还是加了括号)
</li>
</ul>
</li>
<li>稍微难理解的是这里
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"John-Boy"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>这一行代码里面其实有两个函数(括号可以省略)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"John-Boy"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span><span style="color: #2aa198;">(</span>say_goodnight<span style="color: #b58900;">(</span><span style="color: #2aa198;">"John-Boy"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>ruby还有一个特殊的, 优化双引号字符串使用函数参数的做法,就是#{exp}在双引号里
面,会表示成exp
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say_goodnight</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
  result = <span style="color: #2aa198;">"Good night, </span><span style="color: #268bd2;">#{name}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">return</span> result
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'Pa'</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Good night, Pa                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>#{exp} 引入了string对象, 而string对象是有自己的method的, 所以,我们也可以很
容易的写出如下代码:将传入的人名首字母大写
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say_goodnight</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
  result = <span style="color: #2aa198;">"Good night, </span><span style="color: #268bd2;">#{name.capitalize}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">return</span> result
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'uncle'</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Good night, Uncle                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby不愧是脚本语言,怎么省事怎么来. ruby函数的最后一条语句就是要返回的语句,
所以连return都可以省略
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say_goodnight</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
  <span style="color: #2aa198;">"Good night, </span><span style="color: #268bd2;">#{name.capitalize}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> say_goodnight<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"ma"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Good night, Ma                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby在变量命名的时候,会根据不同的规则来确定变量的作用域
<ul class="org-ul">
<li>本地的1变量2函数名3函数参数,都必须是小写字母,或者下划线开头
</li>
<li>全局变量都以美元符($)开头
</li>
<li>实例变量(instance variable)都以(@)开头
</li>
<li>类变量(class variable)都以(@@)开头
</li>
<li>类名模块名常量都以大写字母开头
</li>
</ul>
</li>
<li>除了上面的要求,ruby在"语法"上面的变量定义就和其他语言一致了,但是ruby长期的
发展又出现了一些"习惯上"的命名规则:
<ul class="org-ul">
<li>instance variable如果是多个words的话,第一个word小写,后面的都要大写
</li>
<li>method name可能以?, ! = 结尾
</li>
</ul>
</li>
<li>下面就是一些常见的ruby变量命名举例
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">Local Variable</td>
<td class="left">name fish_and_chips x_axis thx1138 _x _26</td>
</tr>

<tr>
<td class="left">Instance Variable</td>
<td class="left">@name @point_1 @X @_ @plan9</td>
</tr>

<tr>
<td class="left">Class Variable</td>
<td class="left">@@total @@symtab @@N @@x_pos @@SINGLE</td>
</tr>

<tr>
<td class="left">Global Variable</td>
<td class="left">$debug #CUSTOMER $_ $plan9 $Global</td>
</tr>

<tr>
<td class="left">Class Name</td>
<td class="left">String ActiveRecord MyClass</td>
</tr>

<tr>
<td class="left">Constant Name</td>
<td class="left">FEET_PER_MILE DEBUG</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Arrays and Hashes</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>从某种意义上来说, 在ruby里面,由于其"一切皆对象"Array和Hash 都是indexed
Collection. 两者的区别在于:
<ul class="org-ul">
<li>Array是使用integer作为其key
</li>
<li>Hash是使用任意的object作为其key
</li>
</ul>
</li>
<li>创建Array的过程,没有使用new, 而是使用了一种叫做Array literal的方法(为了方便,
编译器特意定制的,python也一样)
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, <span style="color: #2aa198;">'cat'</span>, 3.14<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"The first element is </span><span style="color: #268bd2;">#{a[0]}</span><span style="color: #2aa198;">"</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">set the third element</span>
a<span style="color: #2aa198;">[</span>2<span style="color: #2aa198;">]</span> = <span style="color: #268bd2; font-weight: bold;">nil</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"The array is now </span><span style="color: #268bd2;">#{a.inspect}</span><span style="color: #2aa198;">"</span>
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The first element is 1                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The array is now [1, "cat", nil]               #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面的例子中使用到了nil, 在ruby中, nil也是一个对象", 只不过这个对象恰好"代
表nothing"
</li>
<li>有时候,使用''或者""创建word array很麻烦,所以ruby为了省事,还发明了%w, 注意%w
和{}之间没有空格
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span><span style="color: #2aa198;">'ant'</span>, <span style="color: #2aa198;">'bee'</span>, <span style="color: #2aa198;">'cat'</span>, <span style="color: #2aa198;">'dog'</span>, <span style="color: #2aa198;">'elk'</span><span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a<span style="color: #2aa198;">[</span>3<span style="color: #2aa198;">]</span>
a = <span style="color: #2aa198;">%w{ant bee cat dog elk}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a<span style="color: #2aa198;">[</span>3<span style="color: #2aa198;">]</span>
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ant                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dog                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ant                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dog                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>而对于hash来说,初始化的方法则是加入了一个=&gt;, =&gt; 左边是key,=&gt; 右边是value, 下
面就是一个初始化并打印hash内容的例子,需要知道的是,我们使用了p而不是puts来打
印(p是打印foo.inspect, 而puts是打印foo.to_s, 所以p foo就等于puts foo.to_s)
<div class="org-src-container">

<pre class="src src-ruby">inst_section = <span style="color: #2aa198;">{</span>
  <span style="color: #2aa198;">'cello'</span>      =&gt; <span style="color: #2aa198;">'string'</span>,
  <span style="color: #2aa198;">'clarinet'</span>   =&gt; <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #2aa198;">'drum'</span>       =&gt; <span style="color: #2aa198;">'percussion'</span>,
  <span style="color: #2aa198;">'oboe'</span>       =&gt; <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #2aa198;">'trumpet'</span>    =&gt; <span style="color: #2aa198;">'brass'</span>,
  <span style="color: #2aa198;">'violin'</span>     =&gt; <span style="color: #2aa198;">'string'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'oboe'</span><span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cello'</span><span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'bassoon'</span><span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"woodwind"                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"string"                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面例子中,我们的key不存在的情况下, value返回了nil,这个是默认行为,你也可以
把key不存在时候的返回值设置成0(这样在统计单词这种应用中,会有用武之地)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">default value is 0</span>
histogram = <span style="color: #b58900;">Hash</span>.new<span style="color: #2aa198;">(</span>0<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> histogram<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'ruby'</span><span style="color: #2aa198;">]</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">found one, add it to zero</span>
histogram<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'ruby'</span><span style="color: #2aa198;">]</span> = histogram<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'ruby'</span><span style="color: #2aa198;">]</span> + 1
<span style="color: #657b83; font-weight: bold;">puts</span> histogram<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'ruby'</span><span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Symbols</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>在很多其他更高级语言中,都有枚举这种类型, 其核心就是给一些整数一个容易辨别的
名字. 然后在代码中易于被认出,编译的时候出错对用户友好(相比define)
</li>
<li>ruby中直接设计了symbols&#x2013;&gt; 一个":" + 一个变量就是枚举了,你也不用挖空心思给
它们赋值. ruby保证他们全局唯一.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">walk</span><span style="color: #2aa198;">(</span>direction<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">if</span> direction == <span style="color: #268bd2; font-weight: bold;">:north</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Walking North"</span>
  <span style="color: #859900; font-weight: bold;">else</span> direction == <span style="color: #268bd2; font-weight: bold;">:south</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Walking South"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> walk<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:south</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Walking South                                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>既然枚举使用起来这么容易,那么hash里面使用枚举作为key就变得理所应当了(减少了
烦人的''的输入)
<div class="org-src-container">

<pre class="src src-ruby">inst_section = <span style="color: #2aa198;">{</span>
  <span style="color: #268bd2; font-weight: bold;">:cello</span> =&gt; <span style="color: #2aa198;">'string'</span>,
  <span style="color: #268bd2; font-weight: bold;">:clarinet</span> =&gt; <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #268bd2; font-weight: bold;">:drum</span> =&gt; <span style="color: #2aa198;">'percussion'</span>,
  <span style="color: #268bd2; font-weight: bold;">:oboe</span> =&gt; <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #268bd2; font-weight: bold;">:trumpet</span> =&gt; <span style="color: #2aa198;">'brass'</span>,
  <span style="color: #268bd2; font-weight: bold;">:violin</span> =&gt; <span style="color: #2aa198;">'string'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:oboe</span><span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #268bd2; font-weight: bold;">:cello</span><span style="color: #2aa198;">]</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Note that strings arn't the same as symbols...</span>
<span style="color: #657b83; font-weight: bold;">p</span> inst_section<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cello'</span><span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"woodwind"                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"string"                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>后来就默认使用symbol这种伪枚举来做hash的key了,那为了能让代码更少一点,ruby把
<p>
:sym =&gt; val 简化成了 sym: val
</p>
<div class="org-src-container">

<pre class="src src-ruby">inst_section = <span style="color: #2aa198;">{</span>
  <span style="color: #268bd2; font-weight: bold;">cello:</span>    <span style="color: #2aa198;">'string'</span>,
  <span style="color: #268bd2; font-weight: bold;">clarinet:</span> <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #268bd2; font-weight: bold;">drum:</span>     <span style="color: #2aa198;">'percussion'</span>,
  <span style="color: #268bd2; font-weight: bold;">oboe:</span>     <span style="color: #2aa198;">'woodwind'</span>,
  <span style="color: #268bd2; font-weight: bold;">trumpt:</span>   <span style="color: #2aa198;">'brass'</span>,
  <span style="color: #268bd2; font-weight: bold;">violin:</span>   <span style="color: #2aa198;">'string'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"An oboe is a </span><span style="color: #268bd2;">#{inst_section[:oboe]}</span><span style="color: #2aa198;"> instrument"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">An oboe is a woodwind instrument               #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Control Structures</h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li>在逻辑控制方面,ruby没有太大不同
<div class="org-src-container">

<pre class="src src-ruby">today = <span style="color: #b58900;">Time</span>.now

<span style="color: #859900; font-weight: bold;">if</span> today.saturday?
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Do chores around the house"</span>
<span style="color: #859900; font-weight: bold;">elsif</span> today.sunday?
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Relax"</span>
<span style="color: #859900; font-weight: bold;">else</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Go to work"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Go to work                                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>

<li>绝大多数的ruby语句都会有返回值(即便不明确的显示return,但是一个函数的最后一
个statement不就是返回值么), 我们可以利用返回值作为condition来控制while或者
if. 比如下面的例子中, gets函数会返回standard input里面的下一行(如果没有下一
行,那么就返回nil), line总是从gets得到值,如果一旦为nil,那么就彻底返回
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  <span style="color: #657b83; font-weight: bold;">puts</span> line.downcase
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>像python一样,同为脚本语言的ruby,如果if或者while只有一个condition的话,我们可
以把代码写成一行. 这就叫做statement modifier
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">if case ---------&gt;</span>
<span style="color: #859900; font-weight: bold;">if</span> radiation &gt; 3000
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Danger, Will Robinson"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rewrite using a statement modifier</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Danger, Will Robinson"</span> <span style="color: #859900; font-weight: bold;">if</span> radiation &gt; 3000

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">while case ------&gt;</span>
square = 4
<span style="color: #859900; font-weight: bold;">while</span> square &lt; 1000
  square = square * square
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rewrite using a statement modifier</span>
square = 4
square = square * square <span style="color: #859900; font-weight: bold;">while</span> square &lt; 1000
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Regular Expressions</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>脚本语言和高级语言的一大不同就是,脚本语言会在语言内部就支持正则表达式,这可
能和它们处理文本很多有关.
</li>
<li>ruby中,使用/pattern/的方法来表达正则表达式.下面是一些常用正则表达式举例
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">/\d\d:\d\d:\d\d/</span>     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">a time such as 12:34:56</span>
<span style="color: #2aa198;">/Perl.*Python/</span>       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Perl, zero or more other chars, then Python</span>
<span style="color: #2aa198;">/Perl Python/</span>        <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Perl, a space, and Python</span>
<span style="color: #2aa198;">/Perl *Python/</span>       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Perl, zero or more spaces, and Python</span>
<span style="color: #2aa198;">/Perl +Python/</span>       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Perl, one or more spaces, and Python</span>
<span style="color: #2aa198;">/Perl\s+Python/</span>      <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Perl, whitespace characters, then Python</span>
<span style="color: #2aa198;">/Ruby (Perl|Python)/</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Ruby, a space, and either Perl or Python</span>
</pre>
</div>
</li>
<li>Ruby还为正则表达式"专门"配备了一个操作符(=~), 如果一个变量能够包含(=~)右边
的表达式,那么整个式子返回匹配开始的位置
<div class="org-src-container">

<pre class="src src-ruby">line = <span style="color: #2aa198;">"MyPython"</span>

<span style="color: #657b83; font-weight: bold;">puts</span> line =~ <span style="color: #2aa198;">/Perl|Python/</span>

<span style="color: #859900; font-weight: bold;">if</span> line =~ <span style="color: #2aa198;">/Perl|Python/</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Scripting language mentioned: </span><span style="color: #268bd2;">#{line}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Scripting language mentioned: MyPython         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>还有强大的replace功能,这个和emacs的m-x replace-regexp是一个道理
<div class="org-src-container">

<pre class="src src-ruby">line = <span style="color: #2aa198;">"In old days, we had Perl and Python. Python is a new comer"</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">replace Perl with Ruby</span>
<span style="color: #657b83; font-weight: bold;">puts</span> line.sub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/Perl/</span>, <span style="color: #2aa198;">'Ruby'</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">replace Python with Ruby</span>
<span style="color: #657b83; font-weight: bold;">puts</span> line.gsub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/Python/</span>, <span style="color: #2aa198;">'Ruby'</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">replace Perl or Python with Ruby</span>
<span style="color: #657b83; font-weight: bold;">puts</span> line.gsub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/Perl|Python/</span>, <span style="color: #2aa198;">'Ruby'</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##############################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In old days, we had Ruby and Python. Python is a new comer #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In old days, we had Perl and Ruby. Ruby is a new comer     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In old days, we had Ruby and Ruby. Ruby is a new comer     #</span>
<span style="color: #93a1a1;">##############################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">Blocks and Iterators</h3>
<div class="outline-text-3" id="text-2-7">
<ul class="org-ul">
<li>code block这个概念在java中就有,就是{}包括的部分(Java还用这个特性实现了inner
class). 在ruby中, code block可以是两种:
<ul class="org-ul">
<li>do + end的组合
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">do</span>
  club.enroll<span style="color: #2aa198;">(</span>person<span style="color: #2aa198;">)</span>
  person.socialize
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>{} 包括的代码
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">{</span> <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Hello"</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</li>
<li>ruby的coding convention中, {}负责单行的code block, 而do-end负责多行的.
</li>
<li>code block很多时候是来负责和一个函数建立联系的(函数和block建立联系的这个过
程, 和参数传递类似,但不完全相同.理解为协程, coroutines更好,是一种相互之间交
换控制权的过程),比如如下:
<div class="org-src-container">

<pre class="src src-ruby">greet <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Hi"</span><span style="color: #2aa198;">}</span>
verbose_greet<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Dave"</span>, <span style="color: #2aa198;">"loyal customer"</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Hi"</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>和函数建立联系的好处是,可以在函数内部"yield"这些block
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">call_block</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Start of method"</span>
  <span style="color: #859900; font-weight: bold;">yield</span>
  <span style="color: #859900; font-weight: bold;">yield</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"End of method"</span>
<span style="color: #859900; font-weight: bold;">end</span>

call_block <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"In the block"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Start of method                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In the block                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In the block                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">End of method                                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>yield也是可以传递参数的
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">who_says_what</span>
  <span style="color: #859900; font-weight: bold;">yield</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Dave"</span>, <span style="color: #2aa198;">"hello"</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">yield</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Andy"</span>, <span style="color: #2aa198;">"goodbye"</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

who_says_what<span style="color: #2aa198;">{</span>|person, phrase| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{person}</span><span style="color: #2aa198;"> says </span><span style="color: #268bd2;">#{phrase}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Dave says hello                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Andy says goodbye                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>code block 和yield沾上了边, 而yield是构建ruby iterator的根基.使用code block
遍历Collection的方法如下. (也就是说each函数内部肯定有yield的部分)
<div class="org-src-container">

<pre class="src src-ruby">animals = <span style="color: #2aa198;">%w(ant bee cat dog)</span>
animals.each <span style="color: #2aa198;">{</span>|animal| <span style="color: #657b83; font-weight: bold;">puts</span> animal<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bee                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">cat                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dog                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>只要是这个函数内部调用了yield,那么这个函数就可以和code block结合起来,构建起
独特的ruby组合
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cat'</span>, <span style="color: #2aa198;">'dog'</span>, <span style="color: #2aa198;">'horse'</span><span style="color: #2aa198;">]</span>.each <span style="color: #2aa198;">{</span>|name| <span style="color: #657b83; font-weight: bold;">print</span> name, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>
5.times <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"*"</span><span style="color: #2aa198;">}</span>
3.upto<span style="color: #2aa198;">(</span>6<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|i| <span style="color: #657b83; font-weight: bold;">print</span> i<span style="color: #2aa198;">}</span>
<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'a'</span>..<span style="color: #2aa198;">'e'</span><span style="color: #2aa198;">)</span>.each <span style="color: #2aa198;">{</span>|char| <span style="color: #657b83; font-weight: bold;">print</span> char<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">cat dog horse *****3456abcde                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8">Reading and Riting</h3>
<div class="outline-text-3" id="text-2-8">
<ul class="org-ul">
<li>ruby的IO函数中常见的输出有:
<ul class="org-ul">
<li>puts 会有newline在最后
</li>
<li>print不会有newline在最后
</li>
<li>printf和C的相似
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">printf</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Number: %5.2f, \nString: %s\n"</span>, 1.23, <span style="color: #2aa198;">"hello"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Number:  1.23,                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">String: hello                                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>ruby中常见的读取函数就是gets啦,如果没有数据读入,那么gets就返回nil
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9">Command-Line Arguments</h3>
<div class="outline-text-3" id="text-2-9">
<ul class="org-ul">
<li>ruby当然可以读取命令行参数啦
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"You gave </span><span style="color: #268bd2;">#{ARGV.size}</span><span style="color: #2aa198;"> arguments"</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">ARGV</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Chapter 03: Classes, Objects, and Variables</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>ruby中一切都是对象,而对象都是从类中创建出来的.下面的一个例子的场景是,我们有
如下的一个CSV文件(包含书店中所有图书的信息),我们要对文件进行分析,最后得到我
们想要的系统
<pre class="example">
"Date", "ISBN", "Price"
"2013-04-12", "978-1-9343561-0-4", 39.45
"2013-04-13", "978-1-9343561-6-6", 45.67
"2013-04-14", "978-1-9343561-7-4", 36.15
</pre>
</li>
<li>我们面向对象编程,首先要找到对象,这些"库存的书"就是一个活生生的对象,我们叫做
BookInStock class, 其定义如下. 其中initialize是类似c++里面的ctor的作用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = <span style="color: #657b83; font-weight: bold;">Float</span><span style="color: #2aa198;">(</span>price<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>上面例子中的命名方式仿佛让我们回到了上一章, 类名是首字母大写的, 函数名是全小
写的, instance变量是加@的.
</li>
<li>isbn, price都是函数参数,而@isbn和@price则是instance variable.特别是@price的
创建过程,还调用Float的initialize,将其变成浮点数(如果转换失败就会报错退出)
</li>
<li>每个object创建出来都独一无二,因为都有自己的id
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = price
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

b1 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn1"</span>, 3<span style="color: #2aa198;">)</span>
b2 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn2"</span>, 3.14<span style="color: #2aa198;">)</span>
b3 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn3"</span>, <span style="color: #2aa198;">"5.67"</span><span style="color: #2aa198;">)</span>

<span style="color: #657b83; font-weight: bold;">puts</span> b1
<span style="color: #657b83; font-weight: bold;">puts</span> b2
<span style="color: #657b83; font-weight: bold;">puts</span> b3

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;BookInStock:0x007fce3b1292e0&gt;                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;BookInStock:0x007fce3b129290&gt;                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;BookInStock:0x007fce3b129218&gt;                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>puts 其实每次都是打印objec的to_s函数,如果我们能覆写to_s的话,会有更有意义的输
出
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = price
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    <span style="color: #2aa198;">"ISBN: </span><span style="color: #268bd2;">#{@isbn}</span><span style="color: #2aa198;">, price: </span><span style="color: #268bd2;">#{@price}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

b1 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn1"</span>, 3<span style="color: #2aa198;">)</span>
b2 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn2"</span>, 3.14<span style="color: #2aa198;">)</span>
b3 = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn3"</span>, <span style="color: #2aa198;">"5.67"</span><span style="color: #2aa198;">)</span>

<span style="color: #657b83; font-weight: bold;">puts</span> b1
<span style="color: #657b83; font-weight: bold;">puts</span> b2
<span style="color: #657b83; font-weight: bold;">puts</span> b3

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ISBN: isbn1, price: 3                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ISBN: isbn2, price: 3.14                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ISBN: isbn3, price: 5.67                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Objects and Attributes</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>上面例子中的@isbn和@price都是internal state, 他们是private的,不为外部所见的
这是OOP中封装的最基本要求.
</li>
<li>数据封装可以,但是如果所有数据都只能private的呆在class里面就毫无意义了,我们还
要设计一系列的接口.让外部能够看到某些我们允许它们看的数据, 当然我们可以像java
一样设计出很多的getter()
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">as previous</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">price</span>
    <span style="color: #268bd2;">@price</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>但是ruby是脚本语言,理应更加灵活从而减少代码量.所以ruby设计了symbols, 具体到
这里就是两个private变量的"外部可读性" (attr_reader:)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:isbn</span>, <span style="color: #268bd2; font-weight: bold;">:price</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = price
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>

book = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn1"</span>, 12.34<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"ISBN = </span><span style="color: #268bd2;">#{book.isbn}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price = </span><span style="color: #268bd2;">#{book.price}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ISBN = isbn1                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price = 12.34                                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>需要注意的是,这里attr_reader修饰的是:isbn,这个才是变量的name, 而isbn可以看
成是变量的值. 同时, attr_reader虽然经常写在第一位,但是却不是用来定义内部变量
的,它是用来生成访问函数的(实现机制在ruby内部)
</li>
<li>既然能够对getter进行symbol设计,那么setter当然也可以了.在ruby里面,setter叫做
attr_accesor
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span>   <span style="color: #268bd2; font-weight: bold;">:isbn</span>
  <span style="color: #657b83; font-weight: bold;">attr_accessor</span> <span style="color: #268bd2; font-weight: bold;">:price</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = price
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

book = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn1"</span>, 33.80<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"ISBN     = </span><span style="color: #268bd2;">#{book.isbn}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price    = </span><span style="color: #268bd2;">#{book.price}</span><span style="color: #2aa198;">"</span>
book.price = book.price * 0.75  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">discount price</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"New price = </span><span style="color: #268bd2;">#{book.price}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ISBN     = isbn1                               #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price    = 33.8                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">New price = 25.349999999999998                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Virtual Attributes</h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li>有时候我们需要一些其他的attribute, 比如这本书有多少分钱,其实和多少块钱是一
个意思,只不过需要转化一下,这种情况下再引入一个新的attribute是合乎语法的,但
是不太合理,所以我们就设计一种叫做virtual attribute的东西,它能被用户所使用
但是,却并不存在在我们的object的变量里面.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>

  <span style="color: #657b83; font-weight: bold;">attr_reader</span>   <span style="color: #268bd2; font-weight: bold;">:isbn</span>
  <span style="color: #657b83; font-weight: bold;">attr_accessor</span> <span style="color: #268bd2; font-weight: bold;">:price</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = <span style="color: #657b83; font-weight: bold;">Float</span><span style="color: #2aa198;">(</span>price<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">price_in_cents</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">add 0.5 to the 100 * price is because float number don't always</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">have exact internel representation</span>
    <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>price * 100 + 0.5<span style="color: #2aa198;">)</span>;
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">price_in_cents=</span><span style="color: #2aa198;">(</span>cents<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@price</span> = cents / 100.0
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

book = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"isbn1"</span>, 33.80<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price            = </span><span style="color: #268bd2;">#{book.price}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price in cents   = </span><span style="color: #268bd2;">#{book.price_in_cents}</span><span style="color: #2aa198;">"</span>
book.price_in_cents = 1234
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price            = </span><span style="color: #268bd2;">#{book.price}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Price in cents   = </span><span style="color: #268bd2;">#{book.price_in_cents}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price            = 33.8                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price in cents   = 3380                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price            = 12.34                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Price in cents   = 1234                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>在外界看来, price_in_cents就是活生生的一个attribute和其他的price, isbn一样,
但其实内部却没有对应的instance variable.这种情况叫做
<pre class="example">
Uniform Access Principle : By hiding the difference between instance
variable and calculated values, you are shielding the rest of the
world from the implementation of your class
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">Attributes, Instance Variables, and Methods</h4>
<div class="outline-text-4" id="text-3-1-2">
<ul class="org-ul">
<li>这三个概念很容易混淆:
<ul class="org-ul">
<li>设计类的时候,保护在内部不被外界看到的state,叫做instance variable
</li>
<li>能被外部看到的state,叫做attribute
</li>
<li>你的类的其他行为统一都叫做method
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Classes Working with Other Classes</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>下面我设计一个从csv里面读取数据的类CSV reader
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">CsvReader</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">read_in_csv_data</span><span style="color: #2aa198;">(</span>csv_file_name<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">total_value_in_stock</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">number_of_each_isbn</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Usage</span>
reader = <span style="color: #b58900;">CsvReader</span>.new
reader.read_in_csv_data<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"fil1.csv"</span><span style="color: #2aa198;">)</span>
reader.read_in_csv_data<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"fil2.csv"</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Total value in stock = </span><span style="color: #268bd2;">#{reader.total_value_in_stock}</span><span style="color: #2aa198;">"</span>
</pre>
</div>
</li>
<li>我们发现csv里面存储需要多个book的信息, 每个book的信息又可以通过BookInStock
这个class来存储,这样一来我们就有如下的代码结构:
<ul class="org-ul">
<li>book_in_stock.rb 负责定义BookInStock类
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:isbn</span>, <span style="color: #268bd2; font-weight: bold;">:price</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>isbn, price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@isbn</span> = isbn
    <span style="color: #268bd2;">@price</span> = <span style="color: #657b83; font-weight: bold;">Float</span><span style="color: #2aa198;">(</span>price<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>csv_reader.rb 负责定义CsvReader类
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'csv'</span>
<span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'book_in_stock'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">CsvReader</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #268bd2;">@books_in_stock</span> = <span style="color: #2aa198;">[]</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">read_in_csv_data</span><span style="color: #2aa198;">(</span>csv_file_name<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">CSV</span>.foreach<span style="color: #2aa198;">(</span>csv_file_name, <span style="color: #268bd2; font-weight: bold;">headers:</span> <span style="color: #268bd2; font-weight: bold;">true</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |row|
      <span style="color: #268bd2;">@books_in_stock</span> &lt;&lt; <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span>row<span style="color: #b58900;">[</span><span style="color: #2aa198;">"ISBN"</span><span style="color: #b58900;">]</span>, row<span style="color: #b58900;">[</span><span style="color: #2aa198;">"Price"</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">later we'll see hot to use inject to sum a collection</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">total_value_in_stock</span>
    sum = 0.0
    <span style="color: #268bd2;">@books_in_stock</span>.each <span style="color: #2aa198;">{</span>|book| sum += book.price<span style="color: #2aa198;">}</span>
    sum
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">number_of_each_isbn</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>stock_stats.rb 负责应用上面的两个类来真正的统计数据
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'csv_reader'</span>

reader = <span style="color: #b58900;">CsvReader</span>.new


<span style="color: #b58900;">ARGV</span>.each <span style="color: #859900; font-weight: bold;">do</span> |csv_file_name|
  <span style="color: #b58900;">STDERR</span>.puts <span style="color: #2aa198;">"Processing </span><span style="color: #268bd2;">#{csv_file_name}</span><span style="color: #2aa198;">"</span>
  reader.read_in_csv_data<span style="color: #2aa198;">(</span>csv_file_name<span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Total value =  </span><span style="color: #268bd2;">#{reader.total_value_in_stock}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;"># ruby stock_stats.rb data.csv                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Processing data.csv                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Total value =  122.07000000000001              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Access Control</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>OOP设计中的访问权限设计当然非常重要, 对于ruby来说,有如下几种:
<ul class="org-ul">
<li>Public method: 任何人都可以看到,调用这个函数(initialize例外，其永远是private的)
</li>
<li>Protected method: 只有自己的subclass才能看到
</li>
<li>Private method: 只有自己object内部才能使用(也就是只有依靠self来调用)
</li>
</ul>
</li>
<li>ruby和其他OO语言一个重要的区别是,上面的访问权限是动态的,在运行期可以改变的
</li>
</ul>
</div>
<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1">Specifying Access Control</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>Ruby 提供了两种access control的方式:
<ul class="org-ul">
<li>类Java/C++式
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">MyClass</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method1</span>                   <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">default is 'public'</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">protected</span>                     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">subsequent method will be 'protected'</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method2</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">private</span>                       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">subsequent methods will be 'private'</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method3</span>                   <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">will be 'private'</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">public</span>                        <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">subsequent methods will be 'public'</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method4</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>ruby 直接的accessor方式
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">MyClass</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method1</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method2</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">... and so an</span>

  <span style="color: #657b83; font-weight: bold;">public</span>      <span style="color: #268bd2; font-weight: bold;">:method1</span>, <span style="color: #268bd2; font-weight: bold;">:method2</span>
  <span style="color: #657b83; font-weight: bold;">protected</span>   <span style="color: #268bd2; font-weight: bold;">:method2</span>
  <span style="color: #657b83; font-weight: bold;">private</span>     <span style="color: #268bd2; font-weight: bold;">:method3</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</li>
<li>前面讲到过一个instance variable可以被标记为"可读,可写",其实背地里为你创建
getter和setter, 而这里虽然也用到了accessor,但是其实是设置访问权限.两者结合
的例子如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Account</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span>  <span style="color: #268bd2; font-weight: bold;">:cleared_balance</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">accessor method 'cleared_balance'</span>
  <span style="color: #657b83; font-weight: bold;">protected</span>    <span style="color: #268bd2; font-weight: bold;">:cleared_balance</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">but make it proteced</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">greater_balance_than?</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@cleared_balance</span> &gt; other.cleared_balance
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Variables</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>ruby 什么都是object,就变量不是&#x2026;因为变量其实是对象的一个reference. 所有的
对象在ruby中都是存放在headp中的(至少绝大部分时间是的).变量只是在stack中,不
过指向heap罢了. 这个和java是一样的
</li>
<li>但是注意,下面是和java不一样的地方:
<pre class="example">
Unlike Java, Ruby strings are mutable!
</pre>
</li>
<li>下面就是利用ruby字符串的可变性来进行的一个小试验
<div class="org-src-container">

<pre class="src src-ruby">person1 = <span style="color: #2aa198;">"Tim"</span>
person2 = person1
person1<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'J'</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"person1 is </span><span style="color: #268bd2;">#{person1}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"person2 is </span><span style="color: #268bd2;">#{person2}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">person1 is Jim                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">person2 is Jim                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们从这个试验中可以看到"赋值符号(=)"是把对象和变量联系起来的手段, 把person1
赋给person2的过程中,没有创造新的object,只不过是"两个指针指向了同一块内存"这
种赋值方式和java是"完全一样的"!
</li>
<li>java中,如果想创造新的object,那么就要clone,而ruby中的方案是dup
<div class="org-src-container">

<pre class="src src-ruby">person1 = <span style="color: #2aa198;">"Tim"</span>
person2 = person1.dup
person1<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'J'</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"person1 is </span><span style="color: #268bd2;">#{person1}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"person2 is </span><span style="color: #268bd2;">#{person2}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">person1 is Jim                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">person2 is Tim                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby还可以使用freeze来防止别人更改你的object.注意是常量化了object.变量还是
可以指向其他object,但是标记过freeze的object无法被改变了
<div class="org-src-container">

<pre class="src src-ruby">person1 = <span style="color: #2aa198;">"Tim"</span>
person2 = person1
person1.freeze
person1 = <span style="color: #2aa198;">"Jim"</span>

<span style="color: #657b83; font-weight: bold;">puts</span> person1
<span style="color: #657b83; font-weight: bold;">puts</span> person2

person2<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">"J"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Jim                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Tim                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">RuntimeError: can't modify frozen String       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">//....                                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Chapter 04: Containers, Blocks, and Iterators</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Arrays</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Array的创建可以是通过常规的new,或者是直接[]加内容
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>3.14159, <span style="color: #2aa198;">"pie"</span>, 99<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a.class
<span style="color: #657b83; font-weight: bold;">p</span> a.length
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>2<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>3<span style="color: #2aa198;">]</span>

b = <span style="color: #b58900;">Array</span>.new
<span style="color: #657b83; font-weight: bold;">p</span> b.class
<span style="color: #657b83; font-weight: bold;">p</span> b.length
b<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">"second"</span>
b<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">"array"</span>
<span style="color: #657b83; font-weight: bold;">p</span> b

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Array                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3.14159                                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"pie"                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">99                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Array                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["second", "array"]                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Array可说的最重要的部分就是其[] operator, 这个显然是一个函数,机制应该和c++
里面的operator[]相似. 在ruby中[]的功能无限的灵活:
<ul class="org-ul">
<li>可以引用负数的index,最后一个成员的index用负数表示就是-1 (这样就和0连起来了撒)
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-1<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-2<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-99<span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">9                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">7                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>子数组这个概念也可以靠[start, count]完成, 注意,第二个参数是count,不是end
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>1, 3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>3, 1<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-3, 2<span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[3, 5, 7]                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[7]                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[5, 7]                                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果你想要[start, end]的效果,那么ruby其实是用的[start..end], 注意这是两
个点. 三个点也有, 其效果是[start, end), 你懂的
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>1..3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>1...3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>3..3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>3...3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-3..-1<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a<span style="color: #2aa198;">[</span>-3...-1<span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[3, 5, 7]                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[3, 5]                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[7]                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[]                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[5, 7, 9]                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[5, 7]                                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>[] operator还衍生出了[]= operator,可以让你给数组成员赋值的
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a

a<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'bat'</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>-3<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'cat'</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>3<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">[</span>9, 8<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>6<span style="color: #2aa198;">]</span> = 99
<span style="color: #657b83; font-weight: bold;">p</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 3, 5, 7, 9]                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, "bat", 5, 7, 9]                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, "bat", "cat", 7, 9]                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, "bat", "cat", [9, 8], 9]                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, "bat", "cat", [9, 8], 9, nil, 99]          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>[]= operator也可以使用两参数,和[]operator一样. 两个参数的赋值就和一个参数
的不太一样, 如果认真看会发现[]=的右边被当作了一个数组"参与"到左边的数组里面,比
如a[1, 1] = [9, 8, 7], 是把1到2这个区间换成另外的三个值(9,8,7), 而如果是
a= [9, 8, 7], 那么就是成员1从一个数字,变成了一个数组
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>2, 2<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'cat'</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>2, 0<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'dog'</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>1, 1<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">[</span>9, 8, 7<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>0..3<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">[]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a
a<span style="color: #2aa198;">[</span>5..6<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">[]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 3, 5, 7, 9]                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 3, "cat", 9]                               #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 3, "dog", "cat", 9]                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 9, 8, 7, "dog", "cat", 9]                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["dog", "cat", 9]                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["dog", "cat", 9, nil, nil]                    #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>由于数组的极端灵活性,你完全可以把它当作是一个stack
<div class="org-src-container">

<pre class="src src-ruby">stack = <span style="color: #2aa198;">[]</span>
stack.push <span style="color: #2aa198;">"red"</span>
stack.push <span style="color: #2aa198;">"green"</span>
stack.push <span style="color: #2aa198;">"blue"</span>

<span style="color: #657b83; font-weight: bold;">p</span> stack

<span style="color: #657b83; font-weight: bold;">p</span> stack.pop
<span style="color: #657b83; font-weight: bold;">p</span> stack.pop
<span style="color: #657b83; font-weight: bold;">p</span> stack.pop
<span style="color: #657b83; font-weight: bold;">p</span> stack

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["red", "green", "blue"]                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"blue"                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"green"                                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"red"                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[]                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>push和shift的组合,又能把数组当作是一个queue
<div class="org-src-container">

<pre class="src src-ruby">queue = <span style="color: #2aa198;">[]</span>
queue.push <span style="color: #2aa198;">"red"</span>
queue.push <span style="color: #2aa198;">"green"</span>
<span style="color: #657b83; font-weight: bold;">p</span> queue.shift
<span style="color: #657b83; font-weight: bold;">p</span> queue.shift

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"red"                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"green"                                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>还有first和last函数来取得最开头和最结尾,但是不移除
<div class="org-src-container">

<pre class="src src-ruby">array = <span style="color: #2aa198;">[</span>1, 2, 3, 4, 5, 6, 7<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> array.first<span style="color: #2aa198;">(</span>4<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> array.last<span style="color: #2aa198;">(</span>4<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4]                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[4, 5, 6, 7]                                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Hashes</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>Array是以integer作为index,而Hash则是以object作为index.
<div class="org-src-container">

<pre class="src src-ruby">h = <span style="color: #2aa198;">{</span><span style="color: #2aa198;">'dog'</span> =&gt; <span style="color: #2aa198;">'canine'</span>, <span style="color: #2aa198;">'cat'</span> =&gt; <span style="color: #2aa198;">'feline'</span>, <span style="color: #2aa198;">'donkey'</span> =&gt; <span style="color: #2aa198;">'asinine'</span><span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> h
<span style="color: #657b83; font-weight: bold;">p</span> h.length
<span style="color: #657b83; font-weight: bold;">p</span> h<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'dog'</span><span style="color: #2aa198;">]</span>

h<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cow'</span><span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'bovine'</span>
h<span style="color: #2aa198;">[</span>12<span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'dodecine'</span>

h<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cat'</span><span style="color: #2aa198;">]</span> = 99
<span style="color: #657b83; font-weight: bold;">p</span> h

<span style="color: #93a1a1;">###########################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">{"dog"=&gt;"canine", "cat"=&gt;"feline", "donkey"=&gt;"asinine"} #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"canine"                                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">{"dog"=&gt;"canine", "cat"=&gt;99, "donkey"=&gt;"asinine",\      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"cow"=&gt;"bovine", 12=&gt;"dodecine"}                        #</span>
<span style="color: #93a1a1;">###########################################################</span>
</pre>
</div>
</li>
<li>从1.9开始,symbol作为hash的index的情况下,可以简化hash的创建
<div class="org-src-container">

<pre class="src src-ruby">h = <span style="color: #2aa198;">{</span><span style="color: #268bd2; font-weight: bold;">:dog</span> =&gt; <span style="color: #2aa198;">'canine'</span>, <span style="color: #268bd2; font-weight: bold;">:cat</span> =&gt; <span style="color: #2aa198;">'feline'</span>, <span style="color: #268bd2; font-weight: bold;">:donkey</span> =&gt; <span style="color: #2aa198;">'asinine'</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>更近一步的,你可以放弃=&gt;, 让代码更简洁(是的,ruby就是有这么多做事情的方法)
<div class="org-src-container">

<pre class="src src-ruby">h = <span style="color: #2aa198;">{</span><span style="color: #268bd2; font-weight: bold;">dog:</span> <span style="color: #2aa198;">'canine'</span>, <span style="color: #268bd2; font-weight: bold;">cat:</span> <span style="color: #2aa198;">'feline'</span>, <span style="color: #268bd2; font-weight: bold;">donkey:</span> <span style="color: #2aa198;">'asinine'</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>ruby的hash有自己的重要特性(不同于hash的学术定义):
<pre class="example">
Ruby remembers the order in which you add items to hash
</pre>
</li>
</ul>
</div>
<div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1">Word Frequency: Using Hashes and Arrays</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>下面我们实现一个小的程序,目的是从一个文章中找出每个单词出现的次数
</li>
<li>第一步,我们先将文章token化, scan是将字符串按照给定pattern进行切割,然后返回
数组, 这里的[\w']的意思是,所有的char以及单引号(did'nt里面就有):
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">words_from_string</span><span style="color: #2aa198;">(</span>string<span style="color: #2aa198;">)</span>
  string.downcase.scan<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/[\w']+/</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">p</span> words_from_string<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"But I didn't inhale, he said (emphatically)"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["but", "i", "didn't", "inhale", "he", "said", "emphatically"] #</span>
<span style="color: #93a1a1;">##################################################################</span>
</pre>
</div>
</li>
<li>下一步就是对这个数组里面的数进行次数的统计, 利用了Hash可以使用任何object作
为index的功能,把每个word作为一个index, 并且初始化每个word为0
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">count_frequency</span><span style="color: #2aa198;">(</span>word_list<span style="color: #2aa198;">)</span>
  counts = <span style="color: #b58900;">Hash</span>.new<span style="color: #2aa198;">(</span>0<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">for</span> word <span style="color: #859900; font-weight: bold;">in</span> word_list
    counts<span style="color: #2aa198;">[</span>word<span style="color: #2aa198;">]</span> += 1
  <span style="color: #859900; font-weight: bold;">end</span>
  counts
<span style="color: #859900; font-weight: bold;">end</span>


<span style="color: #657b83; font-weight: bold;">p</span> count_frequency<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"sparky"</span>, <span style="color: #2aa198;">"the"</span>, <span style="color: #2aa198;">"cat"</span>, <span style="color: #2aa198;">"sat"</span>, <span style="color: #2aa198;">"on"</span>, <span style="color: #2aa198;">"the"</span>, <span style="color: #2aa198;">"mat"</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">you can see the order is the same with the one you add them to hash</span>
<span style="color: #93a1a1;">##################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">{"sparky"=&gt;1, "the"=&gt;2, "cat"=&gt;1, "sat"=&gt;1, "on"=&gt;1, "mat"=&gt;1} #</span>
<span style="color: #93a1a1;">##################################################################</span>
</pre>
</div>
</li>
<li>剩下最后一步,就是按照频率高低把结果排序并打印. 注意这里sort_by是先分割|word,
count|, 然后按照某个顺序count排序(这里是hash才有|word, count|,如果只是个数
组sort_by的话,可能只需要|word|)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">"words_from_string.rb"</span>
<span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">"count_frequency.rb"</span>

raw_text  = <span style="color: #2aa198;">%{The problem breaks down into two parts. First, given some text</span>
<span style="color: #2aa198;">as a string, return a list of words. That sounds like an array. Then, build</span>
<span style="color: #2aa198;">a count for each distinct word. That sounds like a use for a hash---we can</span>
<span style="color: #2aa198;">index it with the word and use the corresponding entry to keep a count.}</span>

word_list = words_from_string<span style="color: #2aa198;">(</span>raw_text<span style="color: #2aa198;">)</span>
counts    = count_frequency<span style="color: #2aa198;">(</span>word_list<span style="color: #2aa198;">)</span>
sorted    = counts.sort_by <span style="color: #2aa198;">{</span>|word, count| count<span style="color: #2aa198;">}</span>
top_five  = sorted.last<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">This is ugly code, will improve later</span>
<span style="color: #859900; font-weight: bold;">for</span> i <span style="color: #859900; font-weight: bold;">in</span> 0...5
  word = top_five<span style="color: #2aa198;">[</span>i<span style="color: #2aa198;">][</span>0<span style="color: #2aa198;">]</span>
  count = top_five<span style="color: #2aa198;">[</span>i<span style="color: #2aa198;">][</span>1<span style="color: #2aa198;">]</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{word}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{count}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">that: 2                                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">sounds: 2                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">like: 2                                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">the: 3                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">a: 6                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面我们就成功创建了一个计数程序,下面我们要对程序进行测试. ruby本身就自带
一个单元测试框架,一个测试用例来测试words_from_string的写法如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'words_from_string'</span>
<span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'test/unit'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TestWordsFromString</span> &lt; <span style="color: #b58900;">Test</span>::<span style="color: #b58900;">Unit</span>::<span style="color: #b58900;">TestCase</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_empty_string</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[]</span>, words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">""</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[]</span>, words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">"   "</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_single_word</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"cat"</span><span style="color: #b58900;">]</span>, words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">"cat"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"cat"</span><span style="color: #b58900;">]</span>, words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">"   cat  "</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_many_words</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"the"</span>, <span style="color: #2aa198;">"cat"</span>, <span style="color: #2aa198;">"sat"</span>, <span style="color: #2aa198;">"on"</span>, <span style="color: #2aa198;">"the"</span>,<span style="color: #2aa198;">"mat"</span><span style="color: #b58900;">]</span>,
                 words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">"the cat sat on the mat"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_ignores_punctuation</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"the"</span>, <span style="color: #2aa198;">"cat's"</span>, <span style="color: #2aa198;">"mat"</span><span style="color: #b58900;">]</span>,
                 words_from_string<span style="color: #b58900;">(</span><span style="color: #2aa198;">"&lt;the!&gt; cat's, -mat"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##########################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Run options:                                                           #</span>
<span style="color: #93a1a1;">#                                                                        </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;"># Running tests:                                                       #</span>
<span style="color: #93a1a1;">#                                                                        </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Finished tests in 0.005396s, 741.2898 tests/s, 1111.9348 assertions/s. #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4 tests, 6 assertions, 0 failures, 0 errors, 0 skips                   #</span>
<span style="color: #93a1a1;">#                                                                        </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ruby -v: ruby 2.0.0p247 (2013-06-27 revision 41674) \                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[universal.x86_64-darwin13]                                            #</span>
<span style="color: #93a1a1;">##########################################################################</span>
</pre>
</div>
</li>
<li>下面是测试函数count_frequency的代码
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'count_frequency'</span>
<span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'test/unit'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TestCountFrequencey</span> &lt; <span style="color: #b58900;">Test</span>::<span style="color: #b58900;">Unit</span>::<span style="color: #b58900;">TestCase</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_empty_list</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">{}</span>, count_frequency<span style="color: #b58900;">(</span><span style="color: #268bd2;">[]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_single_word</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">{</span><span style="color: #2aa198;">"cat"</span> =&gt; 1<span style="color: #b58900;">}</span>, count_frequency<span style="color: #b58900;">(</span><span style="color: #268bd2;">[</span><span style="color: #2aa198;">"cat"</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_two_different_words</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">{</span><span style="color: #2aa198;">"cat"</span> =&gt; 2, <span style="color: #2aa198;">"sat"</span> =&gt; 1<span style="color: #b58900;">}</span>,
                 count_frequency<span style="color: #b58900;">(</span><span style="color: #268bd2;">[</span><span style="color: #2aa198;">"cat"</span>, <span style="color: #2aa198;">"cat"</span>, <span style="color: #2aa198;">"sat"</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_two_words_with_non_adjacent_repeat</span>
    assert_equal<span style="color: #2aa198;">(</span><span style="color: #b58900;">{</span><span style="color: #2aa198;">"cat"</span> =&gt; 2, <span style="color: #2aa198;">"sat"</span> =&gt; 1<span style="color: #b58900;">}</span>,
                 count_frequency<span style="color: #b58900;">(</span><span style="color: #268bd2;">[</span><span style="color: #2aa198;">"cat"</span>, <span style="color: #2aa198;">"sat"</span>, <span style="color: #2aa198;">"cat"</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">#########################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Run options:                                                          #</span>
<span style="color: #93a1a1;">#                                                                       </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;"># Running tests:                                                      #</span>
<span style="color: #93a1a1;">#                                                                       </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Finished tests in 0.006311s, 633.8140 tests/s, 633.8140 assertions/s. #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4 tests, 4 assertions, 0 failures, 0 errors, 0 skips                  #</span>
<span style="color: #93a1a1;">#                                                                       </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ruby -v: ruby 2.0.0p247 (2013-06-27 revision 41674)\                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[universal.x86_64-darwin13]                                           #</span>
<span style="color: #93a1a1;">#########################################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Blocks and Iterators</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>上面我的例子中,有这么一段遍历并打印数组的代码
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">for</span> <span style="color: #859900; font-weight: bold;">in</span> <span style="color: #859900; font-weight: bold;">in</span> 0..4
  word = top_five<span style="color: #2aa198;">[</span>i<span style="color: #2aa198;">][</span>0<span style="color: #2aa198;">]</span>
  count = top_five<span style="color: #2aa198;">[</span>i<span style="color: #2aa198;">][</span>1<span style="color: #2aa198;">]</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{word}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{count}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>从传统高级语言看来,这段代码没有什么问题. 但是问题就出在,对于ruby来说,它太麻
烦了. 由于Array和Hash是仅有的两种Collection,而且数组和遍历的关系是如此的紧
密,所以ruby专门又对数组的遍历,做了简化
<div class="org-src-container">

<pre class="src src-ruby">top_five.each <span style="color: #859900; font-weight: bold;">do</span> |word, count|
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{word}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{count}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>上面例子中的each就是ruby简化的手段: iterator + code block, 你可能第一时间问
"哪里有code block?", 回想我们对code block进行学习的第二章. code block可以以
两种形式出现:
<ul class="org-ul">
<li>do + end的组合, 上个例子each后面,恰恰是do&#x2026;.end. 通常在多行的情况下使用
</li>
<li>{} 包括的代码, 这种情况其实也有iterator的实例代码. 通常在单行的情况下使用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> top_five.map <span style="color: #2aa198;">{</span> |word, count| <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{word}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{count}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1">Blocks</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>上面两个例子中,均出现了|word, count|的组合, 这是因为ruby把code block看作是
一个method, 而一个method也就必然会有输入参数, |word, count|就是输入的参数.
为了更好的理解这个问题,我们可以再次的把介绍code block时候的一段代码写出来
来更好的理解iterator + code block的行为.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">who_says_what</span>
  <span style="color: #859900; font-weight: bold;">yield</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Dave"</span>, <span style="color: #2aa198;">"hello"</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">yield</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Andy"</span>, <span style="color: #2aa198;">"goodbye"</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

who_says_what<span style="color: #2aa198;">{</span>|person, phrase| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{person}</span><span style="color: #2aa198;"> says </span><span style="color: #268bd2;">#{phrase}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Dave says hello                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Andy says goodbye                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>

<li>其实从另一个角度上来说,我们可以把do + end里面或者{}里面的数据都看成一个大
的参数,传递给iterator method
</li>
<li>ruby在设计iterarot的时候,虽然灵活,但是会有一些意想不到的问题,比如下面这个例子
<div class="org-src-container">

<pre class="src src-ruby">sum = 0
<span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |value|
  square = value * value
  sum += square
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> sum

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">30                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们在循环里面把结果存在了一个叫做sum的变量里面.这个sum是前面定义过的一个
变量. 也就是说,如果在code block里面出现了一个变量,之前使用过的话,那么我们
使用的,就还是那个变量.这样非常不好!因为这里sum没有其他用处,但是却可能在其他
的例子中sum本来指向另外的数据.而你在each的block里面使用了sum,把它的默认值
给取消了.
</li>
<li>ruby的回答是:
<pre class="example">
        在code block里面请只使用定义在||之间的变量,他们是local的,
        跟全局的其他变量不会有关联
</pre>
</li>
<li>我们来看看两个应对的方法:
<ul class="org-ul">
<li>||里面的参数,重名没关系
<div class="org-src-container">

<pre class="src src-ruby">value = <span style="color: #2aa198;">"some shape"</span>
<span style="color: #2aa198;">[</span>1, 2<span style="color: #2aa198;">]</span>.each <span style="color: #2aa198;">{</span>|value| <span style="color: #657b83; font-weight: bold;">puts</span> value<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>除了||里面的已有参数,如果实在还需要其他的参数,请也写到||里面,用分号和"正
规参数"隔离开. 这里还是使用了sum, 这个没办法,因为我们要统计总和.
<div class="org-src-container">

<pre class="src src-ruby">square = <span style="color: #2aa198;">"some shape"</span>

sum = 0
<span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |value; square|
  square = value * value
  sum += square
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> sum
<span style="color: #657b83; font-weight: bold;">puts</span> square

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">30                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">some shape                                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2">Implementing Iterators</h4>
<div class="outline-text-4" id="text-4-3-2">
<ul class="org-ul">
<li>能够让code block 多次运行的这种函数,我们叫做iterator
</li>
<li>iterator行起来的时候,让后面的code block感觉自己也是iterator函数的一部分.这
种功能依靠的是yield
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">two_times</span>
  <span style="color: #859900; font-weight: bold;">yield</span>
  <span style="color: #859900; font-weight: bold;">yield</span>
<span style="color: #859900; font-weight: bold;">end</span>

two_times <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Hello"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Hello                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Hello                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>最著名的iterator选手each, 执行的时候,还可以传参数的.其原理如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">fib_up_to</span><span style="color: #2aa198;">(</span>max<span style="color: #2aa198;">)</span>
  i1, i2 = 1, 1
  <span style="color: #859900; font-weight: bold;">while</span> i1 &lt;= max
    <span style="color: #859900; font-weight: bold;">yield</span> i1
    i1, i2 = i2, i1 + i2
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>


fib_up_to<span style="color: #2aa198;">(</span>1000<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> |f| <span style="color: #657b83; font-weight: bold;">print</span> f, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>each是最简单,也是最根基的iterator, array和hash都有each, 对于array的iterator
来说,其功能非常简单:就是打印数组成员
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>.each <span style="color: #2aa198;">{</span>|i| <span style="color: #657b83; font-weight: bold;">puts</span> i<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">7                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">9                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>each是很多功能的基石,所以你自己创造class的时候,如果能加上一个each,那么会自
然的增加很多功能.比如array的find功能就是以each为基础构造的, 先来看看find如
何使用.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>.find <span style="color: #2aa198;">{</span>|v| v * v &gt; 30<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">7                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们可以自己重新实现一遍find,对的,你没有看错,ruby可以更改内置函数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Array</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">my_find</span>
    each <span style="color: #859900; font-weight: bold;">do</span> |value|
      <span style="color: #859900; font-weight: bold;">return</span> 100 + value  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900; font-weight: bold;">yield</span><span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">end</span>
    <span style="color: #268bd2; font-weight: bold;">nil</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7, 9<span style="color: #2aa198;">]</span>.my_find <span style="color: #2aa198;">{</span>|v| v * v &gt; 30<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">107                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>从上面的实现我们可以看出. code block的返回值(也就是最后一行) v * v 会返回给
yield函数,作为其参数.所以上面才能使用if yield(value)的结构
</li>
<li>另外一个经常使用的iterator就是collect(另外一个名字叫做map), 它的行为也很特
别:
<ul class="org-ul">
<li>首先把collection里面的每一个参数的值赋给code block
</li>
<li>然后再把每一次code block的返回值都记录起来,组成一个array返回
</li>
<li>例子如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"H"</span>, <span style="color: #2aa198;">"A"</span>, <span style="color: #2aa198;">"L"</span><span style="color: #2aa198;">]</span>.collect <span style="color: #2aa198;">{</span>|x| x.succ<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["I", "B", "M"]                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>iterator既可以处理数组,同时还可以处理文件(其实就是class File也实现了each函
数)
<div class="org-src-container">

<pre class="src src-ruby">f = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile.txt"</span><span style="color: #2aa198;">)</span>
f.each <span style="color: #859900; font-weight: bold;">do</span> |line|
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"The line is: </span><span style="color: #268bd2;">#{line}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>
f.close

<span style="color: #93a1a1;">#################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/misc &gt;&gt;&gt; ruby tut_iterator.rb  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: The line is: This is line one                    #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: The line is: This is line two                    #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: The line is: This is line three                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: The line is: And so on...                        #</span>
<span style="color: #93a1a1;">#################################################################</span>
</pre>
</div>
</li>
<li>each函数的缺点是没有index,无法知道序列号. ruby的应对是,each的"子函数"==&gt;
with_index. 当你需要序列号的时候,再引入它
<div class="org-src-container">

<pre class="src src-ruby">f = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile.txt"</span><span style="color: #2aa198;">)</span>
f.each.with_index <span style="color: #859900; font-weight: bold;">do</span> |line, index|
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Line </span><span style="color: #268bd2;">#{index}</span><span style="color: #2aa198;"> is: </span><span style="color: #268bd2;">#{line}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>
f.close

<span style="color: #93a1a1;">##################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/misc &gt;&gt;&gt; ruby tut_iter_index.rb #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Line 0 is: The line is: This is line one                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Line 1 is: The line is: This is line two                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Line 2 is: The line is: This is line three                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Line 3 is: The line is: And so on...                           #</span>
<span style="color: #93a1a1;">##################################################################</span>
</pre>
</div>
</li>
<li>还有一些很有用(也很麻烦)的iterator, 比如inject
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7<span style="color: #2aa198;">]</span>.inject<span style="color: #2aa198;">(</span>0<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|sum, element| sum + element<span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7<span style="color: #2aa198;">]</span>.inject<span style="color: #2aa198;">(</span>1<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|product, element| product * element<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">16                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">105                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>inject有两个参数|first,second|:
<ul class="org-ul">
<li>第一次进入code block的时候,first会被设置为inject函数括号里面的数字,而second
则是前面数组里面的第一个成员
</li>
<li>第N次以后进入code block的时候,first会被设置为上次code block的返回值,而
second会被设置为数组里面的第N个成员
</li>
</ul>
</li>
<li>值得注意的是,如果inject函数没有参数的话,那么|first, second|里面的first就会
采用数组里面的第一个成员,然后second从第二个成员开始轮换.所以上面的例子可以
改写成
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1,3, 5, 7<span style="color: #2aa198;">]</span>.inject <span style="color: #2aa198;">{</span>|sum, element| sum + element<span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1,3, 5, 7<span style="color: #2aa198;">]</span>.inject <span style="color: #2aa198;">{</span>|product, element| product * element<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">16                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">105                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby对简短代码的苛求没有限制,上面的例子还能更进一步的简化成如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7<span style="color: #2aa198;">]</span>.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:+</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 3, 5, 7<span style="color: #2aa198;">]</span>.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:*</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">16                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">105                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3">Enumerators&#x2013;External Iterators</h4>
<div class="outline-text-4" id="text-4-3-3">
<ul class="org-ul">
<li>让我们先来回顾一下ruby的循环策略:ruby中的循环依赖的都是iterator函数,他们和
其他class函数没有区别,只不过碰巧内部调用了yield而已.
</li>
<li>在其他语言中,每个类自己并不拥有自己的iterator(比如java,它是自己创建iterator
对象,通过iterator interface,来完成从头到尾的循环工作)
</li>
<li>但是iterator在class内部的这个方法也不是最好的.因为有很多种情况下必须要使用
外部的iterator:
<ul class="org-ul">
<li>比如,你要把iterator当作一个object传递给某个函数
</li>
<li>再比如,ruby内置iterator的方法,很难遍历两个collection
</li>
</ul>
</li>
<li>为了应对这种困境, ruby发明了built-in的Enumerator类
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, <span style="color: #2aa198;">"cat"</span><span style="color: #2aa198;">]</span>
h = <span style="color: #2aa198;">{</span><span style="color: #268bd2; font-weight: bold;">dog:</span> <span style="color: #2aa198;">"canine"</span>, <span style="color: #268bd2; font-weight: bold;">fox:</span> <span style="color: #2aa198;">"vulpine"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Create Enumerators</span>

enum_a = a.to_enum
enum_h = h.to_enum

<span style="color: #657b83; font-weight: bold;">p</span> enum_a.next
<span style="color: #657b83; font-weight: bold;">p</span> enum_h.next
<span style="color: #657b83; font-weight: bold;">p</span> enum_a.next
<span style="color: #657b83; font-weight: bold;">p</span> enum_h.next

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[:dog, "canine"]                               #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[:fox, "vulpine"]                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>大部分的iterator函数(就是内部调用yield, 把collection从头到尾都遍历的)会在
后面没有code block的情况下,返回一个Enumerator
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 3, <span style="color: #2aa198;">"cat"</span><span style="color: #2aa198;">]</span>

enum_a = a.each

<span style="color: #657b83; font-weight: bold;">p</span> enum_a.next
<span style="color: #657b83; font-weight: bold;">p</span> enum_a.next

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby里面还有一个叫做loop的函数,其实就是while的改版,会在conditon不符合的时
候退出,当loop和iterator配合起来的时候,loop就很智能,知道什么时候退出
<div class="org-src-container">

<pre class="src src-ruby">short_enum = <span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.to_enum
long_enum = <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'a'</span>..<span style="color: #2aa198;">'z'</span><span style="color: #2aa198;">)</span>.to_enum

<span style="color: #657b83; font-weight: bold;">loop</span> <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{short_enum.next}</span><span style="color: #2aa198;"> - </span><span style="color: #268bd2;">#{long_enum.next}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 - a                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2 - b                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3 - c                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4">Enumerators Are Objects</h4>
<div class="outline-text-4" id="text-4-3-4">
<ul class="org-ul">
<li>Enumerator一般都会把一些循环的过程转换成一个object.因为它是一个对象,那么就
有自己的函数,而且可以作为参数传递给其他函数
</li>
<li>Enumerator最重要的一个函数要数each_with_index了,我们上面讲过iterator后面调用
一个each_with_index,之所以能这么用,就是因为:
<ul class="org-ul">
<li>iterator(each)和code block被.with_index分开了.那么iterator返回的是一个Enumerator,
</li>
<li>Enumerator是一个对象了, 就可以调用函数with_index, 这个也是一个iterator,
后面又可以跟code block了.
</li>
<li>而且with_index这个iterator里面还多yield了index,所以就可以使用了.更难得的
是为了省事. ruby把each.with_index直接替换成了一个函数叫做each_with_index
<div class="org-src-container">

<pre class="src src-ruby">result = <span style="color: #2aa198;">[]</span>
<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'a'</span>, <span style="color: #2aa198;">'b'</span>, <span style="color: #2aa198;">'c'</span><span style="color: #2aa198;">]</span>.each_with_index <span style="color: #2aa198;">{</span>|item, index| result &lt;&lt; <span style="color: #b58900;">[</span>item, index<span style="color: #b58900;">]</span><span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> result

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[["a", 0], ["b", 1], ["c", 2]]                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>each_with_index在数组中非常好用,String其实是一个char的数组,所以ruby也设计了
一个each_with_index的string版本,有多种用法:
<ul class="org-ul">
<li>先把string转换成char数组然后each_with_index
<div class="org-src-container">

<pre class="src src-ruby">result = <span style="color: #2aa198;">[]</span>
<span style="color: #2aa198;">"cat"</span>.each_char.each_with_index <span style="color: #2aa198;">{</span>|item, index| result &lt;&lt; <span style="color: #b58900;">[</span>item, index<span style="color: #b58900;">]</span><span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> result

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[["c", 0], ["a", 1], ["t", 2]]                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>

<li>还可以直接把字符串转化成Enumerator
<div class="org-src-container">

<pre class="src src-ruby">enum = <span style="color: #2aa198;">"cat"</span>.enum_for<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:each_char</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> enum.to_a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["c", "a", "t"]                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>转成Enumerator的过程中,可以更凶残的传入一个函数,加上这个函数的参数
<div class="org-src-container">

<pre class="src src-ruby">enum_in_threes = <span style="color: #2aa198;">(</span>1..10<span style="color: #2aa198;">)</span>.enum_for<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:each_slice</span>, 3<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> enum_in_threes.to_a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-5" class="outline-4">
<h4 id="sec-4-3-5">Enumerators Are Generators and Filters</h4>
<div class="outline-text-4" id="text-4-3-5">
<ul class="org-ul">
<li>iterator的返回值都是Enumerator, 但是Enumerator其实也就是一个普通的类,你也
可以自己"凭空"创建一个Enumerator. 然后把它作为code block的一部分进行使用.
下面的这个例子,我们创建了trigngular_number以后.什么时候需要就直接调用next
就可以了.调用几次就会出现几次的value.
<div class="org-src-container">

<pre class="src src-ruby">triangular_numbers = <span style="color: #b58900;">Enumerator</span>.new <span style="color: #859900; font-weight: bold;">do</span> |yielder|
  number = 0
  count = 1
  <span style="color: #657b83; font-weight: bold;">loop</span> <span style="color: #859900; font-weight: bold;">do</span>
    number += count
    count += 1
    yielder.yield number
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

5.times <span style="color: #2aa198;">{</span> <span style="color: #657b83; font-weight: bold;">print</span> triangular_numbers.next, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>
puts

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 3 6 10 15                                    #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Enumerator object是enumerable的,它完全可以使用Enumerable自己的函数. 比如
first
<div class="org-src-container">

<pre class="src src-ruby">triangular_numbers = <span style="color: #b58900;">Enumerator</span>.new <span style="color: #859900; font-weight: bold;">do</span> |yielder|
  number = 0
  count = 1
  <span style="color: #657b83; font-weight: bold;">loop</span> <span style="color: #859900; font-weight: bold;">do</span>
    number += count
    count += 1
    yielder.yield number
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">p</span> triangular_numbers.first<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 3, 6, 10, 15]                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果一个Enumerator可以产生无线循环,那么你要特别的注意, 要自己写select.
比如下面的例子(我已经有点开始看不懂了&#x2026;), infinite_select的第二个参数是
&amp;block, 这个参数就是代表后面将会使用的code block
<div class="org-src-container">

<pre class="src src-ruby">triangular_numbers = <span style="color: #b58900;">Enumerator</span>.new <span style="color: #859900; font-weight: bold;">do</span> |yielder|
  number = 0
  count = 1
  <span style="color: #657b83; font-weight: bold;">loop</span> <span style="color: #859900; font-weight: bold;">do</span>
    number += count
    count += 1
    yielder.yield number
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">infinite_select</span><span style="color: #2aa198;">(</span>enum, &amp;block<span style="color: #2aa198;">)</span>
  <span style="color: #b58900;">Enumerator</span>.new <span style="color: #859900; font-weight: bold;">do</span> |yielder|
    enum.each <span style="color: #859900; font-weight: bold;">do</span> |value|
      yielder.yield<span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">if</span> block.call<span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">p</span> infinite_select<span style="color: #2aa198;">(</span>triangular_numbers<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|val| val % 10 == 0<span style="color: #2aa198;">}</span>.first<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[10, 120, 190, 210, 300]                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-6" class="outline-4">
<h4 id="sec-4-3-6">Lazy Enumerators in Ruby 2</h4>
<div class="outline-text-4" id="text-4-3-6">
<ul class="org-ul">
<li>前面我们讲过了, 使用enumerator产生无限循环序列,需要你自己书写select, 如果你
使用了2.0版本的ruby会有buildin的支持o#TODO#
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-7" class="outline-4">
<h4 id="sec-4-3-7">Blocks for Transactions</h4>
<div class="outline-text-4" id="text-4-3-7">
<ul class="org-ul">
<li>虽然block最常用的地方是为iterator指明要做的事情,但是它还有很多其他的用处,
比如你可以使用block将一组操作变成一个block.比如你要打开数据库,进行操作.打开
数据库的后,为了防止忘了关闭,我们要把打开-关闭数据库做成一个"事务", block就
可以大展身手了
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">File</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #859900; font-weight: bold;">self</span>.<span style="color: #268bd2;">open_and_process</span><span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    f = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">yield</span> f
    f.close<span style="color: #2aa198;">()</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>


<span style="color: #b58900;">File</span>.open_and_process<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile.txt"</span>, <span style="color: #2aa198;">"r"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  <span style="color: #859900; font-weight: bold;">while</span> line = file.gets
    <span style="color: #657b83; font-weight: bold;">puts</span> line
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">###########################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/misc &gt;&gt;&gt; ruby tut_block_transactions.rb  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: This is line one                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: This is line two                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: This is line three                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The line is: And so on...                                               #</span>
<span style="color: #93a1a1;">###########################################################################</span>
</pre>
</div>
</li>
<li>这里我们第一次看到了class method, 也就是高级语言里面的static函数, 这种函数
的特点是:被class调用,而不是被instance调用.这种函数参数的设计在语法上,就是多
了一个self比如这里函数名字定义的时候是self.open_and_process,使用的时候是直
接使用类名调用.
</li>
<li>这个函数不仅仅是一个class method, 其参数设计也很特别. 由于我们不太关心参数
到底是什么,我们就设置了一个叫做*args的参数,其背后的意思是"所有传给这个函数的
参数都给我记录下来,然后转换成一个叫做args的数组"
</li>
<li>然后File通过这个*args参数来打开文件, 下面就是见证奇迹的时刻!:
<ul class="org-ul">
<li>首先通过yield 将文件句柄(file descriptor)传给了code block
</li>
<li>然后调用了f.close(), 也就是说yield将f的"指挥权"转移走了.但是f的"释放权"还
紧紧的在我手中.f被block利用完之后,我始终会记得close文件
</li>
</ul>
</li>
<li>这种防止忘记关闭文件的做法非常的有效,有用,以至于ruby直接在语言内部在Open函
数中进行了类似支持(ruby老是这样..觉得好用,就自己收下了&#x2026;),对于File.open
这个函数来说:
<ul class="org-ul">
<li>如果open后面没有使用block的话,那么就是一个"正常的和其他语言无异的"返回fd
的函数. 你后面要记得close自己的fd
</li>
<li>如果open后面使用了block的话,open会把fd先交给code block运行,而且在code block
结束的时候,自己close掉fd. 下面我们来模仿一下ruby是如何实现这种情况的.注意
result是返回值.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">File</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #859900; font-weight: bold;">self</span>.<span style="color: #268bd2;">my_open</span><span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    result = file = <span style="color: #b58900;">File</span>.new<span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">If there's a block, pass in the file and close the file when</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">it returns</span>
    <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #657b83; font-weight: bold;">block_given?</span>
      result = <span style="color: #859900; font-weight: bold;">yield</span> file
      file.close
    <span style="color: #859900; font-weight: bold;">end</span>
    result
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-8" class="outline-4">
<h4 id="sec-4-3-8">Blocks Can Be Objects</h4>
<div class="outline-text-4" id="text-4-3-8">
<ul class="org-ul">
<li>Block有点类似java里面的匿名函数(anoymous method), 但是ruby赋予了他更多:你
可以把block转换成object:有成员变量,可以传递给其他函数,以后还可以来使用.
</li>
<li>先来看看ruby是如何把一个block转换成函数的参数的(会转换成Proc类型的参数)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">ProcExample</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">pass_in_block</span><span style="color: #2aa198;">(</span>&amp;action<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@stored_proc</span> = action
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">use_proc</span><span style="color: #2aa198;">(</span>parameter<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@stored_proc</span>.call<span style="color: #2aa198;">(</span>parameter<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
eg = <span style="color: #b58900;">ProcExample</span>.new
eg.pass_in_block <span style="color: #2aa198;">{</span>|param| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"The parameter is </span><span style="color: #268bd2;">#{param}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
eg.use_proc<span style="color: #2aa198;">(</span>99<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The parameter is 99                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们会发现上面利用block的方式是两步:
<ul class="org-ul">
<li>pass_in_block先把block传入到自己内部, 使用了符号"&amp;", 把block存成了变量
stored_proc
</li>
<li>然后调用use_proc来进行使用, 其内部过程就是stored_proc调用call, 参数为
use_proc的参数.
</li>
</ul>
</li>
<li>上述使用方法,广泛存在于ruby代码中,用来实现callback等功能.当然了你可以再进
一步.比如下面的这个方法create_block_object,做法很简单:就是把一个block整理
一下,然后返回成object. 这个object类型为Proc, 直接可以调用call等函数.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">create_block_object</span><span style="color: #2aa198;">(</span>&amp;block<span style="color: #2aa198;">)</span>
  block
<span style="color: #859900; font-weight: bold;">end</span>

bo = create_block_object<span style="color: #2aa198;">{</span> |param| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"You called me with </span><span style="color: #268bd2;">#{param}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
bo.call 99
bo.call <span style="color: #2aa198;">"cat"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You called me with 99                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You called me with cat                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby一看,这个block转换成objec的需求如此强劲, 直接推出了两种将block转成object
的方式:
<ul class="org-ul">
<li>Proc.new, block作为参数,返回Proc类型的变量
</li>
<li>lambda:
<div class="org-src-container">

<pre class="src src-ruby">bo = <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span> |param| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"You called me with </span><span style="color: #268bd2;">#{param}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
bo.call 99
bo.call <span style="color: #2aa198;">"cat"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You called me with 99                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">You called me with cat                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-9" class="outline-4">
<h4 id="sec-4-3-9">Blocks Can Be Closures</h4>
<div class="outline-text-4" id="text-4-3-9">
<ul class="org-ul">
<li>下面这个例子, n_times从thing里面取得一个参数,然后改装成了Proc类型的object
返回回去.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">n_times</span><span style="color: #2aa198;">(</span>thing<span style="color: #2aa198;">)</span>
  <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span>|n| thing * n<span style="color: #2aa198;">}</span>
<span style="color: #859900; font-weight: bold;">end</span>

p1 = n_times<span style="color: #2aa198;">(</span>23<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> p1.call<span style="color: #2aa198;">(</span>3<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> p1.call<span style="color: #2aa198;">(</span>4<span style="color: #2aa198;">)</span>
p2 = n_times<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Hello "</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> p2.call<span style="color: #2aa198;">(</span>3<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">69                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">92                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"Hello Hello Hello "                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>从结果我们可以看到,虽然,当我们的Proc类型的object调用call的时候,thing已经不
在自己的scope了,但是Proc类型的object竟然还能利用他. 这种功能叫做closure
<pre class="example">
Variables in the surrounding scope that are referenced in a block
remain accessible for the life of that block and the life of any
Proc object created from that block
</pre>
</li>
<li>下面这个例子,能够返回2的乘方,细细品味一下是如何做到的.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">power_proc_generator</span>
  value = 1
  <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span> value += value<span style="color: #2aa198;">}</span>
<span style="color: #859900; font-weight: bold;">end</span>

power_proc = power_proc_generator

<span style="color: #657b83; font-weight: bold;">puts</span> power_proc.call
<span style="color: #657b83; font-weight: bold;">puts</span> power_proc.call
<span style="color: #657b83; font-weight: bold;">puts</span> power_proc.call

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">8                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-10" class="outline-4">
<h4 id="sec-4-3-10">An Alternative Notation</h4>
<div class="outline-text-4" id="text-4-3-10">
<ul class="org-ul">
<li>我们的lambda可以有如下变体
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span>|params| ...<span style="color: #2aa198;">}</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">is equal to following</span>
-&gt; params <span style="color: #2aa198;">{</span>...<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>然后看看新的写法的例子
<div class="org-src-container">

<pre class="src src-ruby">proc1 = -&gt; arg <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"In proc1 with </span><span style="color: #268bd2;">#{arg}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
proc2 = -&gt; arg1, arg2 <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"In proc2 with </span><span style="color: #268bd2;">#{arg1}</span><span style="color: #2aa198;"> and </span><span style="color: #268bd2;">#{arg2}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
proc3 = -&gt; <span style="color: #2aa198;">(</span>arg1, arg2<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"In proc3 with </span><span style="color: #268bd2;">#{arg1}</span><span style="color: #2aa198;"> and </span><span style="color: #268bd2;">#{arg2}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

proc1.call <span style="color: #2aa198;">"ant"</span>
proc2.call <span style="color: #2aa198;">"bee"</span>, <span style="color: #2aa198;">"cat"</span>
proc3.call <span style="color: #2aa198;">"dog"</span>, <span style="color: #2aa198;">"elk"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In proc1 with ant                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In proc2 with bee and cat                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">In proc3 with dog and elk                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>新写法的有点是易于传递, 比如把一整个code block作为参数传入
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">my_if</span><span style="color: #2aa198;">(</span>condition, then_clause, else_clause<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">if</span> condition
    then_clause.call
  <span style="color: #859900; font-weight: bold;">else</span>
    else_clause.call
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

5.times <span style="color: #859900; font-weight: bold;">do</span> |val|
  my_if val &lt; 2,
  -&gt; <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{val}</span><span style="color: #2aa198;"> is small"</span><span style="color: #2aa198;">}</span>,
  -&gt; <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{val}</span><span style="color: #2aa198;"> is big"</span><span style="color: #2aa198;">}</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0 is small                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 is small                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2 is big                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3 is big                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4 is big                                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>传入一个code block给一个函数的另外一个优点是,这个block可以不断
的被计算
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">my_while</span><span style="color: #2aa198;">(</span>cond, &amp;body<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">while</span> cond.call
    body.call
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

a = 0

my_while -&gt; <span style="color: #2aa198;">{</span>a &lt; 3<span style="color: #2aa198;">}</span> <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> a
  a += 1
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-11" class="outline-4">
<h4 id="sec-4-3-11">Block Parameter Lists</h4>
<div class="outline-text-4" id="text-4-3-11">
<ul class="org-ul">
<li>我们在来回忆一下code block的两种模式:
<ul class="org-ul">
<li>一种是{}负责单行
</li>
<li>一种是do-end负责多行
</li>
</ul>
</li>
<li>我们前面的lambda的用法都是单行的,也可以转换成多行:
<ul class="org-ul">
<li>lambda可以写成如下的:
<div class="org-src-container">

<pre class="src src-ruby"> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">previous usage : lambda {|n| thing * n}</span>
 <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">{} is equal to beg ... end</span>
 proc1 = <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #859900; font-weight: bold;">do</span> |a, *b, &amp;block|
   <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"a = </span><span style="color: #268bd2;">#{a.inspect}</span><span style="color: #2aa198;">"</span>
   <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"b = </span><span style="color: #268bd2;">#{b.inspect}</span><span style="color: #2aa198;">"</span>
   block.call
 <span style="color: #859900; font-weight: bold;">end</span>

 proc1.call<span style="color: #2aa198;">(</span>1, 2, 3, 4<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"in block1"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">a = 1                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">b = [2, 3, 4]                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">in block1                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>-&gt;notation可以写成如下的
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">previous usage : -&gt; arg {puts "In proc1 with #{arg}"}</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">{} is equal to beg ... end</span>
proc2 = -&gt; a, *b, &amp;block <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"a = </span><span style="color: #268bd2;">#{a.inspect}</span><span style="color: #2aa198;">"</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"b = </span><span style="color: #268bd2;">#{b.inspect}</span><span style="color: #2aa198;">"</span>
  block.call
<span style="color: #859900; font-weight: bold;">end</span>

proc2.call<span style="color: #2aa198;">(</span>1, 2, 3, 4<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"in block2"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">a = 1                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">b = [2, 3, 4]                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">in block2                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Containers Everywhere</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>Containers, block, iterator是Ruby的核心中的核心.经过一段时间的训练,你会发现
书写一个支持iterator的class会带来很多强劲的功能.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Chapter 05: Sharing Functionality: Inheritance, Modules, and Mixins</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>一个良好设计最简单的一点就是要做到"Don't repeat yourself"
</li>
<li>class的设计可以自动的被class的instance所利用, 除了class以外,还有很多其他的方
法来避免代码重复,提高代码重用
</li>
</ul>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Inheritance and Messages</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>继承,就是子函数继承父函数的所有函数, 这个和其他高级语言一样
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Parent</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say_hello</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Hello from </span><span style="color: #268bd2;">#{self}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

p = <span style="color: #b58900;">Parent</span>.new
p.say_hello

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Subclass the parent...</span>
<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Child</span> &lt; <span style="color: #b58900;">Parent</span>
<span style="color: #859900; font-weight: bold;">end</span>

c = <span style="color: #b58900;">Child</span>.new
c.say_hello

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Hello from #&lt;Parent:0x007f8f3c078b18&gt;          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Hello from #&lt;Child:0x007f8f3c078a00&gt;           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Ruby内置了一个叫做superclass的函数, 返回当前class的parent class. 所有的class
的root都是Object,所以没得显示了,就现实Object
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Parent</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Child</span> &lt; <span style="color: #b58900;">Parent</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">Child</span>.superclass

<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">Parent</span>.superclass

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Parent                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Object                                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>当然下面是语言基础继承方式,Object-&gt;BasicObject-&gt;nil
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">Object</span>.superclass
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">Object</span>.superclass.superclass

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">BasicObject                                    #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>之所以每个函数都可以使用to_s,因为to_s是Object的函数,所以你肯定可以调用的到
它,只不过,输出不一定友好(注意puts才是返回to_s, p返回inspect)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Person</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span> = name
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

p = <span style="color: #b58900;">Person</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Michael"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> p

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;Person:0x007f8f3c86eb38&gt;                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>想让显示好看一点,可以覆写to_s
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Person</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span> = name
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    <span style="color: #2aa198;">"Person named </span><span style="color: #268bd2;">#{@name}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

p = <span style="color: #b58900;">Person</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Michael"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> p

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Person named Michael                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>下面我们来看看一个GServer的例子. 我们自己设计一个叫做LogServer的类, 继承自
GServer.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'gserver'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">LogServer</span> &lt; <span style="color: #b58900;">GServer</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #859900; font-weight: bold;">super</span><span style="color: #2aa198;">(</span>12345<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">serve</span><span style="color: #2aa198;">(</span>client<span style="color: #2aa198;">)</span>
    client.puts get_end_of_log_file
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">private</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">get_end_of_log_file</span>
    <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"/var/log/system.log"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |log|
      log.seek<span style="color: #2aa198;">(</span>-500, <span style="color: #b58900;">IO</span>::<span style="color: #b58900;">SEEK_END</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bak up 500 characters from end</span>
      log.gets                     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ignore partial line</span>
      log.read                     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">returned value</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

server = <span style="color: #b58900;">LogServer</span>.new
server.start.join
</pre>
</div>
</li>
<li>其运行结果如下
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ telnet 127.0.0.1 12345
Trying 127.0.0.1...
Connected to localhost.
Escape character is <span style="color: #2aa198;">'^]'</span>.
May  7 21:52:50 hfengdeMacBook-Air kernel<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>: wl0: Roamed or switched channel, reason <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">4, bssid d4:ee:07:02:41:ca</span>
May  7 21:52:50 hfengdeMacBook-Air kernel<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>: en0: BSSID changed to d4:ee:07:02:41:ca
May  7 21:52:50 hfengdeMacBook-Air kernel<span style="color: #2aa198;">[</span>0<span style="color: #2aa198;">]</span>: AirPort: RSN handshake complete on en0
May  7 21:52:53 hfengdeMacBook-Air.local login<span style="color: #2aa198;">[</span>1086<span style="color: #2aa198;">]</span>: USER_PROCESS: 1086 ttys005
May  7 21:54:23 hfengdeMacBook-Air.local apsd<span style="color: #2aa198;">[</span>81<span style="color: #2aa198;">]</span>: Unrecognized leaf certificate
Connection closed by foreign host.
</pre>
</div>
</li>
<li>super(12345)就是在TCP的12345端口建立链接
</li>
<li>get_end_of_log_file会返回最后一行log.read 就是log文件的最后500个字符.
</li>
<li>serve()这个函数,会在start()中被调用.所以在serve里面的打印会被在start调用的
时候显示
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Modules</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>ruby中的module的作用是把method, class,constant集合到一块的一个用法, 其给我
们提供了如下的两种便利:
<ul class="org-ul">
<li>提供了命名空间(namespace), 防止了名字冲突
</li>
<li>还提供了mixin功能.
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">Namespaces</h4>
<div class="outline-text-4" id="text-5-2-1">
<ul class="org-ul">
<li>class本身是一种命名空间,但是class本身要求其组成部分本身具有一定的逻辑相关
性.如果你想把一些没有逻辑没有关系的成员聚集起来的话,就不能再使用. 所以ruby
引入了module这个概念
</li>
<li>简单一句话概括就是:module让你使用多个class里面的内容. 如果说class跟object
更相关的话,module跟function更相关.
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">class</th>
<th scope="col" class="left">module</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">instantiation</td>
<td class="left">can be instantiated</td>
<td class="left">can <b>not</b> be instantiated</td>
</tr>

<tr>
<td class="left">usage</td>
<td class="left">object creation</td>
<td class="left">mixin facility, namespace</td>
</tr>

<tr>
<td class="left">superclass</td>
<td class="left">module</td>
<td class="left">object</td>
</tr>

<tr>
<td class="left">consists of</td>
<td class="left">methods, constants, variables</td>
<td class="left">methods, constants, classes</td>
</tr>

<tr>
<td class="left">methods</td>
<td class="left">class methods,  instantce methods</td>
<td class="left">module methods, instance methods</td>
</tr>

<tr>
<td class="left">inheritance</td>
<td class="left">inherits behavior and inheritance</td>
<td class="left">No inheritance</td>
</tr>

<tr>
<td class="left">inclusion</td>
<td class="left">cannot be included</td>
<td class="left">can be included in class</td>
</tr>

<tr>
<td class="left">extension</td>
<td class="left">can not extend with extend</td>
<td class="left">can extend</td>
</tr>
</tbody>
</table>
</li>
<li>先看一个Module提供namespace的例子
<ul class="org-ul">
<li>首先定义tut_modules/trig.rb文件
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Trig</span>
  <span style="color: #b58900;">PI</span> = 3.1415926
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #b58900;">Trig</span>.<span style="color: #268bd2;">sin</span><span style="color: #2aa198;">(</span>x<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">..</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #b58900;">Trig</span>.<span style="color: #268bd2;">cos</span><span style="color: #2aa198;">(</span>x<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">..</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>然后定义tut_modules/moral.rb文件
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Moral</span>
  <span style="color: #b58900;">VERY_BAD</span> = 0
  <span style="color: #b58900;">BAD</span> = 1
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #b58900;">Moral</span>.<span style="color: #268bd2;">sin</span><span style="color: #2aa198;">(</span>badness<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">..</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>当我们想使用两者的时候,直接在文件tut_modules/pin_head.rb里面如下调用(::)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'trig'</span>
<span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'moral'</span>
y = <span style="color: #b58900;">Trig</span>.sin<span style="color: #2aa198;">(</span><span style="color: #b58900;">Trig</span>::<span style="color: #b58900;">PI</span>/4<span style="color: #2aa198;">)</span>
wrongdoing = <span style="color: #b58900;">Moral</span>.sin<span style="color: #2aa198;">(</span><span style="color: #b58900;">Moral</span>::<span style="color: #b58900;">VERY_BAD</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">Mixins</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>我们知道java中,其实inheritance用的不多的, 因为composition显然能解决更多的问
题.在ruby中,避免使用继承的方法是mixin
</li>
<li>mixin粗略来看,其实就是一种"不需要在类内部创建其他类实例的"composition
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Debug</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">who_am_i?</span>
    <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{self.class.name}</span><span style="color: #2aa198;"> (id: </span><span style="color: #268bd2;">#{self.object_id}</span><span style="color: #2aa198;">): </span><span style="color: #268bd2;">#{self.name}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Phonograph</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Debug</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:name</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span> = name
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">EightTrack</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Debug</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:name</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span> = name
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>

ph = <span style="color: #b58900;">Phonograph</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"West End Blues"</span><span style="color: #2aa198;">)</span>
et = <span style="color: #b58900;">EightTrack</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Surrealistic Pillow"</span><span style="color: #2aa198;">)</span>

<span style="color: #657b83; font-weight: bold;">p</span> ph.who_am_i?
<span style="color: #657b83; font-weight: bold;">p</span> et.who_am_i?

<span style="color: #93a1a1;">####################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"Phonograph (id: 20528256): West End Blues"      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"EightTrack (id: 20528232): Surrealistic Pillow" #</span>
<span style="color: #93a1a1;">####################################################</span>
</pre>
</div>
</li>
<li>前面的例子中Module只能含有class类,而且调用的时候也只能调用class函数. 这个例子
中Module有了自己的instance函数, 但是Module自己又不能被instance化,所以,这些
instance函数都是为那些个include我们Module的class们准备哒!
</li>
<li>ruby里面的include跟c不一样,更类似于java在class内部声明了另外一个class的instance
而且ruby里面的include的Module如果在另外的一个文件,那么需要require把文件先加
进来, 换句话说,require是文件级别的引用. include只有object级别的引用
</li>
<li>ruby的动态性体现在,被引用的module行为在运行时改变了,那么引用这些module的其他
class的行为也随之改变.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Person</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Comparable</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:name</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span> = name
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{@name}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">&lt;=&gt;</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">self</span>.name &lt;=&gt; other.name
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

p1 = <span style="color: #b58900;">Person</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Matz"</span><span style="color: #2aa198;">)</span>
p2 = <span style="color: #b58900;">Person</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Guido"</span><span style="color: #2aa198;">)</span>
p3 = <span style="color: #b58900;">Person</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Larry"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Compare a couple of names</span>
<span style="color: #859900; font-weight: bold;">if</span> p1 &gt; p2
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{p1.name}</span><span style="color: #2aa198;">'s name &gt; </span><span style="color: #268bd2;">#{p2.name}</span><span style="color: #2aa198;">'s name"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sort an array of Person objects</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Sorted list:"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">[</span>p1, p2, p3<span style="color: #2aa198;">]</span>.sort

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Matz's name &gt; Guido's name                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sorted list:                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Guido                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Larry                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Matz                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">Iterators and the Numerable Module</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Ruby的Collection(Array, Hash)支持一系列的遍历,排序等等.这些功能都被集成到了
Enumerable module, 你只需要:
<ul class="org-ul">
<li>实现一个each函数,依次返回你的成员
</li>
<li>mix这个module,这些功能就全都有了
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5">Composing Modules</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li>Enumerable里面有一个我们的老相好:inject. 其功能就是把某个操作(比如下面的加法),
先运用到前两个成员,然后和第三个,第四个&#x2026;.等等.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 2, 3, 4, 5<span style="color: #2aa198;">]</span>.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:+</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'a'</span>..<span style="color: #2aa198;">'m'</span><span style="color: #2aa198;">)</span>.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:+</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">15                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"abcdefghijklm"                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>下面看一个自己书写的函数如何获取Enumerable的功能(这里只列举了inject)的例子.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">VowelFinder</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Enumerable</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>string<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@string</span> = string
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">each</span>
    <span style="color: #268bd2;">@string</span>.scan<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/[aeiou]/</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |vowel|
      <span style="color: #859900; font-weight: bold;">yield</span> vowel
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

vf = <span style="color: #b58900;">VowelFinder</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"the quick brown fox jumped"</span><span style="color: #2aa198;">)</span>
vf.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:+</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"euiooue"                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-5-5-1" class="outline-4">
<h4 id="sec-5-5-1">Instance Variables in Mixins</h4>
<div class="outline-text-4" id="text-5-5-1">
<ul class="org-ul">
<li>Module自己要存储自己的state,那么,肯定要有自己的变量.但是,非常非常不幸的是,
由于mixin的存在. Module自己的instance variable也会和instance一起,被导入到
include它们的class里面.如果include他们的class刚巧也有同名的instance variable
那么就惨了.这会导致非常非常隐蔽的错误, 比如下面的例子中,使用Module Observable
的函数有个一模一样的@observer_list.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Observable</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">observers</span>
    <span style="color: #268bd2;">@observer_list</span> ||= <span style="color: #2aa198;">[]</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">add_observer</span><span style="color: #2aa198;">(</span>obj<span style="color: #2aa198;">)</span>
    observers &lt;&lt; obj
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">notify_observers</span>
    observers.each <span style="color: #2aa198;">{</span>|o| o.update<span style="color: #2aa198;">}</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TelescopeScheduler</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Observable</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #268bd2;">@observer_list</span>= <span style="color: #2aa198;">[]</span>          <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">error! already has the same name</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">....</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>所以Module一定要定义自己instance 变量的时候,要时刻注意这个问题.有两种解决的
办法:
<ul class="org-ul">
<li>instance变量都加写前缀,比如"modulename_"
</li>
<li>上述方法还是不保险,因为也很有可能使用modulename_的前缀.所以,更保险的方法
是使用module-level的哈希来替代instance变量. 让instance变量永远不出现在
Module里面! 当然了,这样写也有风险因为一个为某个object保留了变量,但是这个
object已经不再的时候,这个变量说不定还在. 一般来说"如果一个mixin需要自己
的state,那么它其实应该是个class,而不是mixin"
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">module</span> <span style="color: #b58900;">Test</span>
  <span style="color: #b58900;">State</span> = <span style="color: #2aa198;">{}</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">state=</span><span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">State</span><span style="color: #2aa198;">[</span>object_id<span style="color: #2aa198;">]</span> = value
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">state</span>
    <span style="color: #b58900;">State</span><span style="color: #2aa198;">[</span>object_id<span style="color: #2aa198;">]</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Client</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Test</span>
<span style="color: #859900; font-weight: bold;">end</span>

c1 = <span style="color: #b58900;">Client</span>.new
c2 = <span style="color: #b58900;">Client</span>.new
c1.state = <span style="color: #2aa198;">'cat'</span>
c2.state = <span style="color: #2aa198;">'dog'</span>
<span style="color: #657b83; font-weight: bold;">p</span> c1.state
<span style="color: #657b83; font-weight: bold;">p</span> c2.state

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"cat"                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"dog"                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-5-2" class="outline-4">
<h4 id="sec-5-5-2">Resolving Ambiguous Method Names</h4>
<div class="outline-text-4" id="text-5-5-2">
<ul class="org-ul">
<li>最后一个问题就是如果在如下的几个地方都用重名的函数的话,那么寻找的顺序如下:
<ol class="org-ol">
<li>immediate calss of an object
</li>
<li>mixin included into that class (same name in difference mixin: last
included is searched first)
</li>
<li>superclass
</li>
<li>superclass's mixin(same name in difference mixin: last included is
searched first)
</li>
</ol>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6">Inheritance, Mixins, and Design</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li>继承(inheritance)和模块混入(mixin)都能把代码注入到多个class里面,但是使用的
时候各有千秋:
<ul class="org-ul">
<li>如果是严格的is-a关系,那么就使用inheritnce
</li>
<li>如果是has-a, use-a, 甚至是某些is-a都必须使用mixin(也就是java里面的composition)
因为这个世界没有那么多的is-a, 而且is-a实在太重了.它承担了太多了历史包袱.
</li>
</ul>
</li>
<li>Rails里面的经典错误就是让Person继承自DataWrapper, 我们应该使用mixin
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Person</span>
  <span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Persistable</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Instead of</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Person</span> &lt; <span style="color: #b58900;">DataWrapper</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Chapter 06: Standard Types</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Numbers</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>和python一样, ruby不太用考虑整形是否越界. 它自动会进行判断,小于32bit的整数
会被设置为Fixnum类型.超过了就设置为Bignum类型
<div class="org-src-container">

<pre class="src src-ruby">num = 10001
4.times <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{num.class}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{num}</span><span style="color: #2aa198;">"</span>
  num *= num
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Fixnum: 10001                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Fixnum: 100020001                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Fixnum: 10004000600040001                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Bignum: 100080028005600700056002800080001      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>integer加了一些前后缀以后表示不同意义:
<ul class="org-ul">
<li>前缀0,表示8进制: 0377 =&gt; 255
</li>
<li>前缀0d,表示10进制: 0d12345 =&gt; 12345
</li>
<li>前缀0x,表示16进制: 0xaabb =&gt; 43707
</li>
<li>前缀0b,表示2进制: -0b10 =&gt; -2
</li>
<li>数字中间的"_"不起作用, 你可以把他看成是大数的逗号:
123_456_789_123_456_789 =&gt; 123456789123456789
</li>
</ul>
</li>
<li>带小数点或者exponent的,肯定就是转换成Float类型啦
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> 1.1.class
<span style="color: #657b83; font-weight: bold;">p</span> 1e2.class

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Float                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Float                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>来自perl的同学要注意了.从文件中直接读出来的数字是字符串类型的.直接相加的话,
也是被认为是字符串相加,而不会自动转换成数字
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'number.txt'</span>, <span style="color: #2aa198;">'r'</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"add string directly----&gt;"</span>
  <span style="color: #859900; font-weight: bold;">while</span> line = file.gets
    v1, v2 = line.split
    <span style="color: #657b83; font-weight: bold;">print</span> v1 + v2, <span style="color: #2aa198;">" "</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

puts

<span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'number.txt'</span>, <span style="color: #2aa198;">'r'</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"add string wrapped by Integer----&gt;"</span>
  <span style="color: #859900; font-weight: bold;">while</span> line = file.gets
    v1, v2 = line.split
    <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>v1<span style="color: #2aa198;">)</span> + <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>v2<span style="color: #2aa198;">)</span>, <span style="color: #2aa198;">" "</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
puts

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">add string directly----&gt;                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">34 56 78                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">add string wrapped by Integer----&gt;             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">7 11 15                                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-6-1-1" class="outline-4">
<h4 id="sec-6-1-1">How Numbers Interact</h4>
<div class="outline-text-4" id="text-6-1-1">
<ul class="org-ul">
<li>两个不同类型的数字相运算,结果会转换成精度高的类型
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> 1 + 2
<span style="color: #657b83; font-weight: bold;">p</span> 1 + 2.0
<span style="color: #657b83; font-weight: bold;">p</span> 1.0 + 2
<span style="color: #657b83; font-weight: bold;">p</span> 1.0 + <span style="color: #657b83; font-weight: bold;">Complex</span><span style="color: #2aa198;">(</span>1, 2<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> 1 + <span style="color: #657b83; font-weight: bold;">Rational</span><span style="color: #2aa198;">(</span>2, 3<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> 1.0 + <span style="color: #657b83; font-weight: bold;">Rational</span><span style="color: #2aa198;">(</span>2, 3<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3.0                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3.0                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(2.0+2i)                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(5/3)                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1.6666666666666665                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>换句话说, 两个相同类型的数字相运算的结果还是同一个类型, 在两个整形相除后
结果还是整形. 这会产生很多问题(这中问题在其他语言中也存在)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">At least, one float exists, result will be float</span>
<span style="color: #657b83; font-weight: bold;">p</span> 1.0 / 2
<span style="color: #657b83; font-weight: bold;">p</span> 1 / 2.0
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">All integer, will return unexpected result</span>
<span style="color: #657b83; font-weight: bold;">p</span> 1 / 2

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0.5                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0.5                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2">Looping Using Numbers</h4>
<div class="outline-text-4" id="text-6-1-2">
<ul class="org-ul">
<li>Interger提供了多个iterator: times, upto, downto
<div class="org-src-container">

<pre class="src src-ruby">3.times <span style="color: #2aa198;">{</span><span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"X "</span><span style="color: #2aa198;">}</span>
1.upto<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|i| <span style="color: #657b83; font-weight: bold;">print</span> i, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>
99.downto<span style="color: #2aa198;">(</span>95<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|i| <span style="color: #657b83; font-weight: bold;">print</span> i, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">X X X 1 2 3 4 5 99 98 97 96 95                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Numeric也提供了step(Integer继承自Numeric)
<div class="org-src-container">

<pre class="src src-ruby">50.5.step<span style="color: #2aa198;">(</span>80, 5<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|i| <span style="color: #657b83; font-weight: bold;">print</span> i, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">50.5 55.5 60.5 65.5 70.5 75.5                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>iterator(比如下面的downto)如果不和block直接接触的话,会返回Enumerator object,
然后再调用iterator,就可衍生出遍历等功能
<div class="org-src-container">

<pre class="src src-ruby">10.downto<span style="color: #2aa198;">(</span>7<span style="color: #2aa198;">)</span>.with_index <span style="color: #2aa198;">{</span>|num, index| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{index}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{num}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0: 10                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1: 9                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2: 8                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3: 7                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Strings</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>Ruby String就是一系列character的序列(在ruby1.9之前是一系列8bit bytes的集合),
用法和python类似,就是单引号,双引号,都可以表示字符串.转义什么的也差不多
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">'escape using "\\"'</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">'That\'s right'</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">escape using "\"                               #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">That's right                                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Ruby的string和其他语言不同的地方在于string里面在#{expr}的保护下,可以嵌套进
ruby代码(这跟jsp里面嵌套进java代码如出一辙).
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Seconds/day: </span><span style="color: #268bd2;">#{24 * 60 * 60}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{'Ho! ' * 3}</span><span style="color: #2aa198;">Merry Christamas!"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">86400                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Ho! Ho! Ho! Merry Christamas!                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>嵌套的代码,当然可以更长一点.jsp里面的java也可以,只不过看起来奇怪一点
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"now is #{ def the(a)</span>
<span style="color: #2aa198;">                  'the ' + a</span>
<span style="color: #2aa198;">                end</span>
<span style="color: #2aa198;">                the('time')</span>
<span style="color: #2aa198;">} for all bad coders..."</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">now is the time for all bad coders...          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>另外如果嵌套的代码是如下几个情况,可以不使用{}, 但是要带着#
<ul class="org-ul">
<li>global variable
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">SAFE is not defined, previously, so value is 0</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Safe level is </span><span style="color: #268bd2;">#$SAFE</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Safe level is 0                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>class variable
</li>
<li>instance variable
</li>
</ul>
</li>
<li>除了常见的使用单双引号来创建string, ruby还发明了下面三种另类创建方法
<ul class="org-ul">
<li>%q: 小写的q会被认为是单引号(single quotation mark). 令人惊奇的是除了小中大
括号外,还可以使用任意其他符号来标记,比如下面的例子中还使用了感叹号(!)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%q{general single-quoted string}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%q/general single-quoted string/</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%q!general single-quoted string!</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general single-quoted string                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general single-quoted string                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general single-quoted string                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>%Q: 大写的Q会被任务是双引号(double quotation mark), 和%q一样,除了大中小括
号外,其他标记符号也可以.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%Q{general double-quoted string}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%Q!general double-quoted string!</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%Q{Seconds/day: </span><span style="color: #268bd2;">#{24*60*60}</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general double-quoted string                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general double-quoted string                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Seconds/day: 86400                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby的随意性到了令人发指的地步,如果只用%而不加@的话,也是可以的&#x2026;也就是说
(% == %Q)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%!general double-quoted string!</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">%{Second/day: </span><span style="color: #268bd2;">#{24 * 60 * 60}</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">general double-quoted string                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Second/day: 86400                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>最后,你还可以使用ruby自己的所谓here document的方法来创建多行字符串.这个跟
python的"""有异曲同工之妙. 就是这么简单的功能.ruby也玩出了花样.&lt;&lt;加一个
大写的字符串表示开始, 这很好理解.但是结束的时候,大写字符串"必须"出现在顶头
的位置!!. 如果你不要顶头,你要对齐.那么开始的时候,请使用&lt;&lt;-
<div class="org-src-container">

<pre class="src src-ruby">string_1 = <span style="color: #2aa198;">&lt;&lt;-END_OF_STRING</span>
<span style="color: #2aa198;">  The body of the string is the input lines up to</span>
<span style="color: #2aa198;">  one starting with the same text that followed the '&lt;&lt;'</span>
<span style="color: #2aa198;">  END_OF_STRING</span>
<span style="color: #657b83; font-weight: bold;">puts</span> string_1

string_2 = &lt;&lt;<span style="color: #b58900;">END_OF_STRING</span>
  <span style="color: #b58900;">The</span> body of the string is the input lines up to
  one starting with the same text that followed the <span style="color: #2aa198;">'&lt;&lt;'</span>
<span style="color: #b58900;">END_OF_STRING</span>

<span style="color: #657b83; font-weight: bold;">puts</span> string_2

<span style="color: #93a1a1;">############################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;           #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">The body of the string is the input lines up to        #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">one starting with the same text that followed the '&lt;&lt;' #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">The body of the string is the input lines up to        #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">one starting with the same text that followed the '&lt;&lt;' #</span>
<span style="color: #93a1a1;">############################################################</span>
</pre>
</div>
</li>
<li>here doucument的&lt;&lt;加大写字母.这个大写字母是unique的.所以,它们相互负责.
所以你竟然可以混合两个here doucument使用.要对齐的话,记得使用&lt;&lt;-哦.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">&lt;&lt;-STRING1</span>, <span style="color: #2aa198;">&lt;&lt;-STRING2</span>
<span style="color: #2aa198;">   Concat</span>
<span style="color: #2aa198;">   STRING1</span>
<span style="color: #2aa198;">          enate</span>
<span style="color: #2aa198;">          STRING2</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;">#    </span><span style="color: #93a1a1;">Concat                                      #</span>
<span style="color: #93a1a1;">#           </span><span style="color: #93a1a1;">enate                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-6-2-1" class="outline-4">
<h4 id="sec-6-2-1">Strings and Encodings</h4>
<div class="outline-text-4" id="text-6-2-1">
<ul class="org-ul">
<li>Ruby 1.9使用US-ASCII的endocing, 到了ruby2, encoding变成了UTF-8
<div class="org-src-container">

<pre class="src src-ruby">plain_string = <span style="color: #2aa198;">"dog"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">RUBY_VERSION</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Encoding of </span><span style="color: #268bd2;">#{plain_string.inspect}</span><span style="color: #2aa198;"> is </span><span style="color: #268bd2;">#{plain_string.encoding}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1.9.3                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Encoding of "dog" is GBK                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>当然了,你可以使用#encoding来强制设置编码模式.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">encoding: utf-8</span>
plain_string = <span style="color: #2aa198;">"dog"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Encodig of </span><span style="color: #268bd2;">#{plain_string.inspect}</span><span style="color: #2aa198;"> is </span><span style="color: #268bd2;">#{plain_string.encoding}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Encodig of "dog" is UTF-8                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2-2" class="outline-4">
<h4 id="sec-6-2-2">Character Constants</h4>
<div class="outline-text-4" id="text-6-2-2">
<ul class="org-ul">
<li>ruby没有为character创建自己的类. 我们常规认为的char,被ruby理解为长度为1的
string
</li>
<li>有些历史原因造就了我们也得创建character constant. 不过本书作者认为我们应该
忘记&#x2026;
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">?a</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">a                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2-3" class="outline-4">
<h4 id="sec-6-2-3">Working with Strings</h4>
<div class="outline-text-4" id="text-6-2-3">
<ul class="org-ul">
<li>下面来做个小例子,加深下对string的理解.我们有如下的一个文档, 我们希望把txt文
件的信息都提取出来.存到Ruby的对象里面
<pre class="example">
/jazz/j00132.mp3  | 3:45 | Fats     Waller     | Ain't Misbehavin'
/jazz/j00319.mp3  | 2:58 | Louis    Armstrong  | Wonderful World
/bgrass/bg0732.mp3| 4:09 | Strength in Numbers | Texas Red
</pre>
</li>
<li>版本一: 就是打开文件,然后把内容读取成字符串. 唯一的难点在于string的split函
数,其参数为正则表达式
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Song</span> = <span style="color: #b58900;">Struct</span>.new<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:title</span>, <span style="color: #268bd2; font-weight: bold;">:name</span>, <span style="color: #268bd2; font-weight: bold;">:length</span><span style="color: #2aa198;">)</span>

<span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"songdata.txt"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |song_file|
  songs = <span style="color: #2aa198;">[]</span>

  song_file.each <span style="color: #859900; font-weight: bold;">do</span> |line|
    file, length, name, title = line.chomp.split<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/\s*\|\s*/</span><span style="color: #2aa198;">)</span>
    songs &lt;&lt; <span style="color: #b58900;">Song</span>.new<span style="color: #2aa198;">(</span>title, name, length<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">puts</span> songs<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">####################################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/tut_stdtypes &gt;&gt;&gt; ruby read_songdata_1.rb          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;struct Song title="Wonderful World", name="Louis    Armstrong", length="2:58"&gt; #</span>
<span style="color: #93a1a1;">####################################################################################</span>
</pre>
</div>
</li>
<li>版本二,需要把结果里面的多余空格去掉,比如Louis   Armstrong, 中间太多空格了,
考察的知识点是squeeze!函数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Song</span> = <span style="color: #b58900;">Struct</span>.new<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:title</span>, <span style="color: #268bd2; font-weight: bold;">:name</span>, <span style="color: #268bd2; font-weight: bold;">:length</span><span style="color: #2aa198;">)</span>

<span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"songdata.txt"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |song_file|
  songs = <span style="color: #2aa198;">[]</span>

  song_file.each <span style="color: #859900; font-weight: bold;">do</span> |line|
    file, length, name, title = line.chomp.split<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/\s*\|\s*/</span><span style="color: #2aa198;">)</span>
    name.squeeze!<span style="color: #2aa198;">(</span><span style="color: #2aa198;">" "</span><span style="color: #2aa198;">)</span>
    songs &lt;&lt; <span style="color: #b58900;">Song</span>.new<span style="color: #2aa198;">(</span>title, name, length<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">puts</span> songs<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">#################################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/tut_stdtypes &gt;&gt;&gt; ruby read_songdata_2.rb       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;struct Song title="Wonderful World", name="Louis Armstrong", length="2:58"&gt; #</span>
<span style="color: #93a1a1;">#################################################################################</span>
</pre>
</div>
</li>
<li>把时间转换成秒,知识点是scan函数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">Song</span> = <span style="color: #b58900;">Struct</span>.new<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:title</span>, <span style="color: #268bd2; font-weight: bold;">:name</span>, <span style="color: #268bd2; font-weight: bold;">:length</span><span style="color: #2aa198;">)</span>

<span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"songdata.txt"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |song_file|
  songs = <span style="color: #2aa198;">[]</span>

  song_file.each <span style="color: #859900; font-weight: bold;">do</span> |line|
    file, length, name, title = line.chomp.split<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/\s*\|\s*/</span><span style="color: #2aa198;">)</span>
    name.squeeze!<span style="color: #2aa198;">(</span><span style="color: #2aa198;">" "</span><span style="color: #2aa198;">)</span>
    mins, secs = length.scan<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/\d+/</span><span style="color: #2aa198;">)</span>
    songs &lt;&lt; <span style="color: #b58900;">Song</span>.new<span style="color: #2aa198;">(</span>title, name, mins.to_i * 60 + secs.to_i<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #657b83; font-weight: bold;">puts</span> songs<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##############################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">c:/ttmp/ruby_in_action/pickaxe/tut_stdtypes &gt;&gt;&gt; ruby read_songdata_3.rb    #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">#&lt;struct Song title="Wonderful World", name="Louis Armstrong", length=178&gt; #</span>
<span style="color: #93a1a1;">##############################################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">Ranges</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>ruby对range非常看重,使用range实现了三个feature: sequences conditions,intervals
</li>
</ul>
</div>
<div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1">Ranges as Sequences</h4>
<div class="outline-text-4" id="text-6-3-1">
<ul class="org-ul">
<li>range实现sequence是一个非常容易理解的现象.两个点和三个点是不一样的(我们使用
to_a来转换成数组来看清楚 ):
<ul class="org-ul">
<li>两个点是包括最后一个成员:
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1..3<span style="color: #2aa198;">)</span>.to_a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3]                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>三个点是不包括最后一个成员
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1...3<span style="color: #2aa198;">)</span>.to_a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2]                                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>还可以使用to_enum来把一个range转化成Enumerator
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1..10<span style="color: #2aa198;">)</span>.to_a
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'bar'</span>..<span style="color: #2aa198;">'bat'</span><span style="color: #2aa198;">)</span>.to_a
enum = <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'bar'</span>..<span style="color: #2aa198;">'bat'</span><span style="color: #2aa198;">)</span>.to_enum
<span style="color: #657b83; font-weight: bold;">p</span> enum.next
<span style="color: #657b83; font-weight: bold;">p</span> enum.next

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">["bar", "bas", "bat"]                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"bar"                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"bas"                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Range可以看作是一个object,所以可以调用很多函数. range的函数多数是和遍历相
关的
<div class="org-src-container">

<pre class="src src-ruby">digits = 0..9
<span style="color: #657b83; font-weight: bold;">p</span> digits.include?<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span> digits.max
<span style="color: #657b83; font-weight: bold;">p</span> digits.reject <span style="color: #2aa198;">{</span>|i| i &lt; 5<span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">p</span> digits.inject<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:+</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">9                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[5, 6, 7, 8, 9]                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">45                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>range看起来如此美妙.导致我们自己的object也想享受range的福利.要想实现这个愿
望需要满足以下两点:
<ul class="org-ul">
<li>实现succ:返回,"刚刚好"比当前object大的下一个object
</li>
<li>实现&lt;=&gt;:设定如何比较大小
</li>
</ul>
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">PowerOfTwo</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:value</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@value</span> = value
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">&lt;=&gt;</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@value</span> &lt;=&gt; other.value
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">succ</span>
    <span style="color: #b58900;">PowerOfTwo</span>.new<span style="color: #2aa198;">(</span><span style="color: #268bd2;">@value</span> + <span style="color: #268bd2;">@value</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    <span style="color: #268bd2;">@value</span>.to_s
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

p1 = <span style="color: #b58900;">PowerOfTwo</span>.new<span style="color: #2aa198;">(</span>4<span style="color: #2aa198;">)</span>
p2 = <span style="color: #b58900;">PowerOfTwo</span>.new<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">(</span>p1..p2<span style="color: #2aa198;">)</span>.to_a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">8                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">16                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">32                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3-2" class="outline-4">
<h4 id="sec-6-3-2">Ranges as Conditions</h4>
<div class="outline-text-4" id="text-6-3-2">
<ul class="org-ul">
<li>range还可以作为condition, ruby已经到了丧心病狂的地步了.比如下面的代码就可以
从标准输入中"截取"start和end之间的内容
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  <span style="color: #657b83; font-weight: bold;">puts</span> line <span style="color: #859900; font-weight: bold;">if</span> line =~ <span style="color: #2aa198;">/start/</span> .. line =~ <span style="color: #2aa198;">/end/</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3-3" class="outline-4">
<h4 id="sec-6-3-3">Ranges as Intervals</h4>
<div class="outline-text-4" id="text-6-3-3">
<ul class="org-ul">
<li>这个还算人性化:判断某个object是否落在了某个特定的range里面
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1..10<span style="color: #2aa198;">)</span> === 5
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1..10<span style="color: #2aa198;">)</span> === 15
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span>1..10<span style="color: #2aa198;">)</span> === 3.14159
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'a'</span>..<span style="color: #2aa198;">'j'</span><span style="color: #2aa198;">)</span> === <span style="color: #2aa198;">'c'</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">(</span><span style="color: #2aa198;">'a'</span>..<span style="color: #2aa198;">'j'</span><span style="color: #2aa198;">)</span> === <span style="color: #2aa198;">'z'</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>===的用法,可以作为case的statement(注意..和&#x2026;的区别)
<div class="org-src-container">

<pre class="src src-ruby">car_age = 9.5

<span style="color: #859900; font-weight: bold;">case</span> car_age
<span style="color: #859900; font-weight: bold;">when</span> 0...1
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Mmm.. new car smell"</span>
<span style="color: #859900; font-weight: bold;">when</span> 1...3
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Nice and new"</span>
<span style="color: #859900; font-weight: bold;">when</span> 3...10
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Reliable but slightly dinged"</span>
<span style="color: #859900; font-weight: bold;">when</span> 10...30
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Clunker"</span>
<span style="color: #859900; font-weight: bold;">else</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Vintage gem"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Reliable but slightly dinged                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Chapter 07: Regular Expressions</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">What Regular Expressions Let You Do</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li>正则表达式我们很常见了,它就是用来匹配字符串的.一般来说,正则表达式能做到如下:
<ul class="org-ul">
<li>测试一个字符串是否符合一个pattern
</li>
<li>从一个字符串李立明找到符合某个字符串的所有结果
</li>
<li>查找并替换符合某个pattern的结果(query-replace)
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Ruby's Regular Expressions</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>ruby对正则表达式是内置的支持,所以专门使用两个斜杠(/)来保护正则表达式,所以/cat/
就是一个正则表达式.
</li>
<li>反斜杠(\)通常是提到转义字符的作用.在正则表达式里面也是/\*/就是表示匹配任何一个*
</li>
</ul>
</div>
<div id="outline-container-sec-7-2-1" class="outline-4">
<h4 id="sec-7-2-1">Matching Strings with Patterns</h4>
<div class="outline-text-4" id="text-7-2-1">
<ul class="org-ul">
<li>ruby还慷慨的提供了一个操作符=~来选择返回匹配字符的位置. pattern和字符传放在
前后都没有关系的.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> /cat/ =~ <span style="color: #2aa198;">"dog and cat"</span>
<span style="color: #657b83; font-weight: bold;">p</span> /cat/ =~ <span style="color: #2aa198;">"catch"</span>
<span style="color: #657b83; font-weight: bold;">p</span> /cat/ =~ <span style="color: #2aa198;">"Cat"</span>

<span style="color: #657b83; font-weight: bold;">p</span>  <span style="color: #2aa198;">"dog and cat"</span> =~ <span style="color: #2aa198;">/cat/</span>
<span style="color: #657b83; font-weight: bold;">p</span>  <span style="color: #2aa198;">"catch"</span> =~ <span style="color: #2aa198;">/cat/</span>
<span style="color: #657b83; font-weight: bold;">p</span>  <span style="color: #2aa198;">"Cat"</span>=~ <span style="color: #2aa198;">/cat/</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">8                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">8                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>找不到会返回nil,在逻辑控制里面, nil表示false, =~表示符合, 那么不符合的也有
一个操作符!~
<div class="org-src-container">

<pre class="src src-ruby">str = <span style="color: #2aa198;">"cat and dog"</span>

<span style="color: #859900; font-weight: bold;">if</span> str =~ <span style="color: #2aa198;">/cat/</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"There's a cat here somewhere'"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">if</span> str =~ <span style="color: #2aa198;">/dog/</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"There's a dog here somewhere'"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">if</span> str !~ <span style="color: #2aa198;">/tiger/</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"There's NOT a tiger here somewhere'"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">There's a cat here somewhere'                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">There's a dog here somewhere'                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">There's NOT a tiger here somewhere'            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-2" class="outline-4">
<h4 id="sec-7-2-2">Changing Strings with Patterns</h4>
<div class="outline-text-4" id="text-7-2-2">
<ul class="org-ul">
<li>我们可以使用正则表达式把某个字符串里面所有的"某一类字符"换成"一种特定的字符"
<div class="org-src-container">

<pre class="src src-ruby">str = <span style="color: #2aa198;">"hello world"</span>
new_str = str.sub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/world/</span>, <span style="color: #2aa198;">"America"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> new_str

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">hello America                                  #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>sub只替换第一次出现,gsub替换所有(global)的出现
<div class="org-src-container">

<pre class="src src-ruby">str = <span style="color: #2aa198;">"Dog and Cat"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> str.gsub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/a/</span>, <span style="color: #2aa198;">"*"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Dog *nd C*t                                    #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>sub 和 gsub都是返回一个新的字符串. 这在java里面很常见,因为string不可改变,
ruby的字符串是可变的.所以ruby提供了两个直接修改字符串的sub版本 sub!和gsub!
需要注意的是,如果sub!或者gsub!没有发现合适的"需要被替换的字符串的话", 他们会
返回nil. 因此也可以使用在condition判断中
<div class="org-src-container">

<pre class="src src-ruby">str = <span style="color: #2aa198;">"now is the time"</span>
str.sub!<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/i/</span>, <span style="color: #2aa198;">"*"</span><span style="color: #2aa198;">)</span>
str.gsub!<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/t/</span>, <span style="color: #2aa198;">"T"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> str

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">now *s The Time                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Digging Deeper</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>TODO
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Chapter 08: More About Methods</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">Defining a Method</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>前面我们对method的知识停留在两点上:
<ul class="org-ul">
<li>使用def定义
</li>
<li>小写字母开头
</li>
</ul>
</li>
<li>method其实还有其他的命名方式,比如:
<ul class="org-ul">
<li>method可以以?结尾的,通常返回boolean值
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> 1.even?
<span style="color: #657b83; font-weight: bold;">puts</span> 2.even?
<span style="color: #657b83; font-weight: bold;">puts</span> 1.instance_of?<span style="color: #2aa198;">(</span><span style="color: #b58900;">Fixnum</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>method也可以以!结尾,这通常都意味着是危险的,或者会改变调用它的object值的函
数.比如String有chop和chop!两个函数,后者是危险的,因为其会改变调用者的值
</li>
<li>method还可以以=结尾,这样的话,这个函数可以被当作是一个"值", 从而函数可以出
现在"="的左边.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">BookInStock</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:price</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>price<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@price</span> = <span style="color: #657b83; font-weight: bold;">Float</span><span style="color: #2aa198;">(</span>price<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">price=</span><span style="color: #2aa198;">(</span>new_prie<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@price</span> = new_prie
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

book = <span style="color: #b58900;">BookInStock</span>.new<span style="color: #2aa198;">(</span>33.5<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> book.price
book.price = book.price + 100
<span style="color: #657b83; font-weight: bold;">puts</span> book.price

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">33.5                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">133.5                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>函数的的参数是一系列的本地变量.用括号包围. ruby中的参数括号是可以省略的,我们
现在的做法是有参数采用括号,没有参数不用括号.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">my_new_method</span><span style="color: #2aa198;">(</span>arg1, arg2, arg3<span style="color: #2aa198;">)</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Code for the method would go here</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">my_new_method</span>               <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">No arguments</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Code for the method would go here</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>ruby当然允许设置函数参数默认值
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">cool_dude</span><span style="color: #2aa198;">(</span>arg1=<span style="color: #2aa198;">"Miles"</span>, arg2=<span style="color: #2aa198;">"Coltrane"</span>, arg3=<span style="color: #2aa198;">"Roach"</span><span style="color: #2aa198;">)</span>
  <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{arg1}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{arg2}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{arg3}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> cool_dude
<span style="color: #657b83; font-weight: bold;">puts</span> cool_dude<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Bart"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> cool_dude<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Bart"</span>, <span style="color: #2aa198;">"Elwood"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> cool_dude<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Bart"</span>, <span style="color: #2aa198;">"Elwood"</span>, <span style="color: #2aa198;">"Linus"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Miles, Coltrane, Roach                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Bart, Coltrane, Roach                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Bart, Elwood, Roach                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Bart, Elwood, Linus                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>default value还可以"后面的参数使用前面的参数"
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">surround</span><span style="color: #2aa198;">(</span>word, pad_width = word.length / 2<span style="color: #2aa198;">)</span>
  <span style="color: #2aa198;">"["</span> * pad_width + word + <span style="color: #2aa198;">"]"</span> * pad_width
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> surround<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"elephant"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> surround<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"fox"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> surround<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"fox"</span>, 10<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[[[[elephant]]]]                               #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[fox]                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[[[[[[[[[[fox]]]]]]]]]]                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-8-1-1" class="outline-4">
<h4 id="sec-8-1-1">Variable-Length Argument Lists</h4>
<div class="outline-text-4" id="text-8-1-1">
<ul class="org-ul">
<li>ruby还支持"不定参数"的函数定义方式, 方法就是参数加"*", 那么剩下的参数都会
以Array的形式存放在*参数里面.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">varargs</span><span style="color: #2aa198;">(</span>arg1, *rest<span style="color: #2aa198;">)</span>
  <span style="color: #2aa198;">"arg1=</span><span style="color: #268bd2;">#{arg1}</span><span style="color: #2aa198;">.   rest=</span><span style="color: #268bd2;">#{rest.inspect}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> varargs<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"one"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> varargs<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"one"</span>, <span style="color: #2aa198;">"two"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> varargs <span style="color: #2aa198;">"one"</span>, <span style="color: #2aa198;">"two"</span>, <span style="color: #2aa198;">"three"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">arg1=one.   rest=[]                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">arg1=one.   rest=["two"]                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">arg1=one.   rest=["two", "three"]              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面的这种用法,升华开来,出现了一种方法参数加"*", 但是它自己不用,而是给其
superclass来用.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Child</span> &lt; <span style="color: #b58900;">Parent</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">do_something</span><span style="color: #2aa198;">(</span>*not_used<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">our process</span>
    <span style="color: #859900; font-weight: bold;">super</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>这种方法由于太广泛的存在,而参数又不会使用.所以最后出现了下面的简化方式:只
有*,没有参数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Child</span> &lt; <span style="color: #b58900;">Parent</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">do_something</span><span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">our processing</span>
    <span style="color: #859900; font-weight: bold;">super</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>千万以为ruby的不定参数和c一样只能放到最后,也可以放到中间!
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">split_apart</span><span style="color: #2aa198;">(</span>first, *splat, last<span style="color: #2aa198;">)</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"First: </span><span style="color: #268bd2;">#{first.inspect}</span><span style="color: #2aa198;">, splat: </span><span style="color: #268bd2;">#{splat.inspect}</span><span style="color: #2aa198;">, "</span> +
    <span style="color: #2aa198;">"last: </span><span style="color: #268bd2;">#{last.inspect}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

split_apart<span style="color: #2aa198;">(</span>1, 2<span style="color: #2aa198;">)</span>
split_apart<span style="color: #2aa198;">(</span>1, 2, 3<span style="color: #2aa198;">)</span>
split_apart<span style="color: #2aa198;">(</span>1, 2, 3, 4<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">First: 1, splat: [], last: 2                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">First: 1, splat: [2], last: 3                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">First: 1, splat: [2, 3], last: 4               #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-1-2" class="outline-4">
<h4 id="sec-8-1-2">Methods and Blocks</h4>
<div class="outline-text-4" id="text-8-1-2">
<ul class="org-ul">
<li>前面我没说过,函数里面yield的话,后面调用这个函数的时候,要紧接着跟着一个block
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">double</span><span style="color: #2aa198;">(</span>p1<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">yield</span> <span style="color: #2aa198;">(</span>p1 * 2<span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> double<span style="color: #2aa198;">(</span>3<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|val| <span style="color: #2aa198;">"I got </span><span style="color: #268bd2;">#{val}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> double<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"tom"</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|val| <span style="color: #2aa198;">"Then I got </span><span style="color: #268bd2;">#{val}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I got 6                                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Then I got tomtom                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果最后一个参数被设置成带(&amp;)号的话,那么整个code block会被存储成为Proc类型
的object, 以便后面使用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TaxCalculator</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>name, &amp;block<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@name</span>, <span style="color: #268bd2;">@block</span> = name, block
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">get_tax</span><span style="color: #2aa198;">(</span>amount<span style="color: #2aa198;">)</span>
    <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#@name</span><span style="color: #2aa198;"> on </span><span style="color: #268bd2;">#{amount}</span><span style="color: #2aa198;"> = </span><span style="color: #268bd2;">#{@block.call(amount)}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

tc = <span style="color: #b58900;">TaxCalculator</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Sales tax"</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|amt| amt * 0.075<span style="color: #2aa198;">}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> tc.get_tax<span style="color: #2aa198;">(</span>100<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> tc.get_tax<span style="color: #2aa198;">(</span>250<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sales tax on 100 = 7.5                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sales tax on 250 = 18.75                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Calling a Method</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>ruby的函数调用还有一个receiver的概念, 比如下例中connection就是receiver
<div class="org-src-container">

<pre class="src src-ruby">connection.download_mp3<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"jitterbug"</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|p| show_progress<span style="color: #b58900;">(</span>p<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>ruby在调用函数的时候,首先把receiver设置成自己(self), 然后再把自己传递给receiver,
比如使用当前class创建的新的object
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">Math</span>.sin<span style="color: #2aa198;">(</span><span style="color: #b58900;">Math</span>::<span style="color: #b58900;">PI</span>/4<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0.7071067811865475                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果函数没有指定reciver, 那么receiver就是自己(self), 也就是当前的object
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">InvoiceWriter</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>order<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@order</span> = order
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    write_header_on<span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">called on current object</span>
    write_body_on<span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">self is not changd, as</span>
    write_totals_on<span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">there is no receiver</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_header_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_body_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_totals_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>上面的那些helper函数,只有被自己调用的份,应该设置为private(这样一来,使用此类
创建的object就无法调用他们了)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">InvoiceWriter</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>order<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@order</span> = order
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">....</span>
  <span style="color: #657b83; font-weight: bold;">private</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_header_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_body_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">write_totals_on</span><span style="color: #2aa198;">(</span>output<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-8-2-1" class="outline-4">
<h4 id="sec-8-2-1">Passing Parameters to a Method</h4>
<div class="outline-text-4" id="text-8-2-1">
<ul class="org-ul">
<li>ruby参数是可以没有括号的.但是除了没有参数的情况,我们不推荐大家这样做
<div class="org-src-container">

<pre class="src src-ruby">obj.some_method <span style="color: #2aa198;">"Arg1"</span>, arg2, arg3  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Same thing as</span>
obj.some_method<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"Arg1"</span>, arg2, arg3<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">with parentheses</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2-2" class="outline-4">
<h4 id="sec-8-2-2">Method Return Values</h4>
<div class="outline-text-4" id="text-8-2-2">
<ul class="org-ul">
<li>ruby的最后一行就是return value, 可以省事,不写return
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">meth_one</span>
  <span style="color: #2aa198;">"one"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> meth_one

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">one                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>return这个关键字也有,可以在不到最后一行的情况下,返回某一行.
</li>
<li>也可以返回多个值,这个有点像python的tuple,只是没有括号
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">meth_three</span>
  100.times <span style="color: #859900; font-weight: bold;">do</span> |num|
    square = num * num
    <span style="color: #859900; font-weight: bold;">return</span> num, square <span style="color: #859900; font-weight: bold;">if</span> square &gt; 1000
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> meth_three

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">32                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1024                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2-3" class="outline-4">
<h4 id="sec-8-2-3">Splat! Expanding Collections in Method Calls</h4>
<div class="outline-text-4" id="text-8-2-3">
<ul class="org-ul">
<li>前面说了:
<ul class="org-ul">
<li>如果你在"实现(implement)"某个函数的时候,可以把参数某一部分设置成*arg, 然后用户传入
的几个参数被解析成一个数组
</li>
<li>同样的,你在"使用(use as lib)"某个函数的时候,也可以传入一个数组的参数,然
后让函数自己去解析
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">five</span><span style="color: #2aa198;">(</span>a, b, c, d, e<span style="color: #2aa198;">)</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"I was passed </span><span style="color: #268bd2;">#{a}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{b}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{c}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{d}</span><span style="color: #2aa198;">, </span><span style="color: #268bd2;">#{e}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

five<span style="color: #2aa198;">(</span>1, 2, 3, 4, 5<span style="color: #2aa198;">)</span>
five<span style="color: #2aa198;">(</span>1, 2, 3, *<span style="color: #b58900;">[</span><span style="color: #2aa198;">'a'</span>, <span style="color: #2aa198;">'b'</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>
five<span style="color: #2aa198;">(</span>*<span style="color: #b58900;">[</span><span style="color: #2aa198;">'a'</span>, <span style="color: #2aa198;">'b'</span><span style="color: #b58900;">]</span>, 1, 2, 3<span style="color: #2aa198;">)</span>
five<span style="color: #2aa198;">(</span>*<span style="color: #b58900;">(</span>10..14<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
five<span style="color: #2aa198;">(</span>*<span style="color: #b58900;">[</span>1,2<span style="color: #b58900;">]</span>, 3, *<span style="color: #b58900;">(</span>4..5<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1, 2, 3, 4, 5                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I was passed 1, 2, 3, a, b                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I was passed a, b, 1, 2, 3                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I was passed 10, 11, 12, 13, 14                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I was passed 1, 2, 3, 4, 5                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-2-4" class="outline-4">
<h4 id="sec-8-2-4">Making Blocks More Synamic</h4>
<div class="outline-text-4" id="text-8-2-4">
<ul class="org-ul">
<li>前面,我们已经学过了,如何吧一个code blcok和一个method call联系起来
<div class="org-src-container">

<pre class="src src-ruby">collection.each <span style="color: #859900; font-weight: bold;">do</span> |member|
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>通常来说,这已经够了.但是,我们想要更灵活一点, 比如我们有如下的一个例子: 给
一个数字,根据用户的选择来决定是"连续加1到10"还是"连续乘1到10"
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"(t)imes or (p)lus "</span>
operator = gets
<span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"number: "</span>
number = <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>gets<span style="color: #2aa198;">)</span>

<span style="color: #859900; font-weight: bold;">if</span> operator =~ <span style="color: #2aa198;">/^t/</span>
  <span style="color: #657b83; font-weight: bold;">puts</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span>1..10<span style="color: #b58900;">)</span>.collect <span style="color: #b58900;">{</span>|n| n * number<span style="color: #b58900;">}</span>.join<span style="color: #b58900;">(</span><span style="color: #2aa198;">", "</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">else</span>
  <span style="color: #657b83; font-weight: bold;">puts</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span>1..10<span style="color: #b58900;">)</span>.collect <span style="color: #b58900;">{</span>|n| n + number<span style="color: #b58900;">}</span>.join<span style="color: #b58900;">(</span><span style="color: #2aa198;">", "</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby tut_method_block.rb             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(t)imes or (p)lus t                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">number: 3                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3, 6, 9, 12, 15, 18, 21, 24, 27, 30            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby tut_method_block.rb             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(t)imes or (p)lus p                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">number: 3                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4, 5, 6, 7, 8, 9, 10, 11, 12, 13               #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面的例子非常普通,简练,但是对于ruby来说,还是不够好,因为相加和相乘的逻辑十
分相似, ruby能够"更加generic"的处理这个问题:把唯一不同的地方(就是相加还是
相乘)做成code block, 然后传入到collect后面(本来要跟block,现在跟Proc对象)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"(t)imes or (p)lus "</span>
operator = gets
<span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"number: "</span>
number = <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>gets<span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">if</span> operator =~ <span style="color: #2aa198;">/^t/</span>
  calc = <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span>|n| n * number<span style="color: #2aa198;">}</span>
<span style="color: #859900; font-weight: bold;">else</span>
  calc = <span style="color: #657b83; font-weight: bold;">lambda</span> <span style="color: #2aa198;">{</span>|n| n + number<span style="color: #2aa198;">}</span>
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #657b83; font-weight: bold;">puts</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span>1..10<span style="color: #b58900;">)</span>.collect<span style="color: #b58900;">(</span>&amp;calc<span style="color: #b58900;">)</span>.join<span style="color: #b58900;">(</span><span style="color: #2aa198;">", "</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby tut_method_block2.rb            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(t)imes or (p)lus t                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">number: 2                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2, 4, 6, 8, 10, 12, 14, 16, 18, 20             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>也就是说,函数里面如果某个参数是加&amp;的(也就是c++里面的引用传递), 那么函数就把
这个参数当作Proc object来看待.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2-5" class="outline-4">
<h4 id="sec-8-2-5">Hash and Keyword Arguments</h4>
<div class="outline-text-4" id="text-8-2-5">
<ul class="org-ul">
<li>在ruby中,hash可以作为optional的参数传递给函数,比如下面的例子,我们想要找某个
符合:类型是jazz, 长度地狱270秒的歌曲的名字(title)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Songlist</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">search</span><span style="color: #2aa198;">(</span>field, params<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

list = <span style="color: #b58900;">SongList</span>.new
list.search<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:title</span>, <span style="color: #b58900;">{</span><span style="color: #268bd2; font-weight: bold;">genre:</span> <span style="color: #2aa198;">"jazz"</span>, <span style="color: #268bd2; font-weight: bold;">duration_less_than:</span> 270<span style="color: #b58900;">}</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>需要注意的是,第一个参数title肯定是存在的.而后面的累死"duration_less_than"
的参数是我们"仿造"出来的, 数据库中并不存在这种数据名称.
</li>
<li>但是,这还不够简洁(ruby要求实在是&#x2026;), 当然,更主要的问题是hash和code block
都使用{}, 这里的hash会被误认为是code block, 所以我们可以简化上面的代码为
<div class="org-src-container">

<pre class="src src-ruby">list.search<span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:titles</span>, <span style="color: #268bd2; font-weight: bold;">genre:</span> <span style="color: #2aa198;">"jazz"</span>, <span style="color: #268bd2; font-weight: bold;">duration_less_than:</span> 270<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2-6" class="outline-4">
<h4 id="sec-8-2-6">Keyword Argument Lists</h4>
<div class="outline-text-4" id="text-8-2-6">
<ul class="org-ul">
<li>#TODO# new in ruby 2.0
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">Chapter 09: Expressions</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li>许多在java和c中是statement的东西,在ruby里面是expression,比如if和case的最后一
句statement,都会当作返回值返回(是一个expression)
<div class="org-src-container">

<pre class="src src-ruby">songt_type = <span style="color: #859900; font-weight: bold;">if</span> song.mp3_type == <span style="color: #b58900;">MP3</span>::<span style="color: #b58900;">JAZZ</span>
               <span style="color: #859900; font-weight: bold;">if</span> song.written &lt; <span style="color: #b58900;">Date</span>.new<span style="color: #2aa198;">(</span>1935, 1, 1<span style="color: #2aa198;">)</span>
                 <span style="color: #b58900;">Song</span>::<span style="color: #b58900;">TardJazz</span>
               <span style="color: #859900; font-weight: bold;">else</span>
                 <span style="color: #b58900;">Song</span>::<span style="color: #b58900;">JAZZ</span>
               <span style="color: #859900; font-weight: bold;">end</span>
             <span style="color: #859900; font-weight: bold;">else</span>
               <span style="color: #b58900;">Song</span>::<span style="color: #b58900;">Other</span>
             <span style="color: #859900; font-weight: bold;">end</span>

rating = <span style="color: #859900; font-weight: bold;">case</span> votes_cast
         <span style="color: #859900; font-weight: bold;">when</span> 0...10 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #b58900;">Rating</span>::<span style="color: #b58900;">SkipThisOne</span>
         <span style="color: #859900; font-weight: bold;">when</span> 10...50 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #b58900;">Rating</span>::<span style="color: #b58900;">CouldDoBetter</span>
         <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #b58900;">Rating</span>::<span style="color: #b58900;">Rave</span>
         <span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1">Operator Expressions</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>ruby中,符号其实是一种函数调用(这个跟c++里面有一点像), 比如a*b,其实就是object
a调用它的函数*, 传入参数object b
<div class="org-src-container">

<pre class="src src-ruby">a, b, c = 1, 2, 3
<span style="color: #657b83; font-weight: bold;">puts</span> a * b + c
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">(</span>a.*<span style="color: #b58900;">(</span>b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>.+<span style="color: #2aa198;">(</span>c<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>既然operator都是函数,那么我们也可以实现自己的operator(像c++一样), ruby更灵
活的特性表现在,你甚至可以更改build-in的operator行为.比如我们更改+为"加上下一
个数的successor"
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Fixnum</span>
  <span style="color: #859900; font-weight: bold;">alias</span> old_plus +    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">backup original '+' as 'old_plus'</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">+</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    old_plus<span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>.succ
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> 1 + 2
a = 3
<span style="color: #657b83; font-weight: bold;">puts</span> a += 4
<span style="color: #657b83; font-weight: bold;">puts</span> a + a + a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">8                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">26                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>当然,更改现有类的operator行为不是我们想要的,我们想要的是"自己创建的新class
具有像build-in类一样的功能", 比如&lt;&lt;在ruby里面是append的功能, array都支持
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>
a &lt;&lt; 4
<span style="color: #657b83; font-weight: bold;">p</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4, 4]                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们自己设计个类ScoreKeeper,也让它支持&lt;&lt;
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">ScoreKeeper</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #268bd2;">@total_score</span> = <span style="color: #268bd2;">@count</span> = 0
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">&lt;&lt;</span><span style="color: #2aa198;">(</span>score<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@total_score</span> += score
    <span style="color: #268bd2;">@count</span> += 1
    <span style="color: #859900; font-weight: bold;">self</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">average</span>
    <span style="color: #859900; font-weight: bold;">fail</span> <span style="color: #2aa198;">"No scores"</span> <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">@count</span>.zero?
    <span style="color: #657b83; font-weight: bold;">Float</span><span style="color: #2aa198;">(</span><span style="color: #268bd2;">@total_score</span><span style="color: #2aa198;">)</span> / <span style="color: #268bd2;">@count</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

scores = <span style="color: #b58900;">ScoreKeeper</span>.new
scores &lt;&lt; 10 &lt;&lt; 20 &lt;&lt; 40
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Average = </span><span style="color: #268bd2;">#{scores.average}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Average = 23.333333333333332                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们可以看到,由于operator&lt;&lt;函数还返回了self, 所以&lt;&lt;操作是可以线性的连接起来
的.
</li>
<li>下面我们再来看一个operator[]=的例子. 这个例子中传入的是一个array的参数params,
然后最后一个成成员(pop出来的,所以是尾端的)作为index, 后面的成员作为[index]
的内容
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Someclass</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #2aa198;">[]</span><span style="color: #268bd2;">=</span> <span style="color: #2aa198;">(</span>*params<span style="color: #2aa198;">)</span>
    value = params.pop
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Indexed with </span><span style="color: #268bd2;">#{params.join(', ')}</span><span style="color: #2aa198;">"</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"value = </span><span style="color: #268bd2;">#{value.inspect}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

s = <span style="color: #b58900;">Someclass</span>.new
s<span style="color: #2aa198;">[</span>1<span style="color: #2aa198;">]</span> = 2
s<span style="color: #2aa198;">[</span><span style="color: #2aa198;">'cat'</span>, <span style="color: #2aa198;">'dog'</span><span style="color: #2aa198;">]</span> = <span style="color: #2aa198;">'enemies'</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Indexed with 1                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">value = 2                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Indexed with cat, dog                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">value = "enemies"                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2">Miscellaneous Expressions</h3>
<div class="outline-text-3" id="text-9-2">
</div><div id="outline-container-sec-9-2-1" class="outline-4">
<h4 id="sec-9-2-1">Command Expansion</h4>
<div class="outline-text-4" id="text-9-2-1">
<ul class="org-ul">
<li>有时候,我们也想使用当前操作系统的命令行里面的功能(命令), 那么有两种方式: TODO
<ul class="org-ul">
<li>反引号(backquotes), 在键盘~的下面
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">`date`</span>
<span style="color: #2aa198;">`ls`</span>.split<span style="color: #2aa198;">[</span>34<span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
<li>使用%x加{}
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">%x{echo "hello there"}</span>
</pre>
</div>
</li>
</ul>
</li>
<li>还可以 TODO
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">for</span> i <span style="color: #859900; font-weight: bold;">in</span> 0..3
  status = <span style="color: #2aa198;">`dbmanager status id=</span><span style="color: #268bd2;">#{i}</span><span style="color: #2aa198;">`</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-2" class="outline-4">
<h4 id="sec-9-2-2">Redefining Backquotes</h4>
<div class="outline-text-4" id="text-9-2-2">
<ul class="org-ul">
<li>TODO
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">alias</span> old_backquote <span style="color: #2aa198;">`</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3">Assignment</h3>
<div class="outline-text-3" id="text-9-3">
<ul class="org-ul">
<li>ruby中的assignment,再赋值之后,还会返回"右值(rvalue)",而且赋值是可以chain的
<div class="org-src-container">

<pre class="src src-ruby">a = b = 1 + 2 + 3
<span style="color: #657b83; font-weight: bold;">puts</span> a
<span style="color: #657b83; font-weight: bold;">puts</span> b
a = <span style="color: #2aa198;">(</span>b = 1 + 2<span style="color: #2aa198;">)</span> +3
<span style="color: #657b83; font-weight: bold;">puts</span> a
<span style="color: #657b83; font-weight: bold;">puts</span> b

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">6                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">6                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">6                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby中赋值其实分成了两类:
<ul class="org-ul">
<li>语言内置的赋值:
<div class="org-src-container">

<pre class="src src-ruby">instrument = <span style="color: #2aa198;">"piano"</span>
<span style="color: #b58900;">MIDDLE_A</span> = 440
</pre>
</div>
</li>
<li>对象的属性,或者引用赋值.其实是object的函数operator=调用,你可以改写他们
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">ProjectList</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    <span style="color: #268bd2;">@projects</span> = <span style="color: #2aa198;">[]</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">projects=</span><span style="color: #2aa198;">(</span>list<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@projects</span> = list.map<span style="color: #2aa198;">(</span>&amp;<span style="color: #268bd2; font-weight: bold;">:upcase</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">store list of names in uppercase</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #2aa198;">[]</span><span style="color: #2aa198;">(</span>offset<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@projects</span><span style="color: #2aa198;">[</span>offset<span style="color: #2aa198;">]</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

list = <span style="color: #b58900;">ProjectList</span>.new
list.projects = <span style="color: #2aa198;">%w{ strip sand prime sand paint sand paint rub paint}</span>
<span style="color: #657b83; font-weight: bold;">puts</span> list<span style="color: #2aa198;">[</span>3<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">puts</span> list<span style="color: #2aa198;">[</span>4<span style="color: #2aa198;">]</span>
</pre>
</div>
</li>
</ul>
</li>
<li>需要注意的是,1.8版本以前的ruby在返回值方面和1.9以后的ruby有所不同.下面这个
例子中. 1.8版本的ruby会返回99, 而新版本ruby会返回2
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Test</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">val=</span><span style="color: #2aa198;">(</span>val<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@val</span> = val
    <span style="color: #859900; font-weight: bold;">return</span> 99
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

t = <span style="color: #b58900;">Test</span>.new
result = <span style="color: #2aa198;">(</span>t.val = 2<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> result

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-9-3-1" class="outline-4">
<h4 id="sec-9-3-1">Parallel Assignment</h4>
<div class="outline-text-4" id="text-9-3-1">
<ul class="org-ul">
<li>ruby的swap和python一样简介(比起java哪更是清新飘逸)
<div class="org-src-container">

<pre class="src src-ruby">a, b = 1, 2
<span style="color: #657b83; font-weight: bold;">puts</span> a, b
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"---------------"</span>
a, b = b, a
<span style="color: #657b83; font-weight: bold;">puts</span> a, b

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">---------------                                #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>不要把上面的例子理解成是ruby语言为了swap而专门进行的优化,实际上的处理过程是:
<ul class="org-ul">
<li>首先,所有的右值都会被转换成数组
</li>
<li>其次,处理左值,如果左值是一个变量的话(没有逗号), 那么就直接赋值给左值
<div class="org-src-container">

<pre class="src src-ruby">a = 1, 2, 3, 4
b = <span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>

<span style="color: #657b83; font-weight: bold;">p</span> a, b

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4]                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4]                                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果左值不是一个变量(有逗号), 那么也转换成左值数组,然后按照刚才右值数组
的顺序依次进行匹配,赋值.如果有多余的,就丢弃掉
<div class="org-src-container">

<pre class="src src-ruby">a, b = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">puts</span> a, b
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"--------------"</span>
c, = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">puts</span> c

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">--------------                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-3-2" class="outline-4">
<h4 id="sec-9-3-2">Splats and Assignment</h4>
<div class="outline-text-4" id="text-9-3-2">
<ul class="org-ul">
<li>在ruby里面,所谓splat就是星号(*) + 一个数组或者range
</li>
<li>如果splat出现在operator=的右边,那么就要先把它分解出来,然后再赋值
<div class="org-src-container">

<pre class="src src-ruby">a, b, c, d, e = *<span style="color: #2aa198;">(</span>1..2<span style="color: #2aa198;">)</span>, 3, *<span style="color: #2aa198;">[</span>4, 5<span style="color: #2aa198;">]</span>

<span style="color: #657b83; font-weight: bold;">puts</span> a, b, c, d, e

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>如果splat出现在operator=的左边,那么就只能有一个splat,而且其扩展方法是贪心的
<div class="org-src-container">

<pre class="src src-ruby">a, *b = 1, 2, 3
<span style="color: #657b83; font-weight: bold;">p</span> a, b
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"--------------"</span>
a, *b = 1
<span style="color: #657b83; font-weight: bold;">p</span> a, b

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[2, 3]                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">--------------                                 #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[]                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>上面是splat在最后的情况,如果不再最后,在中间的话,那么它会优先让左右同伴偶能
得到赋值. 剩下自己,照单全收
<div class="org-src-container">

<pre class="src src-ruby">*a, b = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">p</span> a, b
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"----------"</span>

c, *d, e = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">p</span> c, d, e
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"----------"</span>

f, *g, h, i, j = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">p</span> f, g, h, i, j
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"----------"</span>

k, *l, m, n, o, p = 1, 2, 3
<span style="color: #657b83; font-weight: bold;">p</span> k, l, m, n, o, p

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3]                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">----------                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[2, 3]                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">----------                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[]                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">----------                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[]                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>所以,星号(*)可以用来忽略某些你不想要的右值(rvalue)
<div class="org-src-container">

<pre class="src src-ruby">first, *, last = 1, 2, 3, 4, 5, 6
<span style="color: #657b83; font-weight: bold;">puts</span> first, last

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">6                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-3-3" class="outline-4">
<h4 id="sec-9-3-3">Nested Assignments</h4>
<div class="outline-text-4" id="text-9-3-3">
<ul class="org-ul">
<li>如果左值里面有括号,那么括号会被认为是一个个体, 然后个体内部再进行二次赋值
<div class="org-src-container">

<pre class="src src-ruby">a, <span style="color: #2aa198;">(</span>b, c<span style="color: #2aa198;">)</span>, d = 1, 2, 3, 4
<span style="color: #657b83; font-weight: bold;">p</span> a, b, c, d
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"-------------------"</span>

a, <span style="color: #2aa198;">(</span>b, c<span style="color: #2aa198;">)</span>, d = <span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>
<span style="color: #657b83; font-weight: bold;">p</span> a, b, c, d
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"-------------------"</span>

a, <span style="color: #2aa198;">(</span>b, c<span style="color: #2aa198;">)</span>, d = 1, <span style="color: #2aa198;">[</span>2, 3<span style="color: #2aa198;">]</span>, 4
<span style="color: #657b83; font-weight: bold;">p</span> a, b, c, d
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"-------------------"</span>

a, <span style="color: #2aa198;">(</span>b, c<span style="color: #2aa198;">)</span>, d = 1, <span style="color: #2aa198;">[</span>2, 3, 4<span style="color: #2aa198;">]</span>, 5
<span style="color: #657b83; font-weight: bold;">p</span> a, b, c, d
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"-------------------"</span>

a, <span style="color: #2aa198;">(</span>b, *c<span style="color: #2aa198;">)</span>, d = 1, <span style="color: #2aa198;">[</span>2, 3, 4<span style="color: #2aa198;">]</span>, 5
<span style="color: #657b83; font-weight: bold;">p</span> a, b, c, d
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"-------------------"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-------------------                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-------------------                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-------------------                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">3                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-------------------                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[3, 4]                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">5                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">-------------------                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-3-4" class="outline-4">
<h4 id="sec-9-3-4">Other Forms of Assignment</h4>
<div class="outline-text-4" id="text-9-3-4">
<ul class="org-ul">
<li>和python不同, ruby选择了支持c语言的经典+=, 你自己写的object如果需要像内置
类型一样,需要自己写这个函数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Bowdlerize</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>string<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@value</span> = string.gsub<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/[aeiou]/</span>, <span style="color: #2aa198;">'*'</span><span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">+</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">Bowdlerize</span>.new<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">self</span>.to_s + other.to_s<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    <span style="color: #268bd2;">@value</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

a = <span style="color: #b58900;">Bowdlerize</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"damn "</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a
a += <span style="color: #2aa198;">"shame"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">d*mn                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">d*mn sh*m*                                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby没有选择支持c里面的经典++, &#x2013;
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4">Conditional Execution</h3>
<div class="outline-text-3" id="text-9-4">
</div><div id="outline-container-sec-9-4-1" class="outline-4">
<h4 id="sec-9-4-1">Boolean Expressions</h4>
<div class="outline-text-4" id="text-9-4-1">
<ul class="org-ul">
<li>ruby对待boolean的态度也很简单, 和java不一样,和c很类似(不完全一样)
<ul class="org-ul">
<li>常量false 肯定是 否
</li>
<li>nil 表示 否
</li>
<li>其他一切都是 真
</li>
</ul>
</li>
<li>nil作为否,可以让IO#gets实现变得简单, 它最后返回nil就可以了
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">process line</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>0, 以及zero-length的字符是"真"!!
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-2" class="outline-4">
<h4 id="sec-9-4-2">And, Or, and Not</h4>
<div class="outline-text-4" id="text-9-4-2">
<ul class="org-ul">
<li>ruby在逻辑"与"方面,有"and" 和"&amp;&amp;"两个选项
</li>
<li>ruby在逻辑"或"方面,有"or" 和"||"两个选择
</li>
<li>ruby神奇的地方出现了:
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">"and"</span> <span style="color: #859900; font-weight: bold;">and</span> <span style="color: #2aa198;">"or"</span> have the sam precedence,
but <span style="color: #2aa198;">"&amp;&amp;"</span> has a higher precedence than <span style="color: #2aa198;">"||"</span>
</pre>
</div>
</li>
<li>ruby还根据+=, -= 发明了 ||=
<div class="org-src-container">

<pre class="src src-ruby">var ||= <span style="color: #2aa198;">"dfault value"</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">can be though as, only if var is false, could it gets value "default value"</span>
var = var || <span style="color: #2aa198;">"default value"</span>
</pre>
</div>
</li>
<li>ruby也是支持"not"和"!"的
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-3" class="outline-4">
<h4 id="sec-9-4-3">defined?</h4>
<div class="outline-text-4" id="text-9-4-3">
<ul class="org-ul">
<li>如果某个expression没有被定义,那么defined?会返回nil (yield如果有相应关联的
code block, 那么就任务是"已定义", 否则是"没定义"). 如果定义了,会返回其
description(对于ruby这种函数没括号的语言,这个十分重要)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> 1
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> dummy
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> printf
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> <span style="color: #b58900;">String</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> <span style="color: #657b83; font-weight: bold;">$_</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> <span style="color: #b58900;">Math</span>::<span style="color: #b58900;">PI</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> a = 1
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> 42.abs
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #859900; font-weight: bold;">defined?</span> <span style="color: #268bd2; font-weight: bold;">nil</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"expression"                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"method"                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"constant"                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"global-variable"                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"constant"                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"assignment"                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"method"                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"nil"                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-4" class="outline-4">
<h4 id="sec-9-4-4">Comparing objects</h4>
<div class="outline-text-4" id="text-9-4-4">
<ul class="org-ul">
<li>在比较对象方面,ruby有如下的操作符
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Operator</th>
<th scope="col" class="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">==</td>
<td class="left">Test for equal value</td>
</tr>

<tr>
<td class="left">===</td>
<td class="left">Used to compare each of the items with the target in the "when" clause of a case satement</td>
</tr>

<tr>
<td class="left">&lt;=&gt;</td>
<td class="left">return -1, 0, 1 with less than, equal to, greater than</td>
</tr>

<tr>
<td class="left">&lt;,&lt;=,</td>
<td class="left">less than, or equal</td>
</tr>

<tr>
<td class="left">&gt;,&gt;=</td>
<td class="left">greater than, or equal</td>
</tr>

<tr>
<td class="left">=~</td>
<td class="left">Regular Expression pattern match</td>
</tr>

<tr>
<td class="left">eql?</td>
<td class="left">True if both "value" and "type" are the same. 1.eql?(1.0) is false</td>
</tr>

<tr>
<td class="left">equal?</td>
<td class="left">True if both have the same object ID</td>
</tr>
</tbody>
</table>
</li>
<li>其中==的判断"不相等"的伙伴!=, 而且=~也有自己判断"不匹配"的伙伴!~. ruby对他
们的判断很有趣, 当两个object进行"不相等(匹配)"判断的时候:
<ul class="org-ul">
<li>首先看调用的object有没有定义!=(!~), 如果定义了,就调用之
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">T</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">==</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Comparing self == </span><span style="color: #268bd2;">#{other}</span><span style="color: #2aa198;">"</span>
    other == <span style="color: #2aa198;">"value"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">!=</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Comparing self != </span><span style="color: #268bd2;">#{other}</span><span style="color: #2aa198;">"</span>
    other != <span style="color: #2aa198;">"value"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

t = <span style="color: #b58900;">T</span>.new
<span style="color: #657b83; font-weight: bold;">p</span><span style="color: #2aa198;">(</span>t == <span style="color: #2aa198;">"value"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span><span style="color: #2aa198;">(</span>t != <span style="color: #2aa198;">"value"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Comparing self == value                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Comparing self != value                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>

<li>如果object没有定义!=(!~), 那么先调用==(=~), 然后结果取反.下面的object没有
定义!=, 却依然可以调用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">T</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">==</span><span style="color: #2aa198;">(</span>other<span style="color: #2aa198;">)</span>
    <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Comparing self == </span><span style="color: #268bd2;">#{other}</span><span style="color: #2aa198;">"</span>
    other == <span style="color: #2aa198;">"value"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

t = <span style="color: #b58900;">T</span>.new
<span style="color: #657b83; font-weight: bold;">p</span><span style="color: #2aa198;">(</span>t == <span style="color: #2aa198;">"value"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">p</span><span style="color: #2aa198;">(</span>t != <span style="color: #2aa198;">"value"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Comparing self == value                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Comparing self == value                        #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-5" class="outline-4">
<h4 id="sec-9-4-5">if and unless Expressions</h4>
<div class="outline-text-4" id="text-9-4-5">
<ul class="org-ul">
<li>ruby的if非常简略
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">if</span> artist == <span style="color: #2aa198;">"Gillespie"</span> <span style="color: #859900; font-weight: bold;">then</span>
  handle = <span style="color: #2aa198;">"Dizzy"</span>
<span style="color: #859900; font-weight: bold;">elsif</span> artist == <span style="color: #2aa198;">"Parker"</span> <span style="color: #859900; font-weight: bold;">then</span>
  handle = <span style="color: #2aa198;">"Bird"</span>
<span style="color: #859900; font-weight: bold;">else</span>
  handle = <span style="color: #2aa198;">"unknown"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>如果你打算把if语句分成多行,then可以省略
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">if</span> artist == <span style="color: #2aa198;">"Gillespie"</span>
  handle = <span style="color: #2aa198;">"Dizzy"</span>
<span style="color: #859900; font-weight: bold;">elsif</span> artist == <span style="color: #2aa198;">"Parker"</span>
  handle = <span style="color: #2aa198;">"Bird"</span>
<span style="color: #859900; font-weight: bold;">else</span>
  handle = <span style="color: #2aa198;">"unknown"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>如果你不打算换号,那为了能够分清楚谁是逻辑,then肯定得有
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">if</span> artist == <span style="color: #2aa198;">"Gillespie"</span> <span style="color: #859900; font-weight: bold;">then</span> handle = <span style="color: #2aa198;">"Dizzy"</span>
<span style="color: #859900; font-weight: bold;">elsif</span> artist == <span style="color: #2aa198;">"Parker"</span> <span style="color: #859900; font-weight: bold;">then</span> handle = <span style="color: #2aa198;">"Bird"</span>
<span style="color: #859900; font-weight: bold;">else</span> handle = <span style="color: #2aa198;">"unknown"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>我们前面讲过,一个expression的最后一个statement会作为返回值,所以其实你可以
如下写前面的"根据情况赋值"
<div class="org-src-container">

<pre class="src src-ruby">handle = <span style="color: #859900; font-weight: bold;">if</span> artist == <span style="color: #2aa198;">"Gillespie"</span>
           <span style="color: #2aa198;">"Dizzy"</span>
         <span style="color: #859900; font-weight: bold;">elsif</span> artist == <span style="color: #2aa198;">"Parker"</span>
           <span style="color: #2aa198;">"Bird"</span>
         <span style="color: #859900; font-weight: bold;">else</span>
           <span style="color: #2aa198;">"unknown"</span>
         <span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>unless其实是"If NOT"的意思, 下面整个逻辑是"除非" duration大于180. "否则",
我就调用end前面的代码.
<div class="org-src-container">

<pre class="src src-ruby">duration = 100
<span style="color: #859900; font-weight: bold;">unless</span> duration &gt; 180
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"duration is too short"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">duration is too short                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>ruby也支持经典的c 的 ?:
<div class="org-src-container">

<pre class="src src-ruby">cost = duration &gt; 180 ? 0.35 : 0.25
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-6" class="outline-4">
<h4 id="sec-9-4-6">if and unless Modifiers</h4>
<div class="outline-text-4" id="text-9-4-6">
<ul class="org-ul">
<li>所谓if modifier,就是不用end了,直接最后来个条件判断,后面的为true了, 前面的
expression才会进行
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">date = "(09)-(15)-(12)"</span>
date = <span style="color: #2aa198;">"09-15-12"</span>
mon, day, year = <span style="color: #657b83; font-weight: bold;">$1</span>, <span style="color: #657b83; font-weight: bold;">$2</span>, <span style="color: #657b83; font-weight: bold;">$3</span> <span style="color: #859900; font-weight: bold;">if</span> date =~<span style="color: #2aa198;">/(\d\d)-(\d\d)-(\d\d)/</span>

<span style="color: #657b83; font-weight: bold;">puts</span> mon, day, year

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">09                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">15                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">12                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>unless modifier如下, 它是后面为false了,才进行expression
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.foreach<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"/etc/passwd"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |line|
  <span style="color: #859900; font-weight: bold;">next</span> <span style="color: #859900; font-weight: bold;">if</span> line =~ <span style="color: #2aa198;">/^#/</span>            <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">skip comments</span>
  parse<span style="color: #2aa198;">(</span>line<span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">unless</span> line =~ <span style="color: #2aa198;">/^$/</span> <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">don't prse empty line</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-9-5" class="outline-3">
<h3 id="sec-9-5">case Expressions</h3>
<div class="outline-text-3" id="text-9-5">
<ul class="org-ul">
<li>case 有两种表现形式
<ul class="org-ul">
<li>case后面没有表达式, 看起来if 的变体
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">case</span>
<span style="color: #859900; font-weight: bold;">when</span> song.name == <span style="color: #2aa198;">"Misty"</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Not again!"</span>
<span style="color: #859900; font-weight: bold;">when</span> song.duration &gt; 120
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Too long!"</span>
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #b58900;">Time</span>.now.hour &gt; 21
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"It's too late"</span>
<span style="color: #859900; font-weight: bold;">else</span>
  song.play
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>case 后面有表达式
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">case</span> command
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #2aa198;">"debug"</span>
  dump_debug_info
  dump_symbols
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #2aa198;">/p\s+(\w+)/</span>
  dump_variables<span style="color: #2aa198;">(</span><span style="color: #657b83; font-weight: bold;">$1</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #2aa198;">"quit"</span>, <span style="color: #2aa198;">"exit"</span>
  <span style="color: #657b83; font-weight: bold;">exit</span>
<span style="color: #859900; font-weight: bold;">else</span>
  <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"Illegal command: </span><span style="color: #268bd2;">#{command}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</li>
<li>和if一样,我们也可以把整个case 表达式赋给一个值
<div class="org-src-container">

<pre class="src src-ruby">kind = <span style="color: #859900; font-weight: bold;">case</span> year
       <span style="color: #859900; font-weight: bold;">when</span> 1850..1889 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #2aa198;">"Blues"</span>
       <span style="color: #859900; font-weight: bold;">when</span> 1890..1909 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #2aa198;">"Ragtime"</span>
       <span style="color: #859900; font-weight: bold;">when</span> 1910..1929 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #2aa198;">"New Orleans Jazz"</span>
       <span style="color: #859900; font-weight: bold;">when</span> 1930..1939 <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #2aa198;">"Swing"</span>
       <span style="color: #859900; font-weight: bold;">else</span>                 <span style="color: #2aa198;">"Jazz"</span>
</pre>
</div>
</li>
<li>我们前面讲过"==="有两种意义:
<ul class="org-ul">
<li>如果是对象调用,那么就和"=="一样(或者=~)
</li>
<li>如果是类调用(类在===前面),那么就是判断某个对象是不是某个类的实例
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Test</span>
<span style="color: #859900; font-weight: bold;">end</span>

t = <span style="color: #b58900;">Test</span>.new<span style="color: #2aa198;">()</span>
<span style="color: #657b83; font-weight: bold;">p</span> t === <span style="color: #b58900;">Test</span>
<span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #b58900;">Test</span> === t

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">false                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">true                                           #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>case + when的组合当中,比较的时候就是使用的===啦,所以可以通过如下代码来判
断某个object是什么类型的(注意when后面的是调用===的)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Test</span>
<span style="color: #859900; font-weight: bold;">end</span>

t = <span style="color: #b58900;">Test</span>.new<span style="color: #2aa198;">()</span>

<span style="color: #859900; font-weight: bold;">case</span> t
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #b58900;">Test</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"t is Test class object"</span>
<span style="color: #859900; font-weight: bold;">when</span> <span style="color: #b58900;">Integer</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"t is Integer class object"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">t is Test class object                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>也只有在case when的when后面===的"寻找是否是实例"的意义才会凸显.因为很多时
候, === 都是被重新定义的.比如在正则表达式里面===就被实际定义成类=~
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-6" class="outline-3">
<h3 id="sec-9-6">Loops</h3>
<div class="outline-text-3" id="text-9-6">
<ul class="org-ul">
<li>前面讲过if 和 unless, 在循环里面有他们俩的counterpart
<ul class="org-ul">
<li>if 对应 while:
<ol class="org-ol">
<li>都是expression为true的时候执行
</li>
<li>也可以作为modifier
<div class="org-src-container">

<pre class="src src-ruby">a = 1
a *= 2 <span style="color: #859900; font-weight: bold;">while</span> a &lt; 100
<span style="color: #657b83; font-weight: bold;">puts</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">128                                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ol>
</li>
<li>unless 对应until
<ol class="org-ol">
<li>都是expression第一次变为false的时候执行, 还要执行一次!
</li>
<li>也可以昨晚modifier
<div class="org-src-container">

<pre class="src src-ruby">a = 128
a -= 10 <span style="color: #859900; font-weight: bold;">until</span> a &lt; 100
<span style="color: #657b83; font-weight: bold;">puts</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">98                                             #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-9-6-1" class="outline-4">
<h4 id="sec-9-6-1">Iterators</h4>
<div class="outline-text-4" id="text-9-6-1">
<ul class="org-ul">
<li>ruby没有像其他语言一样内置的for, 而是"一切皆对象"的概念,把循环直接放到了数
字类里面
<div class="org-src-container">

<pre class="src src-ruby">3.times <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"Ho! "</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Ho! Ho! Ho!                                    #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>当然了,for的灵活性非常的大. ruby不支持for, 就得找一堆函数来替代它.追求的,
就是一个简单明了:
<ul class="org-ul">
<li>需要index的情况
<div class="org-src-container">

<pre class="src src-ruby">0.upto<span style="color: #2aa198;">(</span>9<span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |x|
  <span style="color: #657b83; font-weight: bold;">print</span> x, <span style="color: #2aa198;">" "</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0 1 2 3 4 5 6 7 8 9                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>每次的step不是1的情况
<div class="org-src-container">

<pre class="src src-ruby">0.step<span style="color: #2aa198;">(</span>12, 3<span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span>|x| <span style="color: #657b83; font-weight: bold;">print</span> x, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">0 3 6 9 12                                     #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>遍历数组的情况
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">[</span>1, 1, 2, 3, 5<span style="color: #2aa198;">]</span>.each <span style="color: #2aa198;">{</span>|val| <span style="color: #657b83; font-weight: bold;">print</span> val, <span style="color: #2aa198;">" "</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 1 2 3 5                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>遍历数组还想要index
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">[</span>1, 20, 300, 5000<span style="color: #2aa198;">]</span>.each_with_index <span style="color: #2aa198;">{</span>|val, ind| <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"The </span><span style="color: #268bd2;">#{ind}</span><span style="color: #2aa198;"> number is:-&gt; </span><span style="color: #268bd2;">#{val}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The 0 number is:-&gt; 1                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The 1 number is:-&gt; 20                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The 2 number is:-&gt; 300                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The 3 number is:-&gt; 5000                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
<li>ruby还是有一个最继承的loop的方法的(不过要你自己从中间break)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">loop</span> <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">block...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-6-2" class="outline-4">
<h4 id="sec-9-6-2">for &#x2026; in</h4>
<div class="outline-text-4" id="text-9-6-2">
<ul class="org-ul">
<li>我们原来说了ruby没有for.其实意思是没有内置的for&#x2026;.说白了,就是你一旦调用
for,就会被转换成each,如下
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">for</span> song <span style="color: #859900; font-weight: bold;">in</span> playlist
  song.play
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Will be translated into something like this</span>
playlist.each <span style="color: #859900; font-weight: bold;">do</span> |song|
  song.play
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>换句话说,如果你的object不支持each,就没法调用for. 而while until这种内置的循
环方法,是不需要这些先决条件的
</li>
<li>所有数组都内置each的,所以你可以这没用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">for</span> i <span style="color: #859900; font-weight: bold;">in</span> <span style="color: #2aa198;">[</span><span style="color: #2aa198;">'fee'</span>, <span style="color: #2aa198;">'fi'</span>, <span style="color: #2aa198;">'fo'</span>, <span style="color: #2aa198;">'fum'</span><span style="color: #2aa198;">]</span>
  <span style="color: #657b83; font-weight: bold;">print</span> i, <span style="color: #2aa198;">" "</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">for</span> i <span style="color: #859900; font-weight: bold;">in</span> 1..3
  <span style="color: #657b83; font-weight: bold;">print</span> i, <span style="color: #2aa198;">" "</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">fee fi fo fum 1 2 3                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们自己的object,定义了each的话,就能用for
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Periods</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">each</span>
    <span style="color: #859900; font-weight: bold;">yield</span> <span style="color: #2aa198;">"Classical"</span>
    <span style="color: #859900; font-weight: bold;">yield</span> <span style="color: #2aa198;">"Jazz"</span>
    <span style="color: #859900; font-weight: bold;">yield</span> <span style="color: #2aa198;">"Rock"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

periods = <span style="color: #b58900;">Periods</span>.new
<span style="color: #859900; font-weight: bold;">for</span> genre <span style="color: #859900; font-weight: bold;">in</span> periods
  <span style="color: #657b83; font-weight: bold;">print</span> genre, <span style="color: #2aa198;">" "</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Classical Jazz Rock                            #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-6-3" class="outline-4">
<h4 id="sec-9-6-3">break, redo, and next</h4>
<div class="outline-text-4" id="text-9-6-3">
<ul class="org-ul">
<li>break是结束当前的loop,转向loop的下一个语句
</li>
<li>next跳过剩下的语句,进行下一次循环(类似continue)
</li>
<li>redo就是重新进行当前这次循环!(不要再次做condition判断)
</li>
<li>下面的例子反映了三个关键字的作用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  <span style="color: #859900; font-weight: bold;">next</span>  <span style="color: #859900; font-weight: bold;">if</span> line =~ <span style="color: #2aa198;">/^\s*#/</span>       <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">skip comments</span>
  <span style="color: #859900; font-weight: bold;">break</span> <span style="color: #859900; font-weight: bold;">if</span> line =~ <span style="color: #2aa198;">/^END/</span>        <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">stop at end</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">substitute stuff in backticks and try again</span>
  <span style="color: #859900; font-weight: bold;">redo</span> <span style="color: #859900; font-weight: bold;">if</span> line.gsub!<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/'(.*?)'/</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #657b83; font-weight: bold;">eval</span><span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">$1</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>

  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">process line ...</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-9-7" class="outline-3">
<h3 id="sec-9-7">Variable Scope</h3>
<div class="outline-text-3" id="text-9-7">
<ul class="org-ul">
<li>如果一个local variable紧紧是定义在 code block里面, 那么当code block返回的时
候,就不能使用这个local variable, 这个是所有语言都一样的行为.变量有作用域嘛
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |x|
  y = x + 1
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">[</span>x, y<span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">#####################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                    #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">NameError: undefined local variable or method `x' for main:Object #</span>
<span style="color: #93a1a1;">#####################################################################</span>
</pre>
</div>
</li>
<li>ruby邪门就邪门在,如果这个变量之前定义过,那么ruby在code block里面,就直接使用
它了. 这个规则只适合常规变量. block的parameter(也就是x),就不适用了.
<div class="org-src-container">

<pre class="src src-ruby">x = <span style="color: #2aa198;">"initial value"</span>
y = <span style="color: #2aa198;">"another value"</span>
<span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |x|
  y = x + 1
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">[</span>x, y<span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">initial value                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">4                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>block的parameter受保护这一点,我们可以拿来大做文章!,比如首先看下面的例子.明
显的, square和total都被code block里面的代码更改了其原始值(这在普通编程语言
里面, 是非法的)
<div class="org-src-container">

<pre class="src src-ruby">square = <span style="color: #2aa198;">"yes"</span>
total = 0

<span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |val|
  square = val * val
  total += square
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Total = </span><span style="color: #268bd2;">#{total}</span><span style="color: #2aa198;">, square = </span><span style="color: #268bd2;">#{square}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Total = 14, square = 9                         #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>怎样避免这种明显的有违常理的行为呢? 当然是block的parameter list!, 使用一个
分号(;)就可以定义一些虽然不能作为code block的每次改变的那个,但是却可以防止不
小心使用使用了其他已经定义的变量. 下面的square就是正面例子, Total是反面例子
<div class="org-src-container">

<pre class="src src-ruby">square = <span style="color: #2aa198;">"yes"</span>
total = 0

<span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |val; square|
  square = val * val
  total += square
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Total = </span><span style="color: #268bd2;">#{total}</span><span style="color: #2aa198;">, square = </span><span style="color: #268bd2;">#{square}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Total = 14, square = yes                       #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">Chapter 10: Exceptions, catch, and throw</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li>和java一样,ruby是使用exception来判断错误的. exception的策略和c语言的返回值是不
一样的. exception原理是把错误包装一下,然后组成一个object, 抛给上层,然后直到有
谁知道能如何处理这个exception object
</li>
</ul>
</div>
<div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1">The Exception Class</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>所有以Exception class为root的class创建的object都是exception object
</li>
<li>你可以使用内置Exception类其中的一个,或者继承其中的某一个.不然的话,无法抛出
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2">Handling Exceptions</h3>
<div class="outline-text-3" id="text-10-2">
<ul class="org-ul">
<li>下面这个例子是从网络上面下载某个网页的程序
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'open-uri'</span>
web_page = <span style="color: #657b83; font-weight: bold;">open</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"http://pragprog.com/podcasts"</span><span style="color: #2aa198;">)</span>
output = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"podcasts.html"</span>, <span style="color: #2aa198;">"w"</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">while</span> line = web_page.gets
  output.puts line
<span style="color: #859900; font-weight: bold;">end</span>
output.close
</pre>
</div>
</li>
<li>网络是不稳定的,我们要给上面这段代码加上exception处理
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'open-uri'</span>
page = <span style="color: #2aa198;">"podcasts"</span>
file_name = <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{page}</span><span style="color: #2aa198;">.html"</span>
web_page = <span style="color: #657b83; font-weight: bold;">open</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">"http://pragprog.com/</span><span style="color: #268bd2;">#{page}</span><span style="color: #2aa198;">"</span><span style="color: #2aa198;">)</span>
output = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span>file_name, <span style="color: #2aa198;">"w"</span><span style="color: #2aa198;">)</span>

<span style="color: #859900; font-weight: bold;">begin</span>
  <span style="color: #859900; font-weight: bold;">while</span> line = web_page.gets
    output.puts line
  <span style="color: #859900; font-weight: bold;">end</span>
  output.close
<span style="color: #859900; font-weight: bold;">rescue</span> <span style="color: #b58900;">Exception</span>
  <span style="color: #b58900;">STDERR</span>.puts <span style="color: #2aa198;">"Failed to downlead </span><span style="color: #268bd2;">#{page}</span><span style="color: #2aa198;">: </span><span style="color: #268bd2;">#{$!}</span><span style="color: #2aa198;">"</span>
  output.close
  <span style="color: #b58900;">File</span>.delete<span style="color: #2aa198;">(</span>file_name<span style="color: #2aa198;">)</span>
  <span style="color: #657b83; font-weight: bold;">raise</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>上面的代码我们会发现,一旦出现了exception, ruby会把错误放到全局变量$!里面.
</li>
<li>当我们遇到了错误,关闭了stream,然后删除了文件以后.再次调用了raise.这次调用
raise没有任何参数,默认的话,就是$!里面的值.这是一种非常有用的技能,因为它可以
让你处理自己能处理的Exception,然后raise自己不能处理的给更高层代码
<pre class="example">
It allows you to write code that filters exceptions, passing
on those you can't handle to higher levels.
</pre>
</li>
<li>你还可以rescue多个语句(就像try catch,catch多个语句一样)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">begin</span>
  <span style="color: #657b83; font-weight: bold;">eval</span> string
<span style="color: #859900; font-weight: bold;">rescue</span> <span style="color: #b58900;">SyntaxError</span>, <span style="color: #b58900;">NameError</span> =&gt; boom
  <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"String doesn't compile:"</span> + boom
<span style="color: #859900; font-weight: bold;">rescue</span> <span style="color: #b58900;">StandardError</span> =&gt; bang
  <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"Error running script: "</span> + bang
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>上例中,如果rescue后面没有跟具体的Error,那么就是StandardError
</li>
<li>rescue的比较,使用的是 xxError === $!, 如果$!是xxError(superclass)的实例的话,
就会是true
</li>
</ul>
</div>
<div id="outline-container-sec-10-2-1" class="outline-4">
<h4 id="sec-10-2-1">System Erros</h4>
<div class="outline-text-4" id="text-10-2-1">
<ul class="org-ul">
<li>Ruby把Unix的经典系统错误都包装成了Class(而且是SystemCallError的子类). 并且
把这些常见错误,都定义在了Module Errno里面(也就是可以这样写Errno:EAGIN,
Errno::EIO).这些class内部还有一个class constant,也叫Errno
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">Errno</span>::<span style="color: #b58900;">EAGAIN</span>::<span style="color: #b58900;">Errno</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">Errno</span>::<span style="color: #b58900;">EPERM</span>::<span style="color: #b58900;">Errno</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">Errno</span>::<span style="color: #b58900;">EWOULDBLOCK</span>::<span style="color: #b58900;">Errno</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">11                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1                                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">10035                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">TODO on Unix                                   #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-2" class="outline-4">
<h4 id="sec-10-2-2">Tidying Up</h4>
<div class="outline-text-4" id="text-10-2-2">
<ul class="org-ul">
<li>有时候你要确保某些代码"必须执行", 无论是否出现了exception.比如你打开了文件,
而你无论如何都要把文件close掉(类似java的finally),下面就是一个例子.需要注意
的是.open要写在begin前面.因为如果open出现了exception是不会产生file的,也就
不需要close
<div class="org-src-container">

<pre class="src src-ruby">f = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile"</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">begin</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">.. process</span>
<span style="color: #859900; font-weight: bold;">rescue</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">.. handle error</span>
<span style="color: #859900; font-weight: bold;">ensure</span>
  f.close
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>ruby处理exception的时候,还有else,类似于default的情况吧.反正前面没抛出,就运
行这句, 当然最后的ensure还是肯定会运行的
<div class="org-src-container">

<pre class="src src-ruby">f = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile"</span><span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">begin</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">.. process</span>
<span style="color: #859900; font-weight: bold;">rescue</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">.. handle error</span>
<span style="color: #859900; font-weight: bold;">else</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Congratulations-- no errors!"</span>
<span style="color: #859900; font-weight: bold;">ensure</span>
  f.close
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-3" class="outline-4">
<h4 id="sec-10-2-3">Play It Again</h4>
<div class="outline-text-4" id="text-10-2-3">
<ul class="org-ul">
<li>如果有些时候,你再当前的context就可以修复问题,那么立马retry是个好主意.但是要
非常小心的使用
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #268bd2;">@esmtp</span> = <span style="color: #268bd2; font-weight: bold;">true</span>

<span style="color: #859900; font-weight: bold;">begin</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">First try an extended login. If it fails, fall back to a normal login</span>
  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">@esmtp</span> <span style="color: #859900; font-weight: bold;">then</span> <span style="color: #268bd2;">@command</span>.ehlo<span style="color: #2aa198;">(</span>helodom<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #268bd2;">@command</span>.helo<span style="color: #2aa198;">(</span>helodom<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">rescue</span> <span style="color: #b58900;">ProtocolError</span>
  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">@esmtp</span> <span style="color: #859900; font-weight: bold;">then</span>
    <span style="color: #268bd2;">@esmtp</span> = <span style="color: #268bd2; font-weight: bold;">false</span>
    <span style="color: #859900; font-weight: bold;">retry</span>
  <span style="color: #859900; font-weight: bold;">else</span>
    <span style="color: #657b83; font-weight: bold;">raise</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3">Raising Exceptions</h3>
<div class="outline-text-3" id="text-10-3">
<ul class="org-ul">
<li>抛出异常的方法是在自己的代码里面使用Object#raise函数
<div class="org-src-container">

<pre class="src src-ruby"><span class="linenr">1: </span><span style="color: #657b83; font-weight: bold;">raise</span>
<span class="linenr">2: </span><span style="color: #657b83; font-weight: bold;">raise</span> <span style="color: #2aa198;">"bad mp3 encoding"</span>
<span class="linenr">3: </span><span style="color: #657b83; font-weight: bold;">raise</span> <span style="color: #b58900;">InterfaceException</span>, <span style="color: #2aa198;">"Keyboard failure"</span>, <span style="color: #657b83; font-weight: bold;">caller</span>
</pre>
</div>
</li>
<li>上面的例子中:
<ol class="org-ol">
<li>会抛出当前exception(如果在exception handler里面的话), 或者没有当前
exception的话,就抛出RuntimeError
</li>
<li>中的情况是创建一个新的RuntimeError object, 把"bad mp3 encoding"作为参数
传递进去
</li>
<li>中的情况是创建一个新的xxException object, "Keyboard failure"作为object
的参数.然后stack trace传入到caller
</li>
</ol>
</li>
</ul>
</div>
<div id="outline-container-sec-10-3-1" class="outline-4">
<h4 id="sec-10-3-1">Adding Information to Exceptions</h4>
<div class="outline-text-4" id="text-10-3-1">
<ul class="org-ul">
<li>Exception也是class,当然可以有自己的变量
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">RetryException</span> &lt; <span style="color: #b58900;">RuntimeError</span>
  <span style="color: #657b83; font-weight: bold;">attr</span> <span style="color: #268bd2; font-weight: bold;">:ok_to_retry</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>ok_to_retry<span style="color: #2aa198;">)</span>
    <span style="color: #268bd2;">@ok_to_retry</span> = ok_to_retry
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10-4" class="outline-3">
<h3 id="sec-10-4">catch and throw</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li>前面的raise + rescue的做法其实核心是放弃当前的执行.
</li>
<li>而catch + throw,则是把问题交给更上层的context去处理
<div class="org-src-container">

<pre class="src src-ruby">word_list = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"wordlist"</span><span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">catch</span> <span style="color: #2aa198;">(</span><span style="color: #268bd2; font-weight: bold;">:done</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span>
  result = <span style="color: #2aa198;">[]</span>
  <span style="color: #859900; font-weight: bold;">while</span> line = word_list.gets
    word = line.chomp
    <span style="color: #657b83; font-weight: bold;">throw</span> <span style="color: #268bd2; font-weight: bold;">:done</span> <span style="color: #859900; font-weight: bold;">unless</span> word =~<span style="color: #2aa198;">/^\w+$/</span>
    result &lt;&lt; word
  <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> result.reverse
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">Chapter 11: Basic Input and Output</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1">What Is an IO Object?</h3>
<div class="outline-text-3" id="text-11-1">
<ul class="org-ul">
<li>Ruby中从Object下面定义了一个子类IO来负责输入输出部分
</li>
<li>IO又定义了一个子类File来处理文件,然后又定义了另一子类BasicSocket来处理socket
</li>
</ul>
</div>
<div id="outline-container-sec-11-1-1" class="outline-4">
<h4 id="sec-11-1-1">Writing to Files</h4>
<div class="outline-text-4" id="text-11-1-1">
<ul class="org-ul">
<li>来看看puts和print是怎么工作的:你传递给puts和print的object,都会调用其to_s函
数. 如果没有合适的string结果,那么会返回class name + ID的组合,例如:
#&lt;classname:0x123456&gt;
</li>
<li>写入的时候,把参数写成'w'就可以了
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"output.txt"</span>, <span style="color: #2aa198;">"w"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  file.puts <span style="color: #2aa198;">"Hello"</span>
  file.puts <span style="color: #2aa198;">"1 + 2 = </span><span style="color: #268bd2;">#{1 + 2}</span><span style="color: #2aa198;">"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Now read this file, and show its content---&gt;"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #b58900;">File</span>.read<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"output.txt"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Now read this file, and show its content---&gt;   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Hello                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 + 2 = 3                                      #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>还有一些object不是被解析成to_s:
<ul class="org-ul">
<li>nil对象会被解析成empty string
</li>
<li>array对象会把每个对象的to_s传递给puts
</li>
</ul>
</li>
<li>有三种办法把binary数据写入string:
<ul class="org-ul">
<li>literal:
<div class="org-src-container">

<pre class="src src-ruby">str1 = <span style="color: #2aa198;">"\001\002\003"</span>
<span style="color: #657b83; font-weight: bold;">p</span> str1

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"\x01\x02\x03"                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>poke it in byte by byte
<div class="org-src-container">

<pre class="src src-ruby">str2 = <span style="color: #2aa198;">""</span>
str2 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3

<span style="color: #657b83; font-weight: bold;">p</span> str2
<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"\x01\x02\x03"                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>Array#pack
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.pack<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"c*"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"\x01\x02\x03"                                 #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-1-2" class="outline-4">
<h4 id="sec-11-1-2">But I Miss My C++ iostream</h4>
<div class="outline-text-4" id="text-11-1-2">
<ul class="org-ul">
<li>在ruby里面&lt;&lt;的使用也非常灵活:
<ul class="org-ul">
<li>可以把element加入到数组里面
<div class="org-src-container">

<pre class="src src-ruby">a = <span style="color: #2aa198;">[</span>1, 2, 3, 4<span style="color: #2aa198;">]</span>
a &lt;&lt; 5
<span style="color: #657b83; font-weight: bold;">p</span> a

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">[1, 2, 3, 4, 5]                                #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>还可以把一个object加入(append)到IO stream里面
<div class="org-src-container">

<pre class="src src-ruby">endl = <span style="color: #2aa198;">"\n"</span>
<span style="color: #b58900;">STDOUT</span> &lt;&lt; 99 &lt;&lt; <span style="color: #2aa198;">" read balloons"</span> &lt;&lt; endl

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">99 read balloons                               #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-1-3" class="outline-4">
<h4 id="sec-11-1-3">Doing I/O with Strings</h4>
<div class="outline-text-4" id="text-11-1-3">
<ul class="org-ul">
<li>有时候你要做实验."假设"某些数据是从文件中读取的.但是实际上,你却没有文件,有没
有办法能模拟这些文件呢?这有点像测试里面的模拟数据库输入(在测试的时候甚至没
有创建数据库). ruby提供了StringIO来模拟文件
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'stringio'</span>

ip = <span style="color: #b58900;">StringIO</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"now is\nthe time\nto learn\nRuby!"</span><span style="color: #2aa198;">)</span>
op = <span style="color: #b58900;">StringIO</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">""</span>, <span style="color: #2aa198;">"w"</span><span style="color: #2aa198;">)</span>

ip.each_line <span style="color: #859900; font-weight: bold;">do</span> |line|
  op.puts line.reverse
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #657b83; font-weight: bold;">p</span> op.string

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"\nsi won\n\nemit eht\n\nnrael ot\n!ybuR\n"    #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2">Talking to Networks</h3>
<div class="outline-text-3" id="text-11-2">
<ul class="org-ul">
<li>Ruby在internet上面有很多方便的函数.下面的例子是查询本地local web server的信息
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'socket'</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">I open one HTTPServer with python -m SimpleHTTPServer</span>
client = <span style="color: #b58900;">TCPSocket</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'127.0.0.1'</span>, <span style="color: #2aa198;">'8000'</span><span style="color: #2aa198;">)</span>
client.send<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"OPTIONS /~dave/ HTTP/1.0\n\n"</span>, 0<span style="color: #2aa198;">)</span>
<span style="color: #657b83; font-weight: bold;">puts</span> client.readlines
client.close

<span style="color: #93a1a1;">############################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">HTTP/1.0 501 Unsupported method ('OPTIONS')                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Server: SimpleHTTP/0.6 Python/2.7.5                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Date: Sat, 17 May 2014 02:01:25 GMT                                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Content-Type: text/html                                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Connection: close                                                        #</span>
<span style="color: #93a1a1;">#                                                                          </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;head&gt;                                                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;title&gt;Error response&lt;/title&gt;                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;/head&gt;                                                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;body&gt;                                                                   #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;h1&gt;Error response&lt;/h1&gt;                                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;p&gt;Error code 501.                                                       #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;p&gt;Message: Unsupported method ('OPTIONS').                              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;p&gt;Error code explanation: 501 = Server does not support this operation. #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;/body&gt;                                                                  #</span>
<span style="color: #93a1a1;">############################################################################</span>
</pre>
</div>
</li>
<li>下面的例子是分析本书的网站TODO
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'net/http'</span>

http = <span style="color: #b58900;">Net</span>::<span style="color: #b58900;">HTTP</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'pragprog.com'</span>, 80<span style="color: #2aa198;">)</span>
response = http.get<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'/book/ruby3/programming-ruby-1-9'</span><span style="color: #2aa198;">)</span>

<span style="color: #859900; font-weight: bold;">if</span> reponse.message == <span style="color: #2aa198;">"OK"</span>
  <span style="color: #657b83; font-weight: bold;">puts</span> response.body.scan<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/&lt;img alt=".*?" src="(.*?)"/</span><span style="color: #268bd2;">m</span><span style="color: #2aa198;">)</span>.uniq<span style="color: #2aa198;">[</span>0,3<span style="color: #2aa198;">]</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>TODO
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-3" class="outline-3">
<h3 id="sec-11-3">Parsing HTML</h3>
<div class="outline-text-3" id="text-11-3">
<ul class="org-ul">
<li>TODO
</li>
</ul>
<p>
=======
</p>
</div>
</div>
<div id="outline-container-sec-11-4" class="outline-3">
<h3 id="sec-11-4">Opening and Closing Files</h3>
<div class="outline-text-3" id="text-11-4">
<ul class="org-ul">
<li>创建File object的最直接的方法当然是new
<div class="org-src-container">

<pre class="src src-ruby">file = <span style="color: #b58900;">File</span>.new<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile"</span>, <span style="color: #2aa198;">"r"</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">... process the file</span>
file.close
</pre>
</div>
</li>
<li>当然了,我们在前面还看到了更"高级的"创建File object的方法, 其高级的地方是:使
用code block来自动关闭file
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile"</span>, <span style="color: #2aa198;">"r"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">... process the file</span>
<span style="color: #859900; font-weight: bold;">end</span>                             <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;- file automatically closed here</span>
</pre>
</div>
</li>
<li>第二种方法更推荐使用:因为第一,不会忘记close flie, 第二,即便在close file之前
出现了exception, code block也能先关闭文件,然后处理exception, 其内部处理方式
类似如下:
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">File</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #b58900;">File</span>.<span style="color: #268bd2;">open</span><span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    result = f = <span style="color: #b58900;">File</span>.new<span style="color: #2aa198;">(</span>*args<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #657b83; font-weight: bold;">block_given?</span>
      <span style="color: #859900; font-weight: bold;">begin</span>
        result = <span style="color: #859900; font-weight: bold;">yield</span> f
      <span style="color: #859900; font-weight: bold;">ensure</span>
        f.close
      <span style="color: #859900; font-weight: bold;">end</span>
    <span style="color: #859900; font-weight: bold;">end</span>

    result
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-5" class="outline-3">
<h3 id="sec-11-5">Reading and Writing Files</h3>
<div class="outline-text-3" id="text-11-5">
<ul class="org-ul">
<li>前面讲过处理IO的函数gets,其为从命令行读取参数
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  <span style="color: #657b83; font-weight: bold;">puts</span> line
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby copy.rb                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">hello                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">hello                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">world                                          #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">world                                          #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>我们也可以利用到File上面(因为File也是IO的子类嘛). 所以file_obj.gets也是可以
的
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  <span style="color: #859900; font-weight: bold;">while</span> line = file.gets
    <span style="color: #657b83; font-weight: bold;">puts</span> line
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>更加神奇的是你调用copy.rb后面直接更一个文件的话, 可以读取文件的内容(虽然我
们没有写任何处理arg的代码)
<div class="org-src-container">

<pre class="src src-sh">bash-3.2$ ruby copy.rb testfile.txt
The line is: This is line one
The line is: This is line two
The line is: This is line three
The line is: And so on...
</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-sec-11-5-1" class="outline-4">
<h4 id="sec-11-5-1">Iterators for Reading</h4>
<div class="outline-text-4" id="text-11-5-1">
<ul class="org-ul">
<li>打开了文件夹,就免不了要遍历. "for line in file"的这种遍历方式虽然简单,但是
灵活性不足.所以iterator + code block的组合就无法避免了(重复一次,iterator是
内部多次调用yield,从而可以多次调用code block的函数)
</li>
<li>IO里面可以使用each_byte来创建一个iterator, 这个iterator yield的次数是:
总的byte数字除以8,换句话说就是把一个文件按照每8-bit byte来进行分割
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"testfile.txt"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |file|
  file.each_byte.with_index <span style="color: #859900; font-weight: bold;">do</span> |ch, index|
    <span style="color: #657b83; font-weight: bold;">print</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{ch.chr}</span><span style="color: #2aa198;">:</span><span style="color: #268bd2;">#{ch}</span><span style="color: #2aa198;"> "</span>
    <span style="color: #859900; font-weight: bold;">break</span> <span style="color: #859900; font-weight: bold;">if</span> index &gt; 10
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;">#######################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                      #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby each_byte.rb                                         #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">T:84 h:104 e:101  :32 l:108 i:105 n:110 e:101  :32 i:105 s:115 ::58 #</span>
<span style="color: #93a1a1;">#######################################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">Chapter 12: Fibers, Threads, and Processes</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1">Fibers</h3>
<div class="outline-text-3" id="text-12-1">
<ul class="org-ul">
<li>TODO
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">Chapter 13: Unit Testing</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>ruby对于unit test非常重视,也容易写出unit test,比如我们有下面一个例子
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">This code has bugs</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Roman</span>
  <span style="color: #b58900;">MAX_ROMAN</span> = 4999

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span><span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">if</span> value &lt;= 0 || value &gt; <span style="color: #b58900;">MAX_ROMAN</span>
      <span style="color: #859900; font-weight: bold;">fail</span> <span style="color: #2aa198;">"Roman values must be &gt; 0 and &lt;= </span><span style="color: #268bd2;">#{MAX_ROMAN}</span><span style="color: #2aa198;">"</span>
    <span style="color: #859900; font-weight: bold;">end</span>
    <span style="color: #268bd2;">@value</span> = value
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #b58900;">FACTORS</span> = <span style="color: #2aa198;">[</span><span style="color: #b58900;">[</span><span style="color: #2aa198;">"m, 1000"</span><span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"cm"</span>, 900<span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"d"</span>, 500<span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"cd"</span>, 400<span style="color: #b58900;">]</span>,
             <span style="color: #b58900;">[</span><span style="color: #2aa198;">"c,  100"</span><span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"xc"</span>,  90<span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"l"</span>,  50<span style="color: #b58900;">]</span>, <span style="color: #b58900;">[</span><span style="color: #2aa198;">"xl"</span>,  40<span style="color: #b58900;">]</span><span style="color: #2aa198;">]</span>,
             <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"x,   10"</span><span style="color: #2aa198;">]</span>, <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"ix"</span>,   9<span style="color: #2aa198;">]</span>, <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"v"</span>,   5<span style="color: #2aa198;">]</span>, <span style="color: #2aa198;">[</span><span style="color: #2aa198;">"iv"</span>,   4<span style="color: #2aa198;">]</span><span style="color: #657b83; background-color: #fdf6e3;">]</span>,
             <span style="color: #657b83; background-color: #fdf6e3;">[</span><span style="color: #2aa198;">"i"</span>,    1<span style="color: #657b83; background-color: #fdf6e3;">]]</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">to_s</span>
    value = <span style="color: #268bd2;">@value</span>
    roman = <span style="color: #2aa198;">""</span>
    <span style="color: #859900; font-weight: bold;">for</span> code, factor <span style="color: #859900; font-weight: bold;">in</span> <span style="color: #b58900;">FACTORS</span>
      count, value = value.divmod<span style="color: #657b83; background-color: #fdf6e3;">(</span>factor<span style="color: #657b83; background-color: #fdf6e3;">)</span>
      roman &lt;&lt; code <span style="color: #859900; font-weight: bold;">unless</span> count.zero?
    <span style="color: #859900; font-weight: bold;">end</span>
    roman
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>在ruby中:
<ul class="org-ul">
<li>上一代的测试框架Test::Unit, 使用test/unit
</li>
<li>新一代的测试框架是MiniTest::Unit,使用minitest/unit
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1">The Testing Framework</h3>
<div class="outline-text-3" id="text-13-1">
<ul class="org-ul">
<li>之所以使用测试框架,是基于下面三个原因:
<ul class="org-ul">
<li>测试框架提供了表达单个测试的方法
</li>
<li>测试框架提供了一种结构化你的测试的方法
</li>
<li>测试框架让你触发测试更简单
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-13-1-1" class="outline-4">
<h4 id="sec-13-1-1">Assertions == Expected Results</h4>
<div class="outline-text-4" id="text-13-1-1">
<ul class="org-ul">
<li>测试框架是不使用if语句的,而是是使用了各种的assertion.assertion就是测试给定
的两个值:1个是expected,1个是actual. 如果不相同,会返回很好的说明文字
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'romanbug'</span>
<span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'test/unit'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TestRoman</span> &lt; <span style="color: #b58900;">Test</span>::<span style="color: #b58900;">Unit</span>::<span style="color: #b58900;">TestCase</span>
  <span style="color: #b58900;">NUMBERS</span> = <span style="color: #2aa198;">{</span>1 =&gt; <span style="color: #2aa198;">"i"</span>,  2 =&gt; <span style="color: #2aa198;">"ii"</span>,
    3 =&gt; <span style="color: #2aa198;">"iii"</span>,4 =&gt; <span style="color: #2aa198;">"iv"</span>, 5=&gt; <span style="color: #2aa198;">"v"</span>, 9 =&gt; <span style="color: #2aa198;">"ix"</span>
  <span style="color: #2aa198;">}</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_simple</span>
    <span style="color: #b58900;">NUMBERS</span>.each <span style="color: #859900; font-weight: bold;">do</span> |arabic, roman|
      r = <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>arabic<span style="color: #2aa198;">)</span>
      assert_equal<span style="color: #2aa198;">(</span>roman, r.to_s<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_range</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">no exception for these two...</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>1<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>4999<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">but an exception for these</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>0<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>5000<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>我们可以借助code block来简化我们的代码
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'romanbug'</span>
<span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'test/unit'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TestRoman</span> &lt; <span style="color: #b58900;">Test</span>::<span style="color: #b58900;">Unit</span>::<span style="color: #b58900;">TestCase</span>
  <span style="color: #b58900;">NUMBERS</span> = <span style="color: #2aa198;">{</span>1 =&gt; <span style="color: #2aa198;">"i"</span>,  2 =&gt; <span style="color: #2aa198;">"ii"</span>,
    3 =&gt; <span style="color: #2aa198;">"iii"</span>,4 =&gt; <span style="color: #2aa198;">"iv"</span>, 5=&gt; <span style="color: #2aa198;">"v"</span>, 9 =&gt; <span style="color: #2aa198;">"ix"</span>
  <span style="color: #2aa198;">}</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_simple</span>
    <span style="color: #b58900;">NUMBERS</span>.each <span style="color: #859900; font-weight: bold;">do</span> |arabic, roman|
      r = <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>arabic<span style="color: #2aa198;">)</span>
      assert_equal<span style="color: #2aa198;">(</span>roman, r.to_s<span style="color: #2aa198;">)</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>

  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_range</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">no exception for these two...</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>1<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>4999<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">but an exception for these</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>0<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>5000<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>我们还可以用下面的代码来测试exception
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require_relative</span> <span style="color: #2aa198;">'romanbug'</span>
<span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'test/unit'</span>

<span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">TestRoman</span> &lt; <span style="color: #b58900;">Test</span>::<span style="color: #b58900;">Unit</span>::<span style="color: #b58900;">TestCase</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">....</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">test_range</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">no exception for these two...</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>1<span style="color: #2aa198;">)</span>
    <span style="color: #b58900;">Roman</span>.new<span style="color: #2aa198;">(</span>4999<span style="color: #2aa198;">)</span>
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">but an exception for these</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>0<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
    assert_raises<span style="color: #2aa198;">(</span><span style="color: #b58900;">RuntimeError</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">{</span> <span style="color: #b58900;">Roman</span>.new<span style="color: #b58900;">(</span>5000<span style="color: #b58900;">)</span><span style="color: #2aa198;">}</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">Chapter 14: When Troble Strikes!</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1">Ruby Debugger</h3>
<div class="outline-text-3" id="text-14-1">
<ul class="org-ul">
<li>ruby自己内置了debugger, 比如,可以使用如下
<div class="org-src-container">

<pre class="src src-sh">ruby -r debug &lt;debug-options&gt; &lt;programfile&gt; &lt;paogram-arguments&gt;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-2" class="outline-3">
<h3 id="sec-14-2">Interactive Ruby</h3>
<div class="outline-text-3" id="text-14-2">
<ul class="org-ul">
<li>Interactive Ruby也叫irb,是类似ipython的优秀ruby shell
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-3" class="outline-3">
<h3 id="sec-14-3">Editor Support</h3>
<div class="outline-text-3" id="text-14-3">
<ul class="org-ul">
<li>由于ruby可以解析传入的几行代码.所以,我们可以从编辑器里面选择几行,发送给ruby,
然后返回结果.==&gt; 在Emacs就是CTRL+C, CTRL+R (选择一个region,发送给inf-ruby)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-4" class="outline-3">
<h3 id="sec-14-4">But It Doesn't Work!</h3>
<div class="outline-text-3" id="text-14-4">
<ul class="org-ul">
<li>对写ruby代码的一点建议:
<ul class="org-ul">
<li>开启编译的warning提醒(-w)
</li>
<li>如果忘记了argument list里面的逗号,那么可能会产生非常诡异的结果
</li>
<li>在class里面operator=只能给local variable赋值.(self.xxx)
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Incorrect</span>
  <span style="color: #657b83; font-weight: bold;">attr_accessor</span> <span style="color: #268bd2; font-weight: bold;">:one</span>, <span style="color: #268bd2; font-weight: bold;">:two</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialize</span>
    one = 1                     <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">incorrect - sets local var</span>
    <span style="color: #859900; font-weight: bold;">self</span>.two = 2
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

obj = <span style="color: #b58900;">Incorrect</span>.new
<span style="color: #657b83; font-weight: bold;">p</span> obj.one
<span style="color: #657b83; font-weight: bold;">p</span> obj.two

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nil                                            #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">2                                              #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>拼写错误是经常引起ruby这种语言(动态语言,变量不需要预先定义,IDE能力也就不
足)的错误.比如下面把initialize写错了
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Incorrect</span>
  <span style="color: #657b83; font-weight: bold;">attr_reader</span> <span style="color: #268bd2; font-weight: bold;">:answer</span>
  <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">initialise</span>
    <span style="color: #268bd2;">@answer</span> = 42
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>ruby的end要写全,写匹配
</li>
<li>在全局变量和block paramter重名的情况下,开启-w flag可以察觉(写在block的||
里面,从1.9开始就会变的安全啦!)
<div class="org-src-container">

<pre class="src src-ruby">entry = <span style="color: #2aa198;">"wibble"</span>
<span style="color: #2aa198;">[</span>1, 2, 3<span style="color: #2aa198;">]</span>.each <span style="color: #859900; font-weight: bold;">do</span> |entry|
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">..</span>
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"Last entry = </span><span style="color: #268bd2;">#{entry}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">###############################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;              #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby -w scope.rb                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">scope.rb:2: warning: shadowing outer local variable - entry #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Last entry = wibble                                         #</span>
<span style="color: #93a1a1;">###############################################################</span>
</pre>
</div>
</li>
<li>我们原来说过{}和do/end是一样的,但是在结合"先后顺序"方面, 还是有不同的.比如
下面{}优先结合了靠的近的. do/end优先结合了远的.
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">one</span><span style="color: #2aa198;">(</span>arg<span style="color: #2aa198;">)</span>
  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #657b83; font-weight: bold;">block_given?</span>
    <span style="color: #2aa198;">"block given to 'one' returns </span><span style="color: #268bd2;">#{yield}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">else</span>
    arg
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">two</span>
  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #657b83; font-weight: bold;">block_given?</span>
    <span style="color: #2aa198;">"block given to 'two' returns </span><span style="color: #268bd2;">#{yield}</span><span style="color: #2aa198;">"</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

result1 = one two <span style="color: #2aa198;">{</span>
  <span style="color: #2aa198;">"three"</span>
<span style="color: #2aa198;">}</span>

result2 = one two <span style="color: #859900; font-weight: bold;">do</span>
  <span style="color: #2aa198;">"three"</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"With braces, result = </span><span style="color: #268bd2;">#{result1}</span><span style="color: #2aa198;">"</span>
<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"With do/end, result = </span><span style="color: #268bd2;">#{result2}</span><span style="color: #2aa198;">"</span>

<span style="color: #93a1a1;">############################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;           #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">With braces, result = block given to 'two' returns three #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">With do/end, result = block given to 'one' returns three #</span>
<span style="color: #93a1a1;">############################################################</span>
</pre>
</div>
</li>
<li>发送给terminal的代码是可能被buffer的.所以你把一个消息发送给STDOUT和STDERR,
有可能显示的先后顺序跟你发送的不同.
</li>
<li>从文件读取的数字可能无法正常解析,因为ruby从文件中读取的数字无法自动赋予其
Interger类型,比如
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">while</span> line = gets
  num1, num2 = line.split<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/,/</span><span style="color: #2aa198;">)</span>
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">...</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Should be rewrite as follows</span>
<span style="color: #859900; font-weight: bold;">while</span> line = gets
  num1, num2 = line.split<span style="color: #2aa198;">(</span><span style="color: #2aa198;">/,/</span><span style="color: #2aa198;">)</span>
  num1 = <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>num1<span style="color: #2aa198;">)</span>
  num2 = <span style="color: #657b83; font-weight: bold;">Integer</span><span style="color: #2aa198;">(</span>num2<span style="color: #2aa198;">)</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>
</li>
<li>在使用hash的时候,其key的要求就是不能改变其值(这也是为啥使用枚举来做key更好的原因)
</li>
<li>确认你的object的类型很简单puts my_obj.class,所以你不确定的时候,多调用几次
</li>
<li>如果你发现你的变量被"不小心"改动了,那么你可以先设置这个变量为"freeze", 然
后当有其他代码要改动它的时候.程序会出错,但是你也找到了现场.
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-5" class="outline-3">
<h3 id="sec-14-5">But It's Too Slow!</h3>
<div class="outline-text-3" id="text-14-5">
<ul class="org-ul">
<li>这里我们当然不是讨论如何让ruby像c一样快,而是希望找到某个运行缓慢的ruby程序的
"瓶颈"!
</li>
</ul>
</div>
<div id="outline-container-sec-14-5-1" class="outline-4">
<h4 id="sec-14-5-1">Benchmark</h4>
<div class="outline-text-4" id="text-14-5-1">
<ul class="org-ul">
<li>我们可以使用Benchmark这个module来测试程序每个部分的用时
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #657b83; font-weight: bold;">require</span> <span style="color: #2aa198;">'benchmark'</span>
<span style="color: #657b83; font-weight: bold;">include</span> <span style="color: #b58900;">Benchmark</span>

<span style="color: #b58900;">LOOP_COUNT</span> = 1_000_000

bmbm<span style="color: #2aa198;">(</span>12<span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span> |test|
  test.report<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"inline:"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span>
    <span style="color: #b58900;">LOOP_COUNT</span>.times <span style="color: #859900; font-weight: bold;">do</span> |x|
      <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nothing</span>
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
  test.report<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"method:"</span><span style="color: #2aa198;">)</span> <span style="color: #859900; font-weight: bold;">do</span>
    <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method</span>
      <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">nothing</span>
    <span style="color: #859900; font-weight: bold;">end</span>
    <span style="color: #b58900;">LOOP_COUNT</span>.times <span style="color: #859900; font-weight: bold;">do</span> |x|
      method
    <span style="color: #859900; font-weight: bold;">end</span>
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #93a1a1;">##############################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Rehearsal ------------------------------------------------ #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">inline:        0.080000   0.010000   0.090000 (  0.073090) #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">method:        0.120000   0.000000   0.120000 (  0.126332) #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">--------------------------------------- total: 0.210000sec #</span>
<span style="color: #93a1a1;">#                                                            </span><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;">#                    </span><span style="color: #93a1a1;">user     system      total        real  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">inline:        0.060000   0.000000   0.060000 (  0.063819) #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">method:        0.120000   0.000000   0.120000 (  0.115828) #</span>
<span style="color: #93a1a1;">##############################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-5-2" class="outline-4">
<h4 id="sec-14-5-2">Profiler</h4>
<div class="outline-text-4" id="text-14-5-2">
<ul class="org-ul">
<li>Benchmark是一种比较"实践"的办法:其计算每个部分的绝对时间.而profiler是计算
每个部分的运行次数(有点复杂度分析的意思), 这样更容易从"理论"上找到性能瓶颈
<div class="org-src-container">

<pre class="src src-ruby">count = 0
words = <span style="color: #b58900;">File</span>.open<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"/usr/share/dict/words"</span><span style="color: #2aa198;">)</span>

<span style="color: #859900; font-weight: bold;">while</span> word = words.gets
  word = word.chomp!
  <span style="color: #859900; font-weight: bold;">if</span> word.length == 12
    count += 1
  <span style="color: #859900; font-weight: bold;">end</span>
<span style="color: #859900; font-weight: bold;">end</span>

<span style="color: #657b83; font-weight: bold;">puts</span> <span style="color: #2aa198;">"</span><span style="color: #268bd2;">#{count}</span><span style="color: #2aa198;"> twelve-character words"</span>

<span style="color: #93a1a1;">######################################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                                     #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">bash-3.2$ ruby -r profile profileeg.rb                                             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">20462 twelve-character words                                                       #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">%   cumulative   self              self     total                                #</span>
<span style="color: #93a1a1;">#  </span><span style="color: #93a1a1;">time   seconds   seconds    calls  ms/call  ms/call  name                         #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">7.80     0.91      0.91   235887     0.00     0.00  IO#gets                      #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">7.38     1.77      0.86   235886     0.00     0.00  Fixnum#==                    #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">6.60     2.54      0.77   235886     0.00     0.00  String#length                #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">5.75     3.21      0.67   235886     0.00     0.00  String#chomp!                #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.43     3.26      0.05    20462     0.00     0.00  Fixnum#+                     #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  TracePoint#enable            #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  MonitorMixin#mon_exit        #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        2     0.00     0.00  IO#set_encoding              #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  File#initialize              #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  IO.open                      #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  Mutex#unlock                 #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  MonitorMixin#mon_check_owner #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  MonitorMixin#mon_enter       #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  Mutex#lock                   #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        3     0.00     0.00  Thread.current               #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  Fixnum#to_s                  #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        2     0.00     0.00  IO#write                     #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  IO#puts                      #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  Kernel#puts                  #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00     3.26      0.00        1     0.00     0.00  TracePoint#disable           #</span>
<span style="color: #93a1a1;">#   </span><span style="color: #93a1a1;">0.00    11.66      0.00        1     0.00 11660.00  #toplevel                    #</span>
<span style="color: #93a1a1;">######################################################################################</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-5-3" class="outline-4">
<h4 id="sec-14-5-3">Code Execution Coverage</h4>
<div class="outline-text-4" id="text-14-5-3">
<ul class="org-ul">
<li>从ruby 1.9.2开始,出现了一个新的特性:low-level code coverage. 能够检测当前
是哪行代码在执行.
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

         <!-- Disqus Comment BEGIN -->
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'harrifeng';

              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

         <!-- Disqus Comment END -->
</div>
</body>
</html>
