<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>user-manual</title>
<!-- 2017-05-02 Tue 10:49 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="your name" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

         <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Galdeano|Open+Sans:600italic,400,600|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
         <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://harrifeng.github.io/sitemap.html"> UP </a>
 |
 <a accesskey="H" href="http://harrifeng.github.io/index.html"> HOME </a>
</div><div id="preamble" class="status">

         <div id="header">
            <div id="header-top">
                <div id="blog-title">Harrifeng's Path</div>
                <div id="blog-sub-title">纸上得来终觉浅,绝知此事要Coding</div>
            </div>
            <div id="nav">
                <ul>
                    <li><a href="/">首页</a></li>
                    <li><a href="/about.html">About Me</a></li>
                    <li>
                    </li>
                </ul>
            </div>
         </div>
</div>
<div id="content">
<h1 class="title">user-manual</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Chapter 1: Introduction</a></li>
<li><a href="#sec-2">Chapter 2: Overview</a></li>
<li><a href="#sec-3">Chapter 3: Tutorials</a></li>
<li><a href="#sec-4">Chapter 4: Installing Gradle</a></li>
<li><a href="#sec-5">Chapter 5: Troubleshooting</a></li>
<li><a href="#sec-6">Chapter 6: Build Script Basics</a>
<ul>
<li><a href="#sec-6-1">Projects and tasks</a></li>
<li><a href="#sec-6-2">Hello world</a></li>
<li><a href="#sec-6-3">A shortcut task definition</a></li>
<li><a href="#sec-6-4">Build scripts are code</a></li>
<li><a href="#sec-6-5">Task dependecies</a></li>
<li><a href="#sec-6-6">Dynamic tasks</a></li>
<li><a href="#sec-6-7">Manipulating existing tasks</a></li>
<li><a href="#sec-6-8">Shortcut notations</a></li>
<li><a href="#sec-6-9">Extra task properties</a></li>
<li><a href="#sec-6-10">Using Ant Tasks</a></li>
<li><a href="#sec-6-11">Using methods</a></li>
<li><a href="#sec-6-12">Default tasks</a></li>
<li><a href="#sec-6-13">Configure by DAG</a></li>
</ul>
</li>
<li><a href="#sec-7">Chapter 7: Java Quick</a>
<ul>
<li><a href="#sec-7-1">The Java plugin</a></li>
<li><a href="#sec-7-2">A basic Java project</a>
<ul>
<li><a href="#sec-7-2-1">Building the project</a></li>
<li><a href="#sec-7-2-2">External dependencies</a></li>
<li><a href="#sec-7-2-3">Customizing the project</a></li>
<li><a href="#sec-7-2-4">Publishing the JAR file</a></li>
</ul>
</li>
<li><a href="#sec-7-3">Multi-project Java build</a></li>
</ul>
</li>
<li><a href="#sec-8">Chapter 8: Dependency Management Basics</a>
<ul>
<li><a href="#sec-8-1">What is dependency management?</a></li>
<li><a href="#sec-8-2">Declaring your dependencies</a></li>
<li><a href="#sec-8-3">Dependency configurations</a></li>
<li><a href="#sec-8-4">External dependencies</a></li>
<li><a href="#sec-8-5">Repositories</a></li>
</ul>
</li>
<li><a href="#sec-9">Chapter 9: Groovy Quickstart</a>
<ul>
<li><a href="#sec-9-1">A basic Groovy project</a></li>
</ul>
</li>
<li><a href="#sec-10">Chapter 10: Web Application Quickstart</a>
<ul>
<li><a href="#sec-10-1">Building a WAR file</a></li>
</ul>
</li>
<li><a href="#sec-11">Chapter 11: Using the Gradle Command-Line</a>
<ul>
<li><a href="#sec-11-1">Executing multiple tasks</a></li>
<li><a href="#sec-11-2">Continuing the build when a failure occurs</a></li>
<li><a href="#sec-11-3">Task name abbreviation</a></li>
<li><a href="#sec-11-4">Selecting which build to execute</a></li>
<li><a href="#sec-11-5">Obtaining information about your build</a></li>
</ul>
</li>
<li><a href="#sec-12">Chapter 12 Using the Gradle Graphical User Interface</a></li>
<li><a href="#sec-13">Chapter 13 Writing Build Scripts</a>
<ul>
<li><a href="#sec-13-1">The Gradle build language</a></li>
<li><a href="#sec-13-2">The Project API</a></li>
<li><a href="#sec-13-3">The Script API</a></li>
<li><a href="#sec-13-4">Declaring variables</a>
<ul>
<li><a href="#sec-13-4-1">Local Variables</a></li>
<li><a href="#sec-13-4-2">Extra properties</a></li>
</ul>
</li>
<li><a href="#sec-13-5">Some Groovy basics</a>
<ul>
<li><a href="#sec-13-5-1">Groovy JDK</a></li>
<li><a href="#sec-13-5-2">Property accessors</a></li>
<li><a href="#sec-13-5-3">Optional parentheses on method calls</a></li>
<li><a href="#sec-13-5-4">List and map literals</a></li>
<li><a href="#sec-13-5-5">Closures as the last parameter in a method</a></li>
<li><a href="#sec-13-5-6">Closure delegate</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-14">Chapter 14 Tutorial - 'This and That'</a>
<ul>
<li><a href="#sec-14-1">Directory creation</a></li>
<li><a href="#sec-14-2">Gradle properties and system properties</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Chapter 1: Introduction</h2>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Chapter 2: Overview</h2>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Chapter 3: Tutorials</h2>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Chapter 4: Installing Gradle</h2>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Chapter 5: Troubleshooting</h2>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Chapter 6: Build Script Basics</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Projects and tasks</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>Gradle里面任何的事情都是建立在两个概念上的: projects 和 tasks
</li>
<li>一个Gradle里面有多个projects:一个project能够展现什么决定于你要Gradle来做什
么(比如是一个web application),一个project并不需要一定要build出来什么东西,
因为它其实只是做些事情,比如把我们的代码部署到生产环境
</li>
<li>而一个project是由多个task组成的. task是一个"原子化"的操作(也就是无法再细分
的操作): 比如通过jar command line来生产jar文件.本身是一个command line命令,
无法再分割.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Hello world</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>先来看看第一个hello world例子.
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> <span style="color: #2aa198;">{</span>
    doLast <span style="color: #b58900;">{</span>
        println <span style="color: #2aa198;">'Hello world!'</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>这里使用了-q这个参数,防止gradle log显示出来.
<pre class="example">
i309511:tmp $ gradle -q hello
Hello world!
</pre>
</li>
<li>如果你有过ant的经验的话,你会发现所谓task其实就是ant里面的target, ant自己定
义了一堆target,但是gradle的task更牛逼,原则上说groovy能做的就能定义成gradle
的task
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">A shortcut task definition</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>有时候,上面的doLast可以省略为"&lt;&lt;",于是就有了如下的简约版
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello world!'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4">Build scripts are code</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li>简言之groovy能做的,task都能做,比如下例中的大小写转换.
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">upper</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    <span style="color: #b58900;">String</span> <span style="color: #268bd2;">someString</span> = <span style="color: #2aa198;">'mY_nAme'</span>
    println <span style="color: #2aa198;">"Original: "</span> + someString;
    println <span style="color: #2aa198;">"Upper case: "</span> + someString.toUpperCase<span style="color: #b58900;">()</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-2 $ gradle -q upper         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Original: mY_nAme                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Upper case: MY_NAME                            //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>比如打印序列
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">count</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    4.times <span style="color: #b58900;">{</span> print <span style="color: #2aa198;">"$it "</span> <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-3 $ gradle -q count         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">0 1 2 3                                        //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5">Task dependecies</h3>
<div class="outline-text-3" id="text-6-5">
<ul class="org-ul">
<li>就像和target是相互依赖一样, task也是可以相互依赖的.
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello world!'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">intro</span><span style="color: #2aa198;">(</span>dependsOn: hello<span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"I'm Gradle"</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-4 $ gradle -q intro         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello world!                                   //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm Gradle                                     //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>依赖关系里面被依赖的task还可以在以后声明的(不需要c语言里面的前置声明)
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">taskX</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #2aa198;">'taskY'</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'taskX'</span>
<span style="color: #2aa198;">}</span>
<span style="color: #b58900;">task</span> <span style="color: #268bd2;">taskY</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'taskY'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-5 $ gradle -q taskX         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">taskY                                          //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">taskX                                          //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>注意!在设置dependency的时候,是需要全名,而不是后面介绍的shortcut notation
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6">Dynamic tasks</h3>
<div class="outline-text-3" id="text-6-6">
<ul class="org-ul">
<li>我们还可以动态的创建task,这是原来ant可望而不可及的
<div class="org-src-container">

<pre class="src src-groovy">4.times <span style="color: #2aa198;">{</span> counter -&gt;
    task <span style="color: #2aa198;">"task$counter"</span> &lt;&lt; <span style="color: #b58900;">{</span>
        println <span style="color: #2aa198;">"I'm task number $counter"</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-6 $ gradle -q task1         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm task number 1                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-6 $ gradle -q task3         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm task number 3                              //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-7" class="outline-3">
<h3 id="sec-6-7">Manipulating existing tasks</h3>
<div class="outline-text-3" id="text-6-7">
<ul class="org-ul">
<li>这种"动态"创建的task, 还可以相互依赖!
<div class="org-src-container">

<pre class="src src-groovy">4.times <span style="color: #2aa198;">{</span> counter -&gt;
    task <span style="color: #2aa198;">"task$counter"</span> &lt;&lt; <span style="color: #b58900;">{</span>
        println <span style="color: #2aa198;">"I'm task number $counter"</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>
task0.<span style="color: #b58900;">dependsOn</span> <span style="color: #268bd2;">task2</span>, <span style="color: #268bd2;">task3</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-7 $ gradle -q task0         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm task number 2                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm task number 3                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I'm task number 0                              //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>我们还可以在某个task已经创建了的情况下, 继续"补充"这个task, 必须下面的例子,
在hello task已经创建的情况下,还可以继续补充hello task.注意"&lt;&lt;"其实就是doLast
的别名.
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello Earth'</span>
<span style="color: #2aa198;">}</span>
hello.doFirst <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello Venus'</span>
<span style="color: #2aa198;">}</span>
hello.doLast <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello Mars'</span>
<span style="color: #2aa198;">}</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Notice: &lt;&lt; is actually alias for doLast</span>
hello &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello Jupiter'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-8 $ gradle -q hello         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello Venus                                    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello Earth                                    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello Mars                                     //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello Jupiter                                  //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-8" class="outline-3">
<h3 id="sec-6-8">Shortcut notations</h3>
<div class="outline-text-3" id="text-6-8">
<ul class="org-ul">
<li>一旦一个task创建了以后,这个task其实就是以一个property的形式存在了.你可以在
其他的task里面加上'$'来调用它
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Hello world'</span>
<span style="color: #2aa198;">}</span>
hello.doLast <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"Greetings from the $hello.name task."</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-9 $ gradle -q hello         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Hello world                                    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Greetings from the hello task.                 //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-9" class="outline-3">
<h3 id="sec-6-9">Extra task properties</h3>
<div class="outline-text-3" id="text-6-9">
<ul class="org-ul">
<li>除了task"已经存在的"property, 你还可以设置extra task, 设置方法就是ext.xxx =
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">myTask</span> <span style="color: #2aa198;">{</span>
    ext.myProperty = <span style="color: #2aa198;">"myValue"</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">printTaskProperties</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    <span style="color: #b58900;">println</span> myTask.<span style="color: #268bd2;">myProperty</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;        //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-10 $ gradle -q printTaskProperties //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">myValue                                               //</span>
<span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-10" class="outline-3">
<h3 id="sec-6-10">Using Ant Tasks</h3>
<div class="outline-text-3" id="text-6-10">
<ul class="org-ul">
<li>Gradle里面也是可以使用ant
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-11" class="outline-3">
<h3 id="sec-6-11">Using methods</h3>
<div class="outline-text-3" id="text-6-11">
<ul class="org-ul">
<li>Gradle里面是可以设置函数的, 然后这个函数就可以在"同一个project里面的多个
subproject之间"共享
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-12" class="outline-3">
<h3 id="sec-6-12">Default tasks</h3>
<div class="outline-text-3" id="text-6-12">
<ul class="org-ul">
<li>Ant每次ant一下就运行,是因为有default target, gradle也有default task
<div class="org-src-container">

<pre class="src src-groovy">defaultTasks <span style="color: #2aa198;">'clean'</span>, <span style="color: #2aa198;">'run'</span>

task clean &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Default Cleaning!'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">run</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'Default Running!'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">other</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"I'm not a default task!"</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-11 $ gradle -q              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Default Cleaning!                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Default Running!                               //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-13" class="outline-3">
<h3 id="sec-6-13">Configure by DAG</h3>
<div class="outline-text-3" id="text-6-13">
<ul class="org-ul">
<li>后面会说到Gradle是由两个phase的:
<ul class="org-ul">
<li>configuration phase
</li>
<li>execution phase
</li>
</ul>
</li>
<li>gradle还可以在"运行时"来判断,某个task是否被用户多调用, 比如下面我们可以查看
release task是不是已经在我们的用户输入里面,如果在的话,我们就会打印1.0否则打
印1.0-SNAPSHOT
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">distribution</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"We build the zip with version=$version"</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">release</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #2aa198;">'distribution'</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'We release now'</span>
<span style="color: #2aa198;">}</span>

gradle.taskGraph.whenReady <span style="color: #2aa198;">{</span> taskGraph -&gt;
    <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900;">(</span>taskGraph.hasTask<span style="color: #268bd2;">(</span>release<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
        version = <span style="color: #2aa198;">'1.0'</span>
    <span style="color: #b58900;">}</span> <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #b58900;">{</span>
        version = <span style="color: #2aa198;">'1.0-SNAPSHOT'</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-12 $ gradle -q distribution //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">We build the zip with version=1.0-SNAPSHOT     //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:6-12 $ gradle -q release      //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">We build the zip with version=1.0              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">We release now                                 //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Chapter 7: Java Quick</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">The Java plugin</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li>正如我们看到的一样,其实gradle是用groovy的代码逻辑来实现原来ant的功能.换句话
说要得到某些你想要的"流程"你还是要付出代码的
</li>
<li>但是很多java工程的"大体"上的"流程"都是相似的,比如都要编译,然后打包,然后发布,
这些常规流程的代码也是一样的,把他们总结起来就是maven的plugin功能, gradle完整
的把这个功能给学来了.
</li>
<li>最常用的的plugin就是叫做Java plugin
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">A basic Java project</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>我们来看看一个最简单的java plugin
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'java'</span>
</pre>
</div>
</li>
<li>是的,就这么一行,这一行却包含很多"约定俗成", 比如:
<ul class="org-ul">
<li>源代码放到src/main/java
</li>
<li>测试放到src/test/java
</li>
<li>JAR resource文件放到src/test/resources
</li>
</ul>
</li>
<li>gradle tasks可以看到到底有哪些task被加入进来
<pre class="example">
c:\code\gradle-in-action\user-manual\7\1&gt;gradle tasks
gradle tasks
:tasks

------------------------------------------------------------
All tasks runnable from root project
------------------------------------------------------------

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles classes 'main'.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the main classes.
testClasses - Assembles classes 'test'.

Build Setup tasks
-----------------
init - Initializes a new Gradle build. [incubating]
wrapper - Generates Gradle wrapper files. [incubating]

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.

Help tasks
----------
components - Displays the components produced by root project '1'. [incubating]
dependencies - Displays all dependencies declared in root project '1'.
dependencyInsight - Displays the insight into a specific dependency in root project '1'.
help - Displays a help message.
projects - Displays the sub-projects of root project '1'.
properties - Displays the properties of root project '1'.
tasks - Displays the tasks runnable from root project '1'.

Verification tasks
------------------
check - Runs all checks.
test - Runs the unit tests.

Rules
-----
Pattern: clean&lt;TaskName&gt;: Cleans the output files of a task.
Pattern: build&lt;ConfigurationName&gt;: Assembles the artifacts of a configuration.
Pattern: upload&lt;ConfigurationName&gt;: Assembles and uploads the artifacts belonging to a configuration.

To see all tasks and more detail, run gradle tasks --all

To see more detail about a task, run gradle help --task &lt;task&gt;

BUILD SUCCESSFUL

Total time: 2.334 secs
</pre>
</li>
</ul>
</div>
<div id="outline-container-sec-7-2-1" class="outline-4">
<h4 id="sec-7-2-1">Building the project</h4>
<div class="outline-text-4" id="text-7-2-1">
<ul class="org-ul">
<li>虽然gradle加入了很多的task到java plugin里面,但是最有用的是如下:
<ul class="org-ul">
<li>gradle build: compile 并且 test代码,生产jar文件
<pre class="example">
c:\code\gradle-in-action\user-manual\7\1&gt;gradle build
gradle build
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:jar
:assemble
:compileTestJava UP-TO-DATE
:processTestResources UP-TO-DATE
:testClasses UP-TO-DATE
:test UP-TO-DATE
:check UP-TO-DATE
:build

BUILD SUCCESSFUL

Total time: 4.25 secs
</pre>
</li>
<li>gradle clean: 会删除build 文件夹,以及里面的所有文件
<pre class="example">
c:\code\gradle-in-action\user-manual\7\1&gt;gradle clean
gradle clean
:clean

BUILD SUCCESSFUL

Total time: 2.028 secs
</pre>
</li>
<li>gradle assemble: 只编译并且jar,但是不测试
<pre class="example">
c:\code\gradle-in-action\user-manual\7\1&gt;gradle assemble
gradle assemble
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:jar
:assemble

BUILD SUCCESSFUL

Total time: 2.156 secs
</pre>
</li>
<li>gradle check: 编译并测试
<pre class="example">
c:\code\gradle-in-action\user-manual\7\1&gt;gradle check
gradle check
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:compileTestJava UP-TO-DATE
:processTestResources UP-TO-DATE
:testClasses UP-TO-DATE
:test UP-TO-DATE
:check UP-TO-DATE

BUILD SUCCESSFUL

Total time: 2.031 secs
</pre>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-2" class="outline-4">
<h4 id="sec-7-2-2">External dependencies</h4>
<div class="outline-text-4" id="text-7-2-2">
<ul class="org-ul">
<li>Java的项目通常需要外部的lib, 而gradle找这些lib的地方就叫做repository
</li>
<li>一个repository一般来说就是用来fetch lib的, 如果你本身就是lib的作者,当然也
可以用来pull啦
</li>
<li>对于gradle来说,其repo可以依靠其他的开源工程,换句话说就是依靠maven
<div class="org-src-container">

<pre class="src src-groovy">repositories <span style="color: #2aa198;">{</span>
    mavenCentral<span style="color: #b58900;">()</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>一个完整的java plugin依赖如下, 其中dependencies的内容是第八章
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'java'</span>

repositories <span style="color: #2aa198;">{</span>
    mavenCentral<span style="color: #b58900;">()</span>
<span style="color: #2aa198;">}</span>

dependencies <span style="color: #2aa198;">{</span>
    compile <span style="color: #b58900;">group</span>: <span style="color: #2aa198;">'org.hibernate'</span>, name: <span style="color: #2aa198;">'hibernate-core'</span>, version: <span style="color: #2aa198;">'3.6.7.Final'</span>
    testCompile group: <span style="color: #2aa198;">'junit'</span>, name: <span style="color: #2aa198;">'junit'</span>, version: <span style="color: #2aa198;">'4.+'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-3" class="outline-4">
<h4 id="sec-7-2-3">Customizing the project</h4>
<div class="outline-text-4" id="text-7-2-3">
<ul class="org-ul">
<li>我们的java plugin是自带很多的properties的(可以通过gradle properties来查阅),
这些properties是有默认值的,但是你可以在build.gradle里面进行修改
<pre class="example">
c:\code\gradle-in-action\user-manual\7\3&gt;cat build.gradle
cat build.gradle
apply plugin: 'java'


c:\code\gradle-in-action\user-manual\7\3&gt;gradle properties
gradle properties
:properties

------------------------------------------------------------
Root project
------------------------------------------------------------

allprojects: [root project '3']
ant: org.gradle.api.internal.project.DefaultAntBuilder@7ca8d498
antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@7187bac9
archivesBaseName: 3
artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler_Decorated@6b8280e6
# ....
sourceCompatibility: 1.8
sourceSets: [source set 'main', source set 'test']
#...
version: unspecified

BUILD SUCCESSFUL

Total time: 2.187 secs
c:\code\gradle-in-action\user-manual\7\3&gt;cat build.gradle
cat build.gradle
apply plugin: 'java'

sourceCompatibility = 1.5
version = '1.0'

c:\code\gradle-in-action\user-manual\7\3&gt;gradle properties
gradle properties
:properties

------------------------------------------------------------
Root project
------------------------------------------------------------

allprojects: [root project '3']
ant: org.gradle.api.internal.project.DefaultAntBuilder@1cd3b138
antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@151bf776
archivesBaseName: 3
artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler_Decorated@5a6d30e2
#...
sourceCompatibility: 1.5
#...
version: 1.0

BUILD SUCCESSFUL

Total time: 2.875 secs
</pre>
</li>
<li>除了能够"更改"已有的properties, 我们还可以"凭空增加"一些properties,比如在
test task里面增加一个system property
<div class="org-src-container">

<pre class="src src-groovy">test <span style="color: #2aa198;">{</span>
    systemProperties <span style="color: #2aa198;">'property'</span>: <span style="color: #2aa198;">'value'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-4" class="outline-4">
<h4 id="sec-7-2-4">Publishing the JAR file</h4>
<div class="outline-text-4" id="text-7-2-4">
<ul class="org-ul">
<li>简言之就是在java plugin下面,你需要告诉gradle把你的jar文件生成到哪里去.默认
是publish到repository的, 我们下面把它改到publish到local
<div class="org-src-container">

<pre class="src src-groovy">uploadArchives <span style="color: #2aa198;">{</span>
    repositories <span style="color: #b58900;">{</span>
        flatDir <span style="color: #268bd2;">{</span>
            dirs <span style="color: #2aa198;">'repos'</span>
        <span style="color: #268bd2;">}</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>或许你想到了, 既然更改了uploadArchives,那么你运行gradle uploadArchives就自
然可以生成jar到local位置了
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Multi-project Java build</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>TODO
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Chapter 8: Dependency Management Basics</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">What is dependency management?</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>dependency management一般来说,有两个方面的考虑:
<ul class="org-ul">
<li>Gradle需要知道你的project需要依赖"一些files"(一般来说是lib)来运行自己的项
目, 我们把这些"incoming files"叫做project的dependencies
</li>
<li>Gradle还需要把你项目的产品ship出去, 我们把这些"outgoing files"叫做project
的publication
</li>
</ul>
</li>
<li>一般来说,一个项目是不可能书写自己的需要的所有代码,肯定是需要dependencies的(也
就是我们说的lib).gradle可以帮你找到这些lib,然后帮你放到PATH里面.
</li>
<li>gradle获得这些lib的方式很多样, 可以是:
<ul class="org-ul">
<li>从Maven下载
</li>
<li>从Ivy下载
</li>
<li>本地文件
</li>
<li>或者是multi-projects里面的另外的一个project里面(这也算是'自己书写的lib')
</li>
</ul>
</li>
<li>一般来说, 一个我们project所依赖的这些dependencies本身也需要很多的自己的dependencies
比如Hibernate core在运行的时候,也还需要很多其他的lib"放置在classpath里面",
所以gradle同时也会为我们"找到,下载,放置classpath"这些lib. 这个过程叫做transitive
dependencies
</li>
<li>一般来说,我们每个project写的代码,都是要"给其他用户用"的,所以我们要发布它们.
所谓"发布"并不一定是传到网上公开地址,也可能就是传到服务器的某个位置,或者是
传到手机上,甚至只是multi-project的其他project来使用.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Declaring your dependencies</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>下面就是一个dependency的例子
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'java'</span>

repositories <span style="color: #2aa198;">{</span>
    mavenCentral<span style="color: #b58900;">()</span>
<span style="color: #2aa198;">}</span>

dependencies <span style="color: #2aa198;">{</span>
    compile <span style="color: #b58900;">group</span>: <span style="color: #2aa198;">'org.hibernate'</span>, name: <span style="color: #2aa198;">'hibernate-core'</span>, version: <span style="color: #2aa198;">'3.6.7.Final'</span>
    testCompile group: <span style="color: #2aa198;">'junit'</span>, name: <span style="color: #2aa198;">'junit'</span>, version: <span style="color: #2aa198;">'4.+'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>这个例子有如下的要求会列出:
<ul class="org-ul">
<li>使用Maven的repo
</li>
<li>hibernate core的version为3.6.7 Final, 而且hibernate core3.6.7Final的
dependency会自动下载
</li>
<li>所有大于4.0版本的junit都可以
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3">Dependency configurations</h3>
<div class="outline-text-3" id="text-8-3">
<ul class="org-ul">
<li>从上面的例子我们可以看出gradle的lib dependency是区分不同group的对于java
plugin来说主要的group有:
<ul class="org-ul">
<li>compile : 编译source 代码需要的dependency
</li>
<li>runtime : 运行source 代码需要的dependency,默认会包括compile group里面的dependency
</li>
<li>testCompile : 编译test 代码需要的dependency,默认包括compile group 里面的
dependency
</li>
<li>testRuntime : 运行测试test 代码需要的dependency, 默认包括compile, runtime,
testCompile三者里面的dependency
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4">External dependencies</h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li>dependency最常见的就是外部依赖(也就是lib啦), 以下面的compile group为例(注意
下面的compile后面的group只是凑巧compile的第一个参数是group), compile组有三个
参数group, name, 还有version
<div class="org-src-container">

<pre class="src src-groovy">dependencies <span style="color: #2aa198;">{</span>
    compile <span style="color: #b58900;">group</span>: <span style="color: #2aa198;">'org.hibernate'</span>, name: <span style="color: #2aa198;">'hibernate-core'</span>, version: <span style="color: #2aa198;">'3.6.7.Final'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>也可以简写成"group:name:version"
<div class="org-src-container">

<pre class="src src-groovy">dependencies <span style="color: #2aa198;">{</span>
    compile <span style="color: #2aa198;">'org.hibernate:hibernate-core:3.6.7.Final'</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5">Repositories</h3>
<div class="outline-text-3" id="text-8-5">
<ul class="org-ul">
<li>groovy自己是没有repository的,它是"假借"其他开源项目的地址:
<ul class="org-ul">
<li>比如可以使用maven的central地址
<div class="org-src-container">

<pre class="src src-groovy">repositories <span style="color: #2aa198;">{</span>
    mavenCentral<span style="color: #b58900;">()</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>Maven的url地址
</li>
<li>Ivy的url地址
</li>
<li>local地址(虽然写的是ivy,对maven也适用)
</li>
</ul>
</li>
<li>我们也可以简写成group:name:version
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">Chapter 9: Groovy Quickstart</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1">A basic Groovy project</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>除了java plugin,gradle自然是groovy写成的语言,自然可以用来管理groovy语言的
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'groovy'</span>
</pre>
</div>
</li>
<li>这个plugin和java类似,只不过:
<ul class="org-ul">
<li>代码是在src/main/groovy
</li>
<li>测试代码是在src/test/groovy
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">Chapter 10: Web Application Quickstart</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1">Building a WAR file</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>和java plugin, groovy plugin一样的,我们还有webapp plugin, 但是只是文件夹名
字叫webapp(比如src/main/webapp),其plugin的名字叫做war
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'war'</span>
</pre>
</div>
</li>
<li>在maven里面,我们见识了配置一行就可以使用jetty的功能,现在gradle也有
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'jetty'</span>
</pre>
</div>
</li>
<li>其使用的命令有:
<ul class="org-ul">
<li>gradle jettyRun : 运行web application
</li>
<li>gradle jettyRunWar : 编译代码生成war,然后运行web application
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">Chapter 11: Using the Gradle Command-Line</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1">Executing multiple tasks</h3>
<div class="outline-text-3" id="text-11-1">
<ul class="org-ul">
<li>gradle后面是可以跟"几个"task的, 比如
<pre class="example">
&gt; gradle compile test
</pre>
</li>
<li>就会按照顺序首先运行compile(以及其dependency), 然后运行test(以及其dependency)
</li>
<li>需要注意的是,所有的task只运行一遍:这里的所有包括dependencies, 比如上面的例
子,假设task x是compile, 以及test的dependency,那么只运行一遍task x
</li>
<li>比如下面的例子,其实task test就不会再运行了(因为dist 已经包括它了)
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">+------------------------------------------+    //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">|                                          |    //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">V                                          |    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">+---------+   +-------------+   +-------+    +---+--+ //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">| compile |&lt;--+ compileTest |&lt;--+ test  |&lt;---+ dist | //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">+---------+   +-------------+   +-----+-+    +------+ //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">^                               |               //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">|                               |               //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">+-------------------------------+               //</span>
<span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compile</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling source'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compileTest</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling unit test'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">test</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, compileTest<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'running unit tests'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">dist</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, test<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'building the distrubution'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:1 $ gradle dist test          //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compile                                       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling source                                //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compileTest                                   //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling unit test                             //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:test                                          //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">running unit tests                             //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:dist                                          //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">building the distrubution                      //</span>
<span style="color: #93a1a1;">//                                                </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">BUILD SUCCESSFUL                               //</span>
<span style="color: #93a1a1;">//                                                </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Total time: 2.511 secs                         //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>你还可以使用-x参数来去掉你目标task里的一个dependency task
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">+------------------------------------------+    //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">|                                          |    //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">V                                          |    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">+---------+   +-------------+   +-------+    +---+--+ //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">| compile |&lt;--+ compileTest |&lt;--+ test  |&lt;---+ dist | //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">+---------+   +-------------+   +-----+-+    +------+ //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">^                               |               //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">|                               |               //</span>
<span style="color: #93a1a1;">//       </span><span style="color: #93a1a1;">+-------------------------------+               //</span>
<span style="color: #93a1a1;">///////////////////////////////////////////////////////////</span>
<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compile</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling source'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compileTest</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling unit test'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">test</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, compileTest<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'running unit tests'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">dist</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, test<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'building the distrubution'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:1 $ gradle dist -x test       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compile                                       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling source                                //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:dist                                          //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">building the distrubution                      //</span>
<span style="color: #93a1a1;">//                                                </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">BUILD SUCCESSFUL                               //</span>
<span style="color: #93a1a1;">//                                                </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Total time: 3.202 secs                         //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2">Continuing the build when a failure occurs</h3>
<div class="outline-text-3" id="text-11-2">
<ul class="org-ul">
<li>一般来说, 如果有task失败的话, gradle会自动abort, 这会让build更快complete,
但是会掩盖很多后面的错误, 如果我们不想被打断,想一直运行下去,把所有的错误都
显示出来.那么就使用参数&#x2013;continue
</li>
<li>一旦使用了&#x2013;continue,一个task失败了的话,所有依赖它的task都会失败,但是后面的
和它没关系的task都会继续运行.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-3" class="outline-3">
<h3 id="sec-11-3">Task name abbreviation</h3>
<div class="outline-text-3" id="text-11-3">
<ul class="org-ul">
<li>task的名字可以使用缩写,只需要能区分其他task,能减少到几个字母就减少到几个字母
如果是camel case命名法还可以把camel case的前几个字母写出来即可
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">compile</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling source'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compileTest</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'compling unit test'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">test</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, compileTest<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'running unit tests'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">dist</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #b58900;">[</span>compile, test<span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">'building the distrubution'</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">/////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;      //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">c:\code\gradle-in-action\user-manual\11\3&gt;gradle di //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">gradle di                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compile                                            //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling source                                     //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compileTest                                        //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling unit test                                  //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:test                                               //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">running unit tests                                  //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:dist                                               //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">building the distrubution                           //</span>
<span style="color: #93a1a1;">//                                                     </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">BUILD SUCCESSFUL                                    //</span>
<span style="color: #93a1a1;">//                                                     </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Total time: 4.513 secs                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">c:\code\gradle-in-action\user-manual\11\3&gt;gradle cT //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">gradle cT                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:compileTest                                        //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">compling unit test                                  //</span>
<span style="color: #93a1a1;">//                                                     </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">BUILD SUCCESSFUL                                    //</span>
<span style="color: #93a1a1;">//                                                     </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Total time: 1.819 secs                              //</span>
<span style="color: #93a1a1;">/////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-4" class="outline-3">
<h3 id="sec-11-4">Selecting which build to execute</h3>
<div class="outline-text-3" id="text-11-4">
<ul class="org-ul">
<li>gradle默认会使用当前文件夹下的gradle文件,当然你也可以使用,比如可以选择使用
subdir文件夹下面的myproject.gradle, 参数-b
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"using build file '$buildFile.name' in '$buildFile.parentFile.name'."</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">//////////////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                                       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">c:\code\gradle-in-action\user-manual\11\4&gt;gradle -q -b subdir/myproject.gradle hello //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">gradle -q -b subdir/myproject.gradle hello                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">using build file 'myproject.gradle' in 'subdir'.                                     //</span>
<span style="color: #93a1a1;">//////////////////////////////////////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>也可以使用参数-q制定文件夹, 当然,默认就必须是build.gradle文件
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">hello</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println <span style="color: #2aa198;">"using build file '$buildFile.name' in '$buildFile.parentFile.name'."</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;                      //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">c:\code\gradle-in-action\user-manual\11\4&gt;gradle -q -p subdir hello //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">gradle -q -p subdir hello                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">using build file 'build.gradle' in 'subdir'.                        //</span>
<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-11-5" class="outline-3">
<h3 id="sec-11-5">Obtaining information about your build</h3>
<div class="outline-text-3" id="text-11-5">
<ul class="org-ul">
<li>Gradle也提供了一些built-in的task来展现build的详细信息, 这对理解task相互依赖
关系和debug问题很有帮助:
<ul class="org-ul">
<li>运行gradle projects会给你展现当前project的subproject信息
</li>
<li>运行gradle task会给你展现当前project的task的信息(&#x2013;all参数会展示更多)
</li>
<li>运行gradle help &#x2013;task someTask 会给你展现某个task的具体信息
</li>
<li>运行gradle dependencies 会展现某个project的相互依赖关系
</li>
<li>运行gradle task:dependencyInsight 会展现某个dependency的信息
</li>
<li>运行gradle task:properties会列出某个project的一系列的properties
</li>
<li>运行gradle的时候加上参数&#x2013;profile,会"记录"每个task的运行时间
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">Chapter 12 Using the Gradle Graphical User Interface</h2>
<div class="outline-text-2" id="text-12">
<ul class="org-ul">
<li>可以使用如下命令,在gradle working directory里面打开一个gui窗口
<pre class="example">
&gt; gradle --gui
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">Chapter 13 Writing Build Scripts</h2>
<div class="outline-text-2" id="text-13">
</div><div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1">The Gradle build language</h3>
<div class="outline-text-3" id="text-13-1">
<ul class="org-ul">
<li>Gradle提供了DSL(domain specific language), 来描述build, 这个DSL是建立在groovy基础上的
</li>
<li>Gradle默认build script是使用UTF-8编码的
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-2" class="outline-3">
<h3 id="sec-13-2">The Project API</h3>
<div class="outline-text-3" id="text-13-2">
<ul class="org-ul">
<li>我们前面看到过如下的命令
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">'java'</span>
</pre>
</div>
</li>
<li>其实这个命令就是函数apply(String plugin),有函数就想到这个函数可能是Class或
者object来调用的, 在gradle里面,其实是后者:
<ul class="org-ul">
<li>在build script里面调用的method,其实都是Project object的method
</li>
<li>在build script里面定义的property,其实都是Project object的property
</li>
</ul>
</li>
<li>那什么是Project object呢?每个Gradle的project在运行的时候, Gradle都在内部实
现的时候,给它定义了一个Project object
</li>
<li>我们来看一个例子, project object一般常用的properties就这些
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">check</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println project.name
    println project.path
    println project.description
    println project.projectDir
    println project.group
    println project.version
    println project.ant
    <span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">They are the same, if no local variables called buildDir</span>
    println buildDir
    <span style="color: #b58900;">println</span> project.<span style="color: #268bd2;">buildDir</span>

<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:1 $ gradle -q check                        //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">1                                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">:                                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">null                                                        //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/1       //</span>
<span style="color: #93a1a1;">//                                                             </span><span style="color: #93a1a1;">//</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">unspecified                                                 //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">org.gradle.api.internal.project.DefaultAntBuilder@43999ca0  //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/1/build //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/1/build //</span>
<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-3" class="outline-3">
<h3 id="sec-13-3">The Script API</h3>
<div class="outline-text-3" id="text-13-3">
<ul class="org-ul">
<li>当gradle执行一个script的时候,他会把script编译成一个class, 也就是说所有在script
内部定义的变量, 函数都会存在最后的class里面
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-4" class="outline-3">
<h3 id="sec-13-4">Declaring variables</h3>
<div class="outline-text-3" id="text-13-4">
</div><div id="outline-container-sec-13-4-1" class="outline-4">
<h4 id="sec-13-4-1">Local Variables</h4>
<div class="outline-text-4" id="text-13-4-1">
<ul class="org-ul">
<li>定义一个local的变量,只在当前的script内部有效. 会覆盖本来可以直接显示的project
object变量
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">buildDir</span> = <span style="color: #2aa198;">"localDir"</span>

task show &lt;&lt; <span style="color: #2aa198;">{</span>
    println buildDir
    <span style="color: #b58900;">println</span> project.<span style="color: #268bd2;">buildDir</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:2 $ gradle -q show                         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">localDir                                                    //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/2/build //</span>
<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-4-2" class="outline-4">
<h4 id="sec-13-4-2">Extra properties</h4>
<div class="outline-text-4" id="text-13-4-2">
<ul class="org-ul">
<li>大家的第一反应肯定是global variable, 不过gradle摒弃了这种设计,而是通过每个
object都有的ext property来设置"其他project"的变量
</li>
<li>比如下面的例子, 我们引入了java plugin, 我们如果还def var='xxx'的话,是没有
办法把这个变量放入到 java plugin里面去的.我们可以通过每个object的ext变量
来设置property A,然后这个property A就可以通过object.propertyA来访问
<div class="org-src-container">

<pre class="src src-groovy">apply <span style="color: #b58900;">plugin</span>: <span style="color: #2aa198;">"java"</span>

ext <span style="color: #2aa198;">{</span>
    springVersion = <span style="color: #2aa198;">"3.1.0.RELEASE"</span>
    emailNotification = <span style="color: #2aa198;">"build@master.org"</span>
<span style="color: #2aa198;">}</span>

sourceSets.all <span style="color: #2aa198;">{</span> ext.purpose = <span style="color: #268bd2; font-weight: bold;">null</span> <span style="color: #2aa198;">}</span>

sourceSets <span style="color: #2aa198;">{</span>
    main <span style="color: #b58900;">{</span>
        purpose = <span style="color: #2aa198;">"production"</span>
    <span style="color: #b58900;">}</span>
    test <span style="color: #b58900;">{</span>
        purpose = <span style="color: #2aa198;">"test"</span>
    <span style="color: #b58900;">}</span>
    plugin <span style="color: #b58900;">{</span>
        purpose = <span style="color: #2aa198;">"production"</span>
    <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">printProperties</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    println springVersion
    println <span style="color: #b58900;">emailNotification</span>
    sourceSets.<span style="color: #268bd2;">matching</span> <span style="color: #b58900;">{</span> it.purpose == <span style="color: #2aa198;">"production"</span> <span style="color: #b58900;">}</span>.each <span style="color: #b58900;">{</span> <span style="color: #b58900;">println</span> it.<span style="color: #268bd2;">name</span><span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:3 $ gradle -q printProperties //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">3.1.0.RELEASE                                  //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">build@master.org                               //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">main                                           //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">plugin                                         //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>上面的sourceSets是java plugin引入的一个类型为SourceSetContainer的容器.所以
能够调用all函数变量, matching函数计算
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-13-5" class="outline-3">
<h3 id="sec-13-5">Some Groovy basics</h3>
<div class="outline-text-3" id="text-13-5">
<ul class="org-ul">
<li>我们能够提供DSL这种类型的功能,还是得益于groovy提供了很多(类似ruby)的feature
</li>
</ul>
</div>
<div id="outline-container-sec-13-5-1" class="outline-4">
<h4 id="sec-13-5-1">Groovy JDK</h4>
<div class="outline-text-4" id="text-13-5-1">
<ul class="org-ul">
<li>groovy添加了很多有用的method到standard Java class,比如Iterable得到了each函
数,可以遍历并在block里面使用,比如给Iterable对象增加了each函数
<div class="org-src-container">

<pre class="src src-groovy">configurations.ext.runtime = <span style="color: #2aa198;">[</span>1, 2<span style="color: #2aa198;">]</span>
task test &lt;&lt; <span style="color: #2aa198;">{</span>
    configurations.runtime.each <span style="color: #b58900;">{</span> <span style="color: #b58900;">Integer</span> <span style="color: #268bd2;">i</span> -&gt; println i <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:4 $ gradle -q test            //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">1                                              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">2                                              //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-5-2" class="outline-4">
<h4 id="sec-13-5-2">Property accessors</h4>
<div class="outline-text-4" id="text-13-5-2">
<ul class="org-ul">
<li>groovy还自动添加了getter和setter
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">task</span> <span style="color: #268bd2;">test</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    <span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Using a getter method</span>
    println project.buildDir
    <span style="color: #b58900;">println</span> <span style="color: #268bd2;">getProject</span><span style="color: #b58900;">()</span>.getBuildDir<span style="color: #b58900;">()</span>

    <span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">Using a setter method</span>
    project.buildDir = <span style="color: #2aa198;">'target'</span>
    getProject<span style="color: #b58900;">()</span>.setBuildDir<span style="color: #b58900;">(</span><span style="color: #2aa198;">'target'</span><span style="color: #b58900;">)</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt;              //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:5 $ gradle -q test                         //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/5/build //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">/Users/i309511/Code/gradle-in-action/user-manual/13/5/build //</span>
<span style="color: #93a1a1;">/////////////////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-5-3" class="outline-4">
<h4 id="sec-13-5-3">Optional parentheses on method calls</h4>
<div class="outline-text-4" id="text-13-5-3">
<ul class="org-ul">
<li>只有去掉括号的舒服, DSL才像那么回事
<div class="org-src-container">

<pre class="src src-groovy">test.systemProperty<span style="color: #2aa198;">(</span> <span style="color: #2aa198;">'some.prop'</span>, <span style="color: #2aa198;">'value'</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">is equal to</span>
test.systemProperty <span style="color: #2aa198;">'some.prop'</span>, <span style="color: #2aa198;">'value'</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-5-4" class="outline-4">
<h4 id="sec-13-5-4">List and map literals</h4>
<div class="outline-text-4" id="text-13-5-4">
<ul class="org-ul">
<li>Groovy提供了快速定义List和Map的方法(还是全部来自于ruby):
<ul class="org-ul">
<li>list定义的方法
<div class="org-src-container">

<pre class="src src-groovy">test.includes = <span style="color: #2aa198;">[</span><span style="color: #2aa198;">'org/gradle/api/**'</span>, <span style="color: #2aa198;">'org/gradle/internal/**'</span><span style="color: #2aa198;">]</span>

<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">is equal to</span>
<span style="color: #b58900;">List</span><span style="color: #2aa198;">&lt;</span>String<span style="color: #2aa198;">&gt;</span> list = <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">ArrayList</span><span style="color: #2aa198;">&lt;</span>String<span style="color: #2aa198;">&gt;()</span>
list.add<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'org/gradle/api/**'</span><span style="color: #2aa198;">)</span>
list.add<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'org/gradle/internal/**'</span><span style="color: #2aa198;">)</span>
test.include = list
</pre>
</div>
</li>
<li>map定义的方法
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #b58900;">Map</span><span style="color: #2aa198;">&lt;</span>String, String<span style="color: #2aa198;">&gt;</span> <span style="color: #268bd2;">map</span> = <span style="color: #2aa198;">[</span>key1:<span style="color: #2aa198;">'valu1'</span>, key2:<span style="color: #2aa198;">'value2'</span><span style="color: #2aa198;">]</span>

apply plugin: <span style="color: #2aa198;">'java'</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">is actually</span>
apply<span style="color: #2aa198;">(</span><span style="color: #b58900;">[</span>plugin:<span style="color: #2aa198;">'java'</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-5-5" class="outline-4">
<h4 id="sec-13-5-5">Closures as the last parameter in a method</h4>
<div class="outline-text-4" id="text-13-5-5">
<ul class="org-ul">
<li>Gradle DSL里面用到了很多的closure, 而closure是非常特别的"成员": 可以理解其
为"函数参数": 你把一个函数传入到当前的函数定义,其实现方式和ruby中的code block
还是有所不同的:
<ul class="org-ul">
<li>在ruby中,这个code block是在函数实现的时候才传入的, code block有'匿名'函数
指针的感觉
<div class="org-src-container">

<pre class="src src-ruby"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">printNum</span>
  <span style="color: #859900; font-weight: bold;">yield</span> 5
  <span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">"world"</span>
<span style="color: #859900; font-weight: bold;">end</span>

printNum <span style="color: #2aa198;">{</span>|n| <span style="color: #657b83; font-weight: bold;">p</span> <span style="color: #2aa198;">"No. </span><span style="color: #268bd2;">#{n}</span><span style="color: #2aa198;"> hello"</span> <span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">##################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">(master) i309511:13 $ ruby test.rb             #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"No. 5 hello"                                  #</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">"world"                                        #</span>
<span style="color: #93a1a1;">##################################################</span>
</pre>
</div>
</li>
<li>在groovy里面是这个样子
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">method</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">Closure</span> <span style="color: #268bd2;">c</span><span style="color: #2aa198;">){</span>
    <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">firstValue</span> = <span style="color: #2aa198;">'a'</span>
    <span style="color: #859900; font-weight: bold;">def</span> secondValue = <span style="color: #2aa198;">'b'</span>
    <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900;">(</span>c.maximumNumberOfParameters == 1<span style="color: #b58900;">)</span>
        c<span style="color: #b58900;">(</span>firstValue<span style="color: #b58900;">)</span>
    <span style="color: #859900; font-weight: bold;">else</span>
        c<span style="color: #b58900;">(</span>firstValue, secondValue<span style="color: #b58900;">)</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">//</span><span style="color: #93a1a1;">execute</span>
method <span style="color: #2aa198;">{</span> a -&gt;
    println <span style="color: #2aa198;">"I just need $a"</span>
<span style="color: #2aa198;">}</span>
method <span style="color: #2aa198;">{</span> a, b -&gt;
    println <span style="color: #2aa198;">"I need both $a and $b"</span>
<span style="color: #2aa198;">}</span>

method<span style="color: #2aa198;">()</span> <span style="color: #2aa198;">{</span> a -&gt; println <span style="color: #2aa198;">"I just need $a, version 2 "</span><span style="color: #2aa198;">}</span>
method<span style="color: #2aa198;">(</span><span style="color: #b58900;">{</span> a -&gt; println <span style="color: #2aa198;">"I just need $a, version 3 "</span><span style="color: #b58900;">}</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I just need a                                  //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I need both a and b                            //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I just need a, version 2                       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">I just need a, version 3                       //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-13-5-6" class="outline-4">
<h4 id="sec-13-5-6">Closure delegate</h4>
<div class="outline-text-4" id="text-13-5-6">
<ul class="org-ul">
<li>每一个closure都有一个delegate object, 用来查找closure里面没定义,而在"使用
的时候定义的"variable和method reference:
<ul class="org-ul">
<li>下面这个例子, 会打印hello, closure里面已经定义了,肯定是不会再用外面的了:
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say</span> = <span style="color: #2aa198;">{</span>
    <span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">m</span> = <span style="color: #2aa198;">'hello'</span>
    println m
<span style="color: #2aa198;">}</span>
say.delegate = <span style="color: #2aa198;">[</span>m:2<span style="color: #2aa198;">]</span>
say<span style="color: #2aa198;">()</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:7 $ groovy test1.groovy       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">hello                                          //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
<li>closure里面没定义,那就只能用delegate在外面进行定义了, 这里delegate是一个
map类型的数据
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">say</span> = <span style="color: #2aa198;">{</span>
    <span style="color: #b58900;">println</span> <span style="color: #268bd2;">m</span>
<span style="color: #2aa198;">}</span>
say.delegate = <span style="color: #2aa198;">[</span>m:2<span style="color: #2aa198;">]</span>
say<span style="color: #2aa198;">()</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">(master) i309511:7 $ groovy test2.groovy       //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">2                                              //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">Chapter 14 Tutorial - 'This and That'</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1">Directory creation</h3>
<div class="outline-text-3" id="text-14-1">
<ul class="org-ul">
<li>很多时候,某些task都要依赖于某些文件夹,所以要求这些文件夹需要一开始就存在.当
然你可以选择在这个task开始的地方加上mkdir,但这不是最好的方法,最好的方法是创
建一个"mkdir task",然后需要用的时候DependsOn它, 以后再用到还可以重用
<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #859900; font-weight: bold;">def</span> <span style="color: #268bd2;">classesDir</span> = <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">File</span><span style="color: #2aa198;">(</span><span style="color: #2aa198;">'build/classes'</span><span style="color: #2aa198;">)</span>

task resources &lt;&lt; <span style="color: #2aa198;">{</span>
    classesDir.mkdirs<span style="color: #b58900;">()</span>
    <span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">do nothing</span>
<span style="color: #2aa198;">}</span>

<span style="color: #b58900;">task</span> <span style="color: #268bd2;">compile</span><span style="color: #2aa198;">(</span>dependsOn: <span style="color: #2aa198;">'resources'</span><span style="color: #2aa198;">)</span> &lt;&lt; <span style="color: #2aa198;">{</span>
    <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900;">(</span>classesDir.isDirectory<span style="color: #268bd2;">()</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
        println <span style="color: #2aa198;">'The class directory exists. I can operate'</span>
    <span style="color: #b58900;">}</span>
    <span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">do something</span>
<span style="color: #2aa198;">}</span>

<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">&lt;===================OUTPUT===================&gt; //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">$ gradle -q compile                            //</span>
<span style="color: #93a1a1;">// </span><span style="color: #93a1a1;">The class directory exists. I can operate      //</span>
<span style="color: #93a1a1;">////////////////////////////////////////////////////</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-14-2" class="outline-3">
<h3 id="sec-14-2">Gradle properties and system properties</h3>
<div class="outline-text-3" id="text-14-2">
<ul class="org-ul">
<li></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

         <!-- Disqus Comment BEGIN -->
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'harrifeng';

              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

         <!-- Disqus Comment END -->
</div>
</body>
</html>
