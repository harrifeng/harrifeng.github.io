<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>mysql-explained</title>
<!-- 2017-08-09 Wed 13:27 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="your name" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

         <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Galdeano|Open+Sans:600italic,400,600|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
         <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://harrifeng.github.io/sitemap.html"> UP </a>
 |
 <a accesskey="H" href="http://harrifeng.github.io/index.html"> HOME </a>
</div><div id="preamble" class="status">

         <div id="header">
            <div id="header-top">
                <div id="blog-title">Harrifeng's Path</div>
                <div id="blog-sub-title">纸上得来终觉浅,绝知此事要Coding</div>
            </div>
            <div id="nav">
                <ul>
                    <li><a href="/">首页</a></li>
                    <li><a href="/about.html">About Me</a></li>
                    <li>
                    </li>
                </ul>
            </div>
         </div>
</div>
<div id="content">
<h1 class="title">mysql-explained</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Chapter 1: Databases - In Theory and Everyday Life</a>
<ul>
<li><a href="#sec-1-1">What is a Database?</a></li>
<li><a href="#sec-1-2">Everyday Database Examples</a></li>
<li><a href="#sec-1-3">Types of Databases</a>
<ul>
<li><a href="#sec-1-3-1">Text files - Data Exchange and Basic Storage</a></li>
<li><a href="#sec-1-3-2">Mobile Databases - Smartphones, Tablets and the Web</a></li>
<li><a href="#sec-1-3-3">Desktop Database Software - Local Analysis</a></li>
<li><a href="#sec-1-3-4">Server Databases - Organizational Data and Enterprise Applications</a></li>
<li><a href="#sec-1-3-5">Cloud Databases - Outsourced Data Storage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">Chapter 2: Choosing and Installing MySQL</a>
<ul>
<li><a href="#sec-2-1">Why Choose MySQL?</a>
<ul>
<li><a href="#sec-2-1-1">Notable Feature of MySQL</a></li>
<li><a href="#sec-2-1-2">GNU General Public License and Open Source Software</a></li>
</ul>
</li>
<li><a href="#sec-2-2">Installing MySQL and Creating an AMP Environment</a></li>
</ul>
</li>
<li><a href="#sec-3">Chapter 3: Database Design - The First Steps</a>
<ul>
<li><a href="#sec-3-1">Creating a Model</a></li>
<li><a href="#sec-3-2">Formal vs. Informal Data Modeling</a></li>
<li><a href="#sec-3-3">Example Database - Job Search Plus</a>
<ul>
<li><a href="#sec-3-3-1">Data Concepts and Relationships</a></li>
<li><a href="#sec-3-3-2">Filling in the Details</a></li>
<li><a href="#sec-3-3-3">Defining the Tables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">Chapter 4: Database Normalization</a>
<ul>
<li><a href="#sec-4-1">From Design to Reality</a></li>
<li><a href="#sec-4-2">Looking Back</a></li>
<li><a href="#sec-4-3">The Normalization Process</a>
<ul>
<li><a href="#sec-4-3-1">First Normal Form(1NF)</a></li>
<li><a href="#sec-4-3-2">Second Normal Form(2NF)</a></li>
<li><a href="#sec-4-3-3">Third Normal Form (3NF)</a></li>
<li><a href="#sec-4-3-4">Boyce-Codd Normal Form (BCNF or 3.5NF)</a></li>
</ul>
</li>
<li><a href="#sec-4-4">Data or Database?</a></li>
</ul>
</li>
<li><a href="#sec-5">Chapter 5: Servers and Databases</a>
<ul>
<li><a href="#sec-5-1">Building the Database</a>
<ul>
<li><a href="#sec-5-1-1">Accessing the Server</a></li>
<li><a href="#sec-5-1-2">The MySQL Command Prompt</a></li>
<li><a href="#sec-5-1-3">Creating Databases</a></li>
<li><a href="#sec-5-1-4">Creating the Database</a></li>
<li><a href="#sec-5-1-5">Database Users and Security</a></li>
<li><a href="#sec-5-1-6">Changing the Root Password</a></li>
<li><a href="#sec-5-1-7">Adding New Accounts and Assigning Privileges</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">Chapter 6: Tables and Indexes</a>
<ul>
<li><a href="#sec-6-1">Introduction</a></li>
<li><a href="#sec-6-2">Storage Engines</a></li>
<li><a href="#sec-6-3">Models and Schemas</a></li>
<li><a href="#sec-6-4">MySQL Workbench</a>
<ul>
<li><a href="#sec-6-4-1">Getting Started</a></li>
<li><a href="#sec-6-4-2">Creating the Tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Chapter 1: Databases - In Theory and Everyday Life</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">What is a Database?</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>database这个名字的意义其实是一系列data的良好组合,以便于需要的时候取用
<pre class="example">
A database is simply any collection of data that's organized
so that it can be retrieved and used as needed.
</pre>
</li>
<li>每当computer需要以各种形式(比如商店的客户信息,医生的病人信息)展现数据的时候,
总是需要database的参与
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Everyday Database Examples</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>现代人的生活被web page, email等占据,根据EMC的估计,截止到2011年,世界上的数据
高达1.8 zettabyte,而且还以翻倍的速度每年增长
</li>
<li>这些数据很大一部分都存储在单独的文件里面,比如微软的word文档,或者是image 文件.
但是这种老旧的存储方式不利于你取用
</li>
<li>除此以外,所有的数据都是存储在数据库里面的,比如:
<ul class="org-ul">
<li>电子邮件存储在数据库里
</li>
<li>你经常收到垃圾邮件,说明你的电子邮件也在某些广告商那里
</li>
<li>发邮件的时候,你打入首字母,就会弹出你所有以此字母开头的好友的名字,所以好友
们的名字也是存储在数据库里面的
</li>
<li>你信用卡的信息存储在银行的数据库里面
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Types of Databases</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>前面说了,你的address book虽然也算是一种database,但是显然不是一种"精密"的数
据库
</li>
<li>数据库可以像address book那样在本地计算机以文本的形式简单的存储.也可以像银行
数据库一样,运行在高端的server里面,等待着来自世界各地的访问
</li>
</ul>
</div>
<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1">Text files - Data Exchange and Basic Storage</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li>最简单的数据库就是以txt形式存储的啦,虽然功能有限(比如存储和索引功能没有),但
是文本确可以在不同操作系统间兼容,并且很容易被人读取.常见的文件数据库有:
<ul class="org-ul">
<li>CSV
</li>
<li>XML
</li>
<li>JSON
</li>
</ul>
</li>
<li>CSV代表Comma Sepearated Values.这是最简单的database foramt,所有的数据使用
逗号进行分割(space或者tab其实也可以),一个CSV的例子如下
<pre class="example">
"Stormy Weather", "Carl Hiassen",1995,335
"Dune","Frank Herbert",1965,528
"The Stand","Stephen King",1978,1200
</pre>
</li>
<li>CSV诞生于个人电脑普及之前,虽然非常的简单,但是现在还是有其存在的价值:它可以
用来在相互不兼容的程序直接传递数据:程序A的格式和程序B不兼容,但是程序A可以把
自己的数据导出成CSV格式,让程序B进行读取
</li>
<li>XML代表Extensible Markup Language,发明于1990年代.而且是早期互联网上数据传输
的主要格式
</li>
<li>XML会比CSV有进步,因为它的field都会有名字了,例子如下
<div class="org-src-container">

<pre class="src src-xml">&lt;?<span style="color: #859900; font-weight: bold;">xml</span> <span style="color: #268bd2;">version</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">1.0</span><span style="color: #2aa198;">"</span> <span style="color: #268bd2;">encoding</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">UTF-8</span><span style="color: #2aa198;">"</span>?&gt;

&lt;<span style="color: #268bd2;">Books</span>&gt;
    &lt;<span style="color: #268bd2;">ID</span>&gt;1&lt;/<span style="color: #268bd2;">ID</span>&gt;
    &lt;<span style="color: #268bd2;">Title</span>&gt;Stormy Weather&lt;/<span style="color: #268bd2;">Title</span>&gt;
    &lt;<span style="color: #268bd2;">Author</span>&gt;Carl Hiassen&lt;/<span style="color: #268bd2;">Author</span>&gt;
    &lt;<span style="color: #268bd2;">Year</span>&gt;1995&lt;/<span style="color: #268bd2;">Year</span>&gt;
    &lt;<span style="color: #268bd2;">Pages</span>&gt;335&lt;/<span style="color: #268bd2;">Pages</span>&gt;
&lt;/<span style="color: #268bd2;">Books</span>&gt;
</pre>
</div>
</li>
<li>和html不同的是,XML里面所使用的tag是没有关键字的,用户想写什么,就写什么.而不
是只有固定的&lt;HTML&gt;,&lt;Body&gt;等
</li>
<li>相比于CSV,XML有了巨大的进步,XML可以有category和sub-category的概念了
</li>
<li>同时又没有丢失CSV简单易读,而且明文(非binary)的优点.可以让XML在互联网时代大
显身手
</li>
<li>JSON是最新一代的txt format,它是JavaScript Object Notation的简称,发明于
2001年
</li>
<li>和XML不同的是,JSON能够区别出简单的数据类型(而不总是string类型),比如:
<ul class="org-ul">
<li>number
</li>
<li>string
</li>
<li>true/false
</li>
</ul>
</li>
<li>JSON还能够区分单独的value和array of value.同时能够保证让复杂结构的数据能以
人类易读的方式写出来.例子如下
<div class="org-src-container">

<pre class="src src-js"><span style="color: #2aa198;">{</span>
  <span style="color: #b58900;">{</span> <span style="color: #2aa198;">"Title"</span>: <span style="color: #2aa198;">"Stormy Weather"</span>,
    <span style="color: #2aa198;">"Author"</span>: <span style="color: #2aa198;">"Carl Hiassen"</span>,
    <span style="color: #2aa198;">"Year"</span>: <span style="color: #2aa198;">"1995"</span>,
    <span style="color: #2aa198;">"Pages"</span>: <span style="color: #2aa198;">"335"</span>
  <span style="color: #b58900;">}</span>,
  <span style="color: #b58900;">{</span> <span style="color: #2aa198;">"Title"</span>: <span style="color: #2aa198;">"Dune"</span>,
    <span style="color: #2aa198;">"Author"</span>: <span style="color: #2aa198;">"Frank Herbert"</span>,
    <span style="color: #2aa198;">"Year"</span>: <span style="color: #2aa198;">"1965"</span>,
    <span style="color: #2aa198;">"Pages"</span>: <span style="color: #2aa198;">"528"</span>
  <span style="color: #b58900;">}</span>
<span style="color: #2aa198;">}</span>
</pre>
</div>
</li>
<li>三种text format的格式都只适合于小规模数据的存储,因为程序想做什么事情,比如把
它们全部都读入内存,数据太大就不合适使用tex format的数据库啦
</li>
<li>而且由于每个人都可以读取,安全性不太好.如果被误删除,也是没有办法恢复.所以数
据量稍微大一些的话,我们就会推荐大家使用其他类型的数据库
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2">Mobile Databases - Smartphones, Tablets and the Web</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>大部分稍微精密一点的计算机程序(包括你的只能手机和平板)都需要比text file更
加精密的方法来存储数据.
</li>
<li>因为在一个特定的时间:
<ul class="org-ul">
<li>data需要满足某些'约束',拥有某些'结构'
</li>
<li>不同类型数据之间的关系要'确定'
</li>
<li>查找某些数据的方法应该便捷
</li>
<li>应该支持random访问某一项数据,而不是把所有的数据都导入到内存
</li>
</ul>
</li>
<li>上面的这些要求,就足可以做成一个单独的提供数据的软件:数据库管理系统.常见的
数据库管理系统(数据库软件)有:
<ul class="org-ul">
<li>SQLite: 特点是体积小,速度快.但是不支持某些高端特性,比如索引
</li>
<li>Microsoft SQL Server Compact and Express Edition: 微软出品,有两个版本:
Compact版本主打mobile app,而Express版本为桌面和website准备
</li>
<li>Oracle Express Edition: 一种受限制的Oracle版本(限制存储的内容多少和内存
使用大小),但是在单机上面性能足够了
</li>
<li>MySQL:最著名的开源数据库软件,功能强大,代码开源,而且没有Microsoft和Oracle
等产品对于数据存储大小的限制.是最广泛引用的数据库软件
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3">Desktop Database Software - Local Analysis</h4>
<div class="outline-text-4" id="text-1-3-3">
<ul class="org-ul">
<li>单机上使用的,非text file的数据库还有一种.它和Mysql, Oracle Express版本不同
的地方在于:它是为非计算机专业人士准备的!代表是微软的Access
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-4" class="outline-4">
<h4 id="sec-1-3-4">Server Databases - Organizational Data and Enterprise Applications</h4>
<div class="outline-text-4" id="text-1-3-4">
<ul class="org-ul">
<li>运行在server端的数据库,才是当今数据库的主流,它们能处理最多1百万GB的数据
</li>
<li>在server层面,database software就不简单的是一个program或者在一个文件了,而很
可能变成一系列的service
</li>
<li>在这个领域最著名的就是Oracle, IBM和微软
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3-5" class="outline-4">
<h4 id="sec-1-3-5">Cloud Databases - Outsourced Data Storage</h4>
<div class="outline-text-4" id="text-1-3-5">
<ul class="org-ul">
<li>最近有爆发趋势的数据库就是Cloud Database啦
</li>
<li>cloud database是云计算提供商提供的多种服务的其中一种.
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Chapter 2: Choosing and Installing MySQL</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Why Choose MySQL?</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>MySQL有全平台支持
</li>
<li>MySQL是开源软件
</li>
<li>MySQL提供了多个storage engine
</li>
</ul>
</div>
<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Notable Feature of MySQL</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>作为一个RDBMS(relational database management system). MySQL拥有RDBMS常见的
所有特性:
<ul class="org-ul">
<li>Stored Procedures: MySQL可以来存储和运行一种叫做"存储过程"的东西(存储过
程可以非常精细的处理数据),这些存储过程直接存储在server端,运行的时候就会很
有优势(不需要和remote client进行过多通信)
</li>
<li>Views: 视图其实就是"虚拟表",和真实的表一样,拥有一系列带有名称的列和行数
据,但是视图并不在数据库中以存储数据值集形式存在,视图可以看做是"存储在server
端的搜索定义",它们可以有效减少table的column数目.
</li>
<li>User Authentication and Privileges: 用户需要提供用户名,密码等信息才能连接
数据库成功.不同用户在数据库中,拥有不同的权利
</li>
<li>ACID-compiance: MySQL满足ACID规范:
<ol class="org-ol">
<li>Atomicity: 数据要么完全成功,要么完全失败. Atomicity的存在让事务(transaction)
要么完成,要么回滚
</li>
<li>Consistency: 事务必须始终报纸系统处于一致的状态,不管在任何的给定时间内
的并发事务有多少
</li>
<li>Isolation: 隔离性的高低,决定了'事务做出的改动'在'事务完成之前'是否能被
其他用看到
</li>
<li>Durability: 持久性意味着一旦事务被成功执行,那么这个改动是permanent的即
便server断电
</li>
</ol>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">GNU General Public License and Open Source Software</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>Mysql是一个遵守GNU General Public License(version 2)的软件
</li>
<li>GNU GPL是一个free softwar license,它允许使用者使用,分享,更改开源代码,只是
使用者所有的更改都要继续遵守GNU GPL
</li>
<li>GPL并没有要求软件一定"免费分发",但是实际上大部分遵守GPL的软件都是免费的
</li>
<li>MySQL是双licence 软件,你一来可以使用GPL,如果想付费也可以找Oracle买license
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Installing MySQL and Creating an AMP Environment</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>如果你对命令行非常熟悉的话,MySQL本身并不需要多少安装的过程.如果你需要图形化
的帮助的话,你就需要AMP了.所谓AMP是一个sotware stack的总称,包括:
<ul class="org-ul">
<li>Apache
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install apache2
</pre>
</div>
</li>
<li>MySQL
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install mysql-server
</pre>
</div>
</li>
<li>PHP(or Python)
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install php5 libapach2-mod-php5
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Chapter 3: Database Design - The First Steps</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Creating a Model</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>数据库设计阶段"独立于"任何software的介入
</li>
<li>数据库设计包含了很多的principle.理解这些principle对于学习任何数据库都至关重
要
</li>
<li>第一步是将数据组织(organize)到不同的subjects,并且创建存储在数据库里面的
structure.这个过程叫做data modeling,这个过程通常都是在纸上完成的,你需要决定:
<ul class="org-ul">
<li>哪些数据需要存储
</li>
<li>如何把数据分到不同的table里面
</li>
<li>table如何符合最终的database structure
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Formal vs. Informal Data Modeling</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>data modeling的formal practice通常比较繁琐包括使用语言和标记完成三个单独的步骤:
<ul class="org-ul">
<li>conceptual
</li>
<li>logical
</li>
<li>physical
</li>
</ul>
</li>
<li>在实际的工作当中,data modeling由于documentation并不受重视的原因,很少采用formal
的流程,而一般会选择informal的流程.设计者一般都是直接从第三个步骤,也就是 physical
desing直接开始的.
</li>
<li>无论是否使用正式的流程, data modeling都是一个重要的步骤,因为:
<ul class="org-ul">
<li>通常情况下,初学者在设计数据库的时候都很匆忙,而没有想明白需要的data type类
型.这就会导致遇到问题的时候,会回过头来重新设计
</li>
<li>业务逻辑是不断变化的,所以数据库也会不断变化.一个清晰的data model的过程会帮
助设计者为未来的改动预留好准备
</li>
<li>通常来说,数据库是为一类人来设计的,再设计阶段认真分析,最好再落实到文档上会
保证设计能够"囊括"了所有人的需求
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Example Database - Job Search Plus</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>Job Search Plus是一个程序,旨在帮助人们管理job search
</li>
<li>使用这个例子是因为它恰到好处的size,细节足够大家学习,又不至于过多而让人迷失
</li>
<li>在本章后面的内容里面,我们可以看到这个例子告诉我们:真实世界的需求变动是如何影
响数据库的结构以及application的设计的
</li>
<li>这些需求(requirements)在反应了业务本身的要求的情况下,会被叫做业务逻辑(business
rules).比如在我们的Job Search Plus里面下面的情景都是业务逻辑:
<ul class="org-ul">
<li>一个company里面可能有多个Job lead.注意job lead是一个新的英语词汇,你可以把
它理解为"工作机会"(lead的意思是你认为你最符合的工作)
</li>
<li>一个公司里面也可能有多个contact person,但是其中一个是默认的contact person
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1">Data Concepts and Relationships</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>创建data model的第一步是找出数据库中的concept,并且算出这些concept之间的
relation,这可以说是非常重要的一步,特别是是你对系统还不太熟悉的情况下
</li>
<li>首先定义数据库里面的"核心角色(central theme)"可以帮助你更快的了解系统清晰
的结构
</li>
<li>我们下面就来分析下谁能成为我们Job Search Plus的核心角色.我们的JSP的一个重要
步骤就是employment search:所以我们database的central concept就是job lead
所谓job lead,就是工作机会(这个工作机会里面会有"任职要求":一个用户需要达到怎
样的要求,雇主才会考虑他)
</li>
<li>好,确定了核心概念,我们可以开始围绕着这个概念继续数据库的设计了.
</li>
<li>job lead的存在,意味着要存在另外一个和job lead密切相关的概念,lead source:就
是说,某个job lead肯定是有其"消息来源"的.这个消息来源可能是:
<ul class="org-ul">
<li>在线工作发布平台,比如校园BBS
</li>
<li>工作中介机构
</li>
<li>其他能够首先通知job lead的消息来源
</li>
</ul>
</li>
<li>我们再来看看job lead本身,每个lead都会有一个相关的company,并且有一个contact
person(或者多个contact person),这里又会涉及到contact management
<pre class="example">
                                                  +-------------+    Multiple contacts in each company
                                  +--------------1|   Contact   |8----------------------+
                                  |               +-------------+                       |
                                  8                                                     1
+-------------+           +-------------+                                          +-------------+
|  Resource   |1---------8| Job Lead    | 8--------------------------------------8 |  Company    |
+-------------+           +-------------+  Multiple lead sper company              +-------------+
 Each resource might supply many leads
</pre>
</li>
<li>我们打印不出"无穷大",所以使用8来代替(无穷大就是平躺的8):
<ul class="org-ul">
<li>job lead和resource保持着"一对多"的关系:一个消息来源可能提供多个job lead
</li>
<li>job lead和contact也保持着"一对多"的关系:一个contact person肯定要维护不止一个job lead
</li>
<li>job lead和company的关系是"多对多", 公司发布多个工作机会这个很容易理解,稍
微有点难以理解的是一个工作属于多个公司,其实就是一个工作可能直接受雇于某个
公司,或者使用了外包公司
</li>
<li>从contact object 角度理解,一个contact object肯定是要负责多个job lead,而
一个company肯定也会雇佣多个contact people的
</li>
<li>再往前走一步,每个job lead一旦发布,就存在着被job seeker关注的可能.一旦一个
job seeker决定关注这个job lead,那他就不可避免的需要记录关于这个job lead的
很多activity,比如申请时间,面试时间等等.我希望用户可以为这些activity增加
reminder,所以我又增加了一个新的concept: Activities
<pre class="example">
                                                  +-------------+    Multiple contacts in each company
                                  +--------------1|   Contact   |8----------------------+
                                  |               +-------------+                       |
                                  8                                                     1
+-------------+           +-------------+                                          +-------------+
|  Resource   |1---------8| Job Lead    | 8--------------------------------------8 |  Company    |
+-------------+           +-------------+  Multiple lead sper company              +-------------+
                                  1
                                  |
                                  |
                                  |               +-------------+
                                  +--------------8|  Activities |
                                                  +-------------+
</pre>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2">Filling in the Details</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>data modeling的下一个步骤,是增加一些细节来描述哪些数据需要存储
</li>
<li>我们还是以Job Search Plus为例,如果你要记录一个job lead,那么你很大可能希望
了解job lead如下的信息:
<ul class="org-ul">
<li>Date Received/Recorded
</li>
<li>Job Title
</li>
<li>Description
</li>
<li>Full or Part Time
</li>
<li>Job Location
</li>
<li>Company Name
</li>
<li>Contact Name
</li>
<li>Phone Number
</li>
</ul>
</li>
<li>每一个这样的信息都是job lead这个entity的attribute
</li>
<li>然后我们再来看看Activity entity的attribute:
<ul class="org-ul">
<li>Activity Date
</li>
<li>Activity Type(Sent Resume, Scheduled Interview, Follow-up call)
</li>
<li>Detail / Comments
</li>
<li>Complete (or Not)
</li>
</ul>
</li>
<li>加入这些attribute之后的图标如下
<pre class="example">
+-----------+                   +-------------+
|Job Lead   |                   |Activities   |
|---------- |                   |----------   |
|Date       |                   |Date         |
|Job Title  |                   |Job Lead ID  |
|Description|1-----------------8|Activity Type|
|FT/PT      |                   |Detail       |
|Location   |                   |Completed    |
|Company    |                   +-------------+
|Contact    |
|Phone      |
|Source     |
+-----------+
</pre>
</li>
<li>细心的人可能会发现,在Activities里面有一个attribute叫做Job Lead ID, 用来refer
back到activity相关的Job Lead entity!这是relation database特有的"相互联系"
的方式!
</li>
<li>为了data model的完整,我们还需要加入company, contact, resource entities.
<pre class="example">
                                              +----------+
                                              |Contact   |
                                              +----------+
                             +---------------1|Name      |
                             |                |Company ID|
                             8                |Title     |
                       +-----------+          |Address   |
                       |Job Lead   |          |City State|
                       +-----------+          |Postal Cod|
+-----------+          |Date       |          |Phone/Fax |
|Resource   |          |Job Title  |          |Email     |
+-----------+          |Description|          |Notes     |
|Name       |          |FT/PT      |          |Archive   |
|Type       |1--------8|Location   |          +----+-----+
|Link       |          |Company ID |               8
|Description|          |Contact ID |8----+         |
+-----------+          |Phone      |     |         |
                       |Scource ID |     |         |
                       +-----------+     |         |
                             1           |         |
                             |           |         1
                             |           |    +-----------+
                             |           |    |Company    |
                             |           |    +-----------+
                             8           +---8|Name       |
                       +-------------+        |Address    |
                       |Activities   |        |City, State|
                       +-------------+        |Postal Code|
                       |Date         |        |Phone/Fax  |
                       |Job Lead ID  |        |Email      |
                       |Activity Type|        |Website    |
                       |Detail       |        +-----------+
                       |Completed    |
                       +-------------+
</pre>
</li>
<li>下一步就是把这个简单的图标转换成EER diagram(Enhanced Entity-Releationship
diagram),EER的优点是其有更加detail的类型信息,比如INT(a numeric integer)还是
VARCHAR(for text and other alphanumeric data)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3">Defining the Tables</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li>data modeling的最后一个阶段是转换成physical data model(也叫schema),具体讲
起来就是从当前的data model里面把数据写入到table和table的field里面(使用SQL):
<ul class="org-ul">
<li>每个entity变成一个table
</li>
<li>每个attribute都变成了一个field
</li>
</ul>
</li>
<li>在这最后一个过程中,会加入更多的设计细节,比如那些field会加上索引以期提高搜索的速度
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Chapter 4: Database Normalization</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">From Design to Reality</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>本章会介绍data modeling的最后一个步骤:形成physical database
</li>
<li>我们这里的数据库都是关系型数据库,主要的成员是table和field
</li>
<li>这些table和其他table会在database management software的帮助下,联系在一起.
</li>
<li>这种联系的方式(也就是关系型数据库)最早是1970年被Edgar F. Codd发明的. Codd博
士创造了一系列的rules,在这些rules的管理下,存储数据有了很多优点:data的存储可
以防止duplication,从而保证正确性的同时,还能简化维护
</li>
<li>这些rules以"范式"的形式存在,从更高的理论高度,指引我们的数据存储
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Looking Back</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>我们前面已经把Job Search Plus简化到了一张易懂的表上,如下
<pre class="example">
                                              +----------+
                                              |Contact   |
                                              +----------+
                             +---------------1|Name      |
                             |                |Company ID|
                             8                |Title     |
                       +-----------+          |Address   |
                       |Job Lead   |          |City State|
                       +-----------+          |Postal Cod|
+-----------+          |Date       |          |Phone/Fax |
|Resource   |          |Job Title  |          |Email     |
+-----------+          |Description|          |Notes     |
|Name       |          |FT/PT      |          |Archive   |
|Type       |1--------8|Location   |          +----+-----+
|Link       |          |Company ID |               8
|Description|          |Contact ID |8----+         |
+-----------+          |Phone      |     |         |
                       |Scource ID |     |         |
                       +-----------+     |         |
                             1           |         |
                             |           |         1
                             |           |    +-----------+
                             |           |    |Company    |
                             |           |    +-----------+
                             8           +---8|Name       |
                       +-------------+        |Address    |
                       |Activities   |        |City, State|
                       +-------------+        |Postal Code|
                       |Date         |        |Phone/Fax  |
                       |Job Lead ID  |        |Email      |
                       |Activity Type|        |Website    |
                       |Detail       |        +-----------+
                       |Completed    |
                       +-------------+
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">The Normalization Process</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>理论界存在很多数据库的范式,但是我们只需要了解其中最重要的一些就可以了.如果
能完美的实现这些范式,那么数据库就会非常的stable而且well-organized,但是由于
客观业务需求的不同,我们可能不会完整的follow 这些范式,只能选择性的实现其中一
部分
</li>
<li>最重要的范式有:
<ul class="org-ul">
<li>第一范式(1NF)
</li>
<li>第二范式(2NF)
</li>
<li>第三范式(3NF)
</li>
<li>等等
</li>
</ul>
</li>
<li>第N+1范式满足的前提是第N范式已经得到满足
</li>
</ul>
</div>
<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1">First Normal Form(1NF)</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>第一范式有如下的要求:
<ul class="org-ul">
<li>一个table里面所有的field必须是最小的信息片段(smallest useful piece of
information), 最小也就意味着信息不可再分.这个要求可以简化为atomicity.一个
field不能拥有两个value.这single的value常被称作scalar value
</li>
<li>table不能有重复的field.两个filed名字不一样,内容重复也不行
</li>
</ul>
</li>
<li>Atomicity把数据减小到尽可能小(只要还有实际的意义),但是根据具体的业务逻辑的
不同,我们对于"有实际意义"的定义却不同
</li>
<li>在Job Search Plus里面,Company和Contact table里面都有地址这一项,我完全可以
把地址存成一个字符串,比如'123 Lark Drive, Ocala, FL 34470'
</li>
<li>但是当我们需要把公司按照city, state,或者ZIP code排序的时候,就显得不太适用了.
这个时候为了能够可以排序(数字数据库对于某个域的排序非常的快),我们要把地址拆
成多个field
<pre class="example">
Address              City     State   Zip
-----------------    -----    -----   -------
123 Lark Drive       Ocala    FL      34470
</pre>
</li>
<li>把数据分成较小的part的话,显而易见的优点就有:
<ul class="org-ul">
<li>按照不同City或者ZIP分钟,或者排序的话,速度更快
</li>
<li>能够显著的减少数据冗余
</li>
</ul>
</li>
<li>既然分成较小的part很好,我们为什不把上面的Address也分成多个field?如果这样做
的话,就是一个典型的over-normalization.判断是否over-normalization的原则很简
单:看看这么做是否"值得".这里显然不值得,因为我们很少安装地址排序或者分组
</li>
<li>1NF的另外一个重要特点是不能有重复的field或是groups of field.其中这个group of
field是新手容易忽视的地方:考虑下和activity的one to many关系,如果我们允许group
of field的话,我们Job Lead可能会有这样的一个multiple field: 'Activity1',
'Activity2', 'Activity3'.换句话说就是"一个field里面存储多个entity!"
</li>
<li>这种做法有很多的缺点:
<ul class="org-ul">
<li>它限制了能够存储的activities的数目,无论你的field是什么格式,比如text,其长
度总是有限的,不能无限制的存储activity
</li>
<li>在one一端,把many一端的详细信息都列出来会非常的麻烦:你还要在循环里面处理每
个activity,然后把结果汇总起来
</li>
</ul>
</li>
<li>我们relation database的解决方案就是one to many数据库:把数据分成两个表存储,
一个job lead table,一个activity table.这两个数据库会被联系起来以达到如下目
的:
<ul class="org-ul">
<li>每个activity table里面的一个record会和某个特定的job lead联系起来
</li>
<li>每个job lead会和一个或多个activity联系起来
</li>
</ul>
</li>
<li>这种one to many的设计会让"获取"如下信息的操作非常简便(company和contact也是
one-to-many的关系,company是one)
<ul class="org-ul">
<li>某个lead对应的所有的activities
</li>
<li>某个job lead在某一段date range里面的特定activity
</li>
<li>某个company所有的contact
</li>
<li>某个contact所有的company按照字母顺序排序
</li>
</ul>
</li>
<li>在欧美的数据库设计中,通常会把地址设计成两行,比如
<pre class="example">
+-----------+
|Company    |
+-----------+
|Name       |
|Address1   |
|Address2   |
|City       |
|State      |
|Postal Code|
|Phone      |
+-----------+
</pre>
</li>
<li>这种设计看起来是明显的违反了"不能repeating field"的规则,但是问题的根源在于
前面说到的exception.在欧美的地址设计中,总是会设计成两行,而且保证不会有第三
行.在面对范式和real business logic的情况下,要服从real business logic
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2">Second Normal Form(2NF)</h4>
<div class="outline-text-4" id="text-4-3-2">
<ul class="org-ul">
<li>第二范式首先要求要满足第一范式,然后再满足如下要求:
<ul class="org-ul">
<li>所有不是table key的一部分的field,也 必须depend on 整个key(entire key)
<pre class="example">
All fields that are not part of a table's key must be functionally
dependent on the entire key.
</pre>
</li>
</ul>
</li>
<li>在relational database的table里面,每个record都要和其他record相互区别开来,使
用的办法就是每个record的"某个field,或者几个field联合起来的值,唯一"
</li>
<li>这些field(field or combination of fields that serves to uniquely identify
each record in the table)叫做table的primary key
</li>
<li>primary key是一个特殊的index field,所谓index field是指能够帮助数据库查找和
排序的field
<pre class="example">
Index fields assist the database in searching or sorting information on
that field and the primary key does this while also uniquely identifying
each record
</pre>
</li>
<li>某个table还可以存储其他table的primary key,从而uniquely的reference那个table
里面的record.这种field被称之为foreign key. 前面的例子中,Contact entity都会
有一个field 叫做"CompanyID",这就是一个外键(foreign key),对应Company table
的主键(primary key)
</li>
<li>前面说过primary key是一个index field,但是其实某个table可以在primary key之
外再加上另外的的field作为index field.但是并不是所有的key都可以作为index key:
只有全局唯一的field(primary key必然唯一)才能作为index key,常见的例子有驾驶
员的驾驶执照号,或者是产品的序列号.
</li>
<li>这里还要注意的是,虽然有很多field是全局唯一的,但是primary key只有一个.虽然
primary key可能是一个或者多个field的combination(所以不能叫做primary field),
但是它确实是只有一个!
</li>
<li>前面说到index要求全局唯一,除了primary key以外的其他field很难做到全局唯一(因
为只要有一对相同就不行),这个时候,我们可以要求index field是"一系列field的
combination",然后保证这个combination唯一就可以了.这个和primary key的定义是
一样的
<pre class="example">
        因为全局唯一性很难,所以我们允许多个field 组合起来,视同为一个field
        来作为index field或者是primary key
</pre>
</li>
<li>这种cobinate多个field的方法叫做composite key, 可以用于index field或者primary
key,实际上绝少用于primary key,因为:key里面的多个field必须在其他table里面的
duplicated,如果他们想reference你的主键作为外键的话!
</li>
<li>有些情况下,table里面会有一个field的数据是'天然unique的',比如在一个小的图书
馆系统里面,ISBN field就肯定是unique的,所以也是可以作为primary key的,但是这
种选择经不起时间的考验,一旦图书馆变大,一本书可能有两个copy的话,ISBN就不再
unique了.这种情况下,我们可以引入另外一个field copy(来表示这是某个特定book
的第几本),那么copy和ISBN两个域组合起来就肯定是unique的了.也就可以作为primary
key或者index field了.这也就是典型的一个composite key的例子
</li>
<li>虽然"绝对unique的field"肯定可以作为primary field,但是只是有潜力而已,并不是
一定可以拿来用,比如:在我们的例子中有employee表,里面的每个employee都肯定有
身份证号,这个号码可以保证是唯一的,但是却不是一个好的primary key的选择:因为
这是"隐私信息",而primary key需要很精彩的到处传递,使用隐私信息作为主键显然
不合理.
</li>
<li>虽然身份证号不适合做primary key,但是却非常适合做index field
</li>
<li>好了我们现在总结一下,对于primary key:
<ul class="org-ul">
<li>很多情况下很难找到某一个field绝对的unique,需要配合至少另外一个field组成
unique的composite key.但是composite key作为主键的话,其他table来引用主键
的时候,要同时引用多于一个field.这非常的麻烦!
</li>
<li>好不容易找到某个field是unique,但是又面临这个field有可能会改变,或者虽然永
远不改变,但是是隐私信息,没法暴露给其他table或者外界
</li>
</ul>
</li>
<li>最终的解决方案是surrogate key(代理键),也就是数据库生成的在field内绝对unique
的值(最常见的保证unique的方法是auto increment,或者是创建GUID字符串,但是不
常见)
<pre class="example">
The database management software can generate an automatically
incrementing number or unique string of characters as each
record is created
</pre>
</li>
<li>surrogate key的产生(通常是在数据创建的时候产生surrogate key)是数据库管理软
件内部的细节,如何产生用户是无法知晓的.
</li>
<li>多说一句surrogate key大多数情况下和primary key是一回事.为什么说是大多数情况
下?因为少数情况下,数据库是以temporal database的状态存在的.这种情况下surrogate
key需要另外的域来对应primary key.
</li>
<li>其实在绝大多数的情况下,数据库都是使用surrogate key作为主键的,我们这里的例
子也不例外.某个table引用其他table的时候,也只需要引用一个field就可以了.这样
外键就控制在一个field了,减小了空间存储
</li>
<li>而且,使用主键外键的最大好处就是绝大部分数据只用存在一个地方就可以了,需要的
时候使用外键引用一下.
</li>
<li>鉴于使用代理键来作为primary key其实已经是事实上的标准,我可以从另外一个角度
来理解下Second Normal Form: 所有不是table主键的域,必须直接的描述table的主
体,并且这个域的值,必须直接的依赖于这个记录,即便这个值不一定是unique的
<pre class="example">
Every field outside the table's primary key must directly describe
the subject of that table and the value of the field must directly
depend on which item is being represented by the record, even if
it's not unique for each record.
</pre>
</li>
<li>我们来举个例子:
<ul class="org-ul">
<li>对于一个job lead来说,发布这个job lead的company的email和这个job lead没有
直接的关系,所以不应该把某个公司的email一遍又一遍的存储在job lead的表中.
</li>
<li>对于一个activity来说,某个job lead的job desscription并不是和自己直接相关,
所以我们没必要一遍一遍的存储在activity里面,而且应该存储在job lead表里面,
然后通过一个外键LeadID来引用
</li>
</ul>
</li>
<li>我们来比较下和原定义的不同: 在第二范式创建的时候,还没有代理键的概念,所以有
些field就天然是做primary key的(没有专职的和数据没关系的代理键的存在)
<pre class="example">
All fields that are not part of a table's key must be functionally
dependent on the entire key.
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3">Third Normal Form (3NF)</h4>
<div class="outline-text-4" id="text-4-3-3">
<ul class="org-ul">
<li>第三范式是在满足第一第二范式的情况下,还要满足
<ul class="org-ul">
<li>所有不是key一部分的field,必须相互独立
<pre class="example">
All fields that ar not part of the key must be functionally
independent of each other
</pre>
</li>
</ul>
</li>
<li>这一点说起来拗口,但是其实是一个非常实际是要求,满足第三范式就意味着:更改一个
non-key的field不会要求另外一个non-key的field进行改变!
</li>
<li>做过excel的同学会有这样的体验,你有几个field存放着某些报销的金额,最后还有一
个总的field,帮你记着你的总额!这样每当你输入一个金额的时候,总额就会跟着改变
</li>
<li>如果你理解第三范式,就会差距到这种"calculated field"的方式,就是一种典型的
anti-pattern
</li>
<li>我们对比下第二范式和第三范式,发现这两个范式说的是一枚硬币的两面:
<ul class="org-ul">
<li>第二范式要求所有不是key的filed必须depend on key
</li>
<li>第三范式要求所有不同key的field必须相互之间independent
</li>
</ul>
</li>
<li>有人总结了第二和第三范式,得到了如下如下警示
<pre class="example">
Every non-key field must provide a fact about the key, the
whole key, and nothing but the key.
</pre>
</li>
<li>我们来看一个具体的anti-3nf的例子:含有calculated field的table
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="right" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">OrderLineID</th>
<th scope="col" class="right">OrderID</th>
<th scope="col" class="left">ProductID</th>
<th scope="col" class="left">ProductName</th>
<th scope="col" class="left">Price</th>
<th scope="col" class="right">Quanlity</th>
<th scope="col" class="left">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">003</td>
<td class="right">4324</td>
<td class="left">A8791</td>
<td class="left">3x3 table</td>
<td class="left">$285.00</td>
<td class="right">2</td>
<td class="left">$570.00</td>
</tr>
</tbody>
</table>
</li>
<li>这个例子其实两处违法了3NF:
<ul class="org-ul">
<li>我们不需要既存储ProductID,又存储ProductName.这两者必然是dependent的,一旦
ProductID改动的话,ProductName必然改动.反过来说,ProductName依赖ProductID
那么正好创建一个Product table,安装2NF的要求,ProductName肯定是这个表里面
的主力成员:因为它紧密的依赖于这个表的primary key
</li>
<li>Total field肯定是不行的,因为它依赖于另外两个non-key field: Price, Quantity
一旦我们更改了其中一个filed,total field会需要跟着进行更改.注意这个更改要
程序的开发者来进行维护,数据库是不会帮我们维护的!这看起来好像没什么大不了
的,但是随着时间的流逝,"更改fieldA同时还要更改fieldB"这件事情很容易忘记,最
后就会出现大家忘记了这件事情,数据出现了不一致
</li>
</ul>
</li>
<li>另外的容易'犯错'情况是inventory,inventory会列出商家有的所有产品.这个table
如果存在的话,可以含有product name, package type, model number等等,但是注意
我们不要含有如下的信息:
<ul class="org-ul">
<li>当前商品的库存
</li>
<li>当前商品最后一次售出的时间
</li>
</ul>
</li>
<li>这里的问题还是"这些信息不够dependent on key".这些信息即便放在上面的表里面
也不会出现特别严重的问题,比如产品名字更改了,但是我们的库存并不会更改(这个跟
calculated field不一样,那个是压根不行.这个是不建议).
</li>
<li>但是这些信息确实和key的关系不大(这个商品id可以在不同的商场卖出,都是一个商品,
但是其库存每个商场不一样,库存不能说是商品相关信息).同时,库存的频率过高,我们
另外起一个表来存储比较好.
</li>
<li>我们的例子符合3NF(也就同时符合1NF,2NF),所以我们不需要进行什么改动
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4">Boyce-Codd Normal Form (BCNF or 3.5NF)</h4>
<div class="outline-text-4" id="text-4-3-4">
<ul class="org-ul">
<li>绝大部分情况下3NF已经是我们所需要的最高标准了.
<pre class="example">
Most of the time, the achievement of 3NF will have resolved
any potential issues in the tables.
</pre>
</li>

<li>BCNF(3.5NF)的主要目的,在于:
<ul class="org-ul">
<li>去寻找是否有field可以拆成自己的单独的一个table,从而减少数据的重复
</li>
<li>某几个field展现出了共同点是否可以合并成一个filed
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Data or Database?</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>前面我们总结了data model的过程,它主要是展现了特定的数据是如何组织的
<pre class="example">
Data model describes how a specific collection of data is organized
</pre>
</li>
<li>database model则有些许不同,其描述的是某款特定的database software使用何种具
体技术来组织并存储数据
</li>
<li>我们这里介绍的database model肯定是mysql使用relational model来组织数据啦!
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Chapter 5: Servers and Databases</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Building the Database</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>前面你学习了如何model data,并且把某些数据存放在哪些表里面,然后这些表通过一些
"外键"联系起来.
</li>
<li>这些都是虚拟的model,啊我没现在来创建physical data model(也叫作shema)
</li>
<li>physical data model(shema)是把data描述给DBMS(这里是mysql)的一个过程
</li>
</ul>
</div>
<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1">Accessing the Server</h4>
<div class="outline-text-4" id="text-5-1-1">
<ul class="org-ul">
<li>虽然MySQL是支持server和local都在本地的,但那只不过是为了方便使用.MySQL设计
的时候就是安装CS结构设计的.也就是Server和Client是在不同的host.所以很多时候
你要确认remote的server是不是在running,还有知道如何远程连接上server
</li>
<li>MySQL可以看做是一类软件的合称,具体来说有:
<ul class="org-ul">
<li>mysql-server:常驻内存的应用damon形式运行,一般在remote.
</li>
<li>mysql-client:包括:
<ol class="org-ol">
<li>bash里面的mysql命令:用来在命令行连接mysql-server
<div class="org-src-container">

<pre class="src src-sh">&gt; mysql -h localhost -u root -p
password: <span style="color: #2aa198;">(</span>enter password here<span style="color: #2aa198;">)</span>
Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 52
Server version: 5.5.43-0ubuntu0.14.04.1 <span style="color: #2aa198;">(</span>Ubuntu<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>bash里面的mysqladmin命令:主要用来检查server的运行情况
<div class="org-src-container">

<pre class="src src-sh">mysqladmin -uroot status
Uptime: 82418  Threads: 1  Questions: 3  Slow queries: 0  Opens: 105  Flush tables: 1  Open tables: 98  Queries per second avg: 0.000
</pre>
</div>
</li>
<li>还有其他第三方的GUI访问软件,比如MySQL Workbench
</li>
</ol>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2">The MySQL Command Prompt</h4>
<div class="outline-text-4" id="text-5-1-2">
<ul class="org-ul">
<li>默认的client就是mysql啦,登录sever以后,它会显示出一个不太友好的prompt
<div class="org-src-container">

<pre class="src src-sh">Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 5
Server version: 5.7.17 Homebrew

<span style="color: #268bd2;">Copyright</span> <span style="color: #2aa198;">(</span>c<span style="color: #2aa198;">)</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span style="color: #2aa198;">'help;'</span> or <span style="color: #2aa198;">'\h'</span> for help. Type <span style="color: #2aa198;">'\c'</span> to clear the current input statement.

mysql&gt;
</pre>
</div>
</li>
<li>这个prompt主要是让你使用SQL语言来和mysql-server进行通信的,一个例子如下
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> as <span style="color: #2aa198;">"Current Date"</span>;
SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> as <span style="color: #2aa198;">"Current Date"</span>;
+--------------+
| Current Date |
+--------------+
| 2017-03-20   |
+--------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.01 sec<span style="color: #2aa198;">)</span>

mysql&gt; quit
quit
Bye
</pre>
</div>
</li>
<li>这里我们使用了MySQL里面内置的一个函数CURRENT_DATE,在Mysql里面有很多这样和
date或者text manipulation打交道的函数.他们可以直接写到SQL里面
</li>
<li>我们这里使用了SELECT,这个是SQL里面我们最常用的命令了.SELECT的作用,是让sever
返回特定的as set of results.
</li>
<li>还要注意,SQL是以"分号"结尾的,这个分号必须有,让程序直接我们这个查询结束了.
</li>
<li>我们再来看一个例子,让CURRENT_DATE有个更加友好的名字
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">'Today\'</span>s Date<span style="color: #2aa198;">';</span>
<span style="color: #2aa198;">SELECT CURRENT_DATE() AS '</span>Today<span style="color: #2aa198;">\'</span>s Date<span style="color: #2aa198;">';</span>
<span style="color: #2aa198;">+--------------+</span>
<span style="color: #2aa198;">| Today'</span>s Date |
+--------------+
| 2017-03-20   |
+--------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>这个例子演示了AS的用法,AS可以作为column的别名(alias)
</li>
<li>alias里面因为有单引号,所以使用了"\"(backslash)来作为Escape character
</li>
<li>Mysql除了支持单引号,还支持双引号和重音符(``),有了另外两种字符串形式,其实Escape
character并不太重要.但是其他数据库可能不支持这么多字符串形式
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">"Today's Date"</span>;
SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">"Today's Date"</span>;
+--------------+
| Today<span style="color: #2aa198;">'s Date |</span>
<span style="color: #2aa198;">+--------------+</span>
<span style="color: #2aa198;">| 2017-03-20   |</span>
<span style="color: #2aa198;">+--------------+</span>
<span style="color: #2aa198;">1 row in set (0.00 sec)</span>

<span style="color: #2aa198;">mysql&gt; SELECT CURRENT_DATE() AS `Today'</span>s Date<span style="color: #6c71c4; font-weight: bold;">`;</span>
<span style="color: #6c71c4; font-weight: bold;">SELECT CURRENT_DATE() AS `</span>Today<span style="color: #2aa198;">'s Date`;</span>
<span style="color: #2aa198;">+--------------+</span>
<span style="color: #2aa198;">| Today'</span>s Date |
+--------------+
| 2017-03-20   |
+--------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>很有意思的是,如果你换行的时候,是在某种字符串之间,那么下一个prompt会提示你
需要某种字符串结尾,比如下面的&gt;左边有个重音符.结果出现了排版问题是自然的,一
因为在Date前面有个回车符
<div class="org-src-container">

<pre class="src src-sh">SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #6c71c4; font-weight: bold;">`Today's</span>
<span style="color: #6c71c4; font-weight: bold;">    `</span>&gt; Date<span style="color: #6c71c4; font-weight: bold;">`;</span>
<span style="color: #6c71c4; font-weight: bold;">+---------------+</span>
<span style="color: #6c71c4; font-weight: bold;">| Today's</span>
<span style="color: #6c71c4; font-weight: bold;">Date |</span>
<span style="color: #6c71c4; font-weight: bold;">+---------------+</span>
<span style="color: #6c71c4; font-weight: bold;">| 2017-03-20    |</span>
<span style="color: #6c71c4; font-weight: bold;">+---------------+</span>
<span style="color: #6c71c4; font-weight: bold;">1 row in set (0.00 sec)</span>
</pre>
</div>
</li>
<li>当然你也可以一行多个"分号"来运行多个语句
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT NOW<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">"The current date and time is - "</span>; SELECT CONCAT<span style="color: #2aa198;">(</span>USER<span style="color: #b58900;">()</span>, <span style="color: #2aa198;">' is currently logged in.'</span><span style="color: #2aa198;">)</span> as <span style="color: #2aa198;">"Current User"</span>;
+---------------------------------+
| The current date and time is -  |
+---------------------------------+
| 2017-03-20 17:14:57             |
+---------------------------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

+----------------------------------------+
| Current User                           |
+----------------------------------------+
| root@localhost is currently logged in. |
+----------------------------------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>上面的例子用了两个新的函数,第一个就是CONCAT(),这是个连接字符串的函数,属于
高频操作了.数据库的1NF让数据库的field已经达到了atomic的极致,所以一段说明性
的文字很容易是多个field的concat!
</li>
<li>第二个是USER()函数,会显示当前登录的用户
</li>
<li>上面主要讲了Mysql的字符串函数,同时mysql还有很多处理日期的函数:
<ul class="org-ul">
<li>CURRENT_DATE():返回当前日期
</li>
<li>ADDDATE():增加n天到某个日期
</li>
<li>返回两个日期之间的差距
</li>
</ul>
</li>
<li>日期函数例子如下
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">"Today's Date"</span>, ADDDATE<span style="color: #2aa198;">(</span>CURRENT_DATE<span style="color: #b58900;">()</span>, 30<span style="color: #2aa198;">)</span> AS <span style="color: #2aa198;">"30 Days"</span>, ADDDATE<span style="color: #2aa198;">(</span>CURRENT_DATE<span style="color: #b58900;">()</span>, 60<span style="color: #2aa198;">)</span> AS <span style="color: #2aa198;">"60 Days"</span>;
SELECT CURRENT_DATE<span style="color: #2aa198;">()</span> AS <span style="color: #2aa198;">"Today's Date"</span>, ADDDATE<span style="color: #2aa198;">(</span>CURRENT_DATE<span style="color: #b58900;">()</span>, 30<span style="color: #2aa198;">)</span> AS <span style="color: #2aa198;">"30 Days"</span>, ADDDATE<span style="color: #2aa198;">(</span>CURRENT_DATE<span style="color: #b58900;">()</span>, 60<span style="color: #2aa198;">)</span> AS <span style="color: #2aa198;">"60 Days"</span>;
+--------------+------------+------------+
| Today<span style="color: #2aa198;">'s Date | 30 Days    | 60 Days    |</span>
<span style="color: #2aa198;">+--------------+------------+------------+</span>
<span style="color: #2aa198;">| 2017-03-20   | 2017-04-19 | 2017-05-19 |</span>
<span style="color: #2aa198;">+--------------+------------+------------+</span>
<span style="color: #2aa198;">1 row in set (0.00 sec)</span>

<span style="color: #2aa198;">mysql&gt; SELECT CURRENT_DATE() AS "Today'</span>s Date<span style="color: #2aa198;">", DATEDIFF('2017-08-30', CURRENT_DATE()) AS "</span>Days Remaining<span style="color: #2aa198;">";</span>
<span style="color: #2aa198;">SELECT CURRENT_DATE() AS "</span>Today<span style="color: #2aa198;">'s Date", DATEDIFF('</span>2017-08-30<span style="color: #2aa198;">', CURRENT_DATE()) AS "Days Remaining";</span>
<span style="color: #2aa198;">+--------------+----------------+</span>
<span style="color: #2aa198;">| Today'</span>s Date | Days Remaining |
+--------------+----------------+
| 2017-03-20   |            163 |
+--------------+----------------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>MySQL也支持四则运算
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT 25 + 3 / 4 * <span style="color: #2aa198;">(</span>3 - 1<span style="color: #2aa198;">)</span> + <span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span> 10 + 15 + 20<span style="color: #b58900;">)</span> / 3<span style="color: #2aa198;">)</span> as Result;
SELECT 25 + 3 / 4 * <span style="color: #2aa198;">(</span>3 - 1<span style="color: #2aa198;">)</span> + <span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span> 10 + 15 + 20<span style="color: #b58900;">)</span> / 3<span style="color: #2aa198;">)</span> as Result;
+---------+
| Result  |
+---------+
| 41.5000 |
+---------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-3" class="outline-4">
<h4 id="sec-5-1-3">Creating Databases</h4>
<div class="outline-text-4" id="text-5-1-3">
<ul class="org-ul">
<li>首先是来查看已经存在的数据库
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW DATABASES;
SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>如果想查看某个database的内容,需要首先use这个数据库.我们以information_schema
为例,这个数据库存储了这个server上所有数据库的information,所以table有点多(使
用show tables来查看所有tables)
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; USE information_schema;
USE information_schema;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; SHOW TABLES;
SHOW TABLES;
+---------------------------------------+
| Tables_in_information_schema          |
+---------------------------------------+
| CHARACTER_SETS                        |
| COLLATIONS                            |
| ....                                  |
</pre>
</div>
</li>
<li>使用USE以后,就可以直接查询这个数据库里面的某个表了,当然有个更精确的方法是把
数据库名和表名写在一起,使用"."分割
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> FROM COLUMNS;
SELECT COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> FROM COLUMNS;
+----------+
| COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> |
+----------+
|     3104 |
+----------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.04 sec<span style="color: #2aa198;">)</span>

mysql&gt; SELECT COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> FROM information_schema.COLUMNS;
SELECT COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> FROM information_schema.COLUMNS;
+----------+
| COUNT<span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)</span> |
+----------+
|     3104 |
+----------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.03 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>定位了表以后,下面我们是来看某个表下面有哪些列(column)了,方法类似.但是我们
需要使用IN或者FROM来确定table
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW COLUMNS IN CHARACTER_SETS;
SHOW COLUMNS IN CHARACTER_SETS;
+----------------------+-------------+------+-----+---------+-------+
| Field                | Type        | Null | Key | Default | Extra |
+----------------------+-------------+------+-----+---------+-------+
| CHARACTER_SET_NAME   | varchar<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span> | NO   |     |         |       |
| DEFAULT_COLLATE_NAME | varchar<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span> | NO   |     |         |       |
| DESCRIPTION          | varchar<span style="color: #2aa198;">(</span>60<span style="color: #2aa198;">)</span> | NO   |     |         |       |
| MAXLEN               | bigint<span style="color: #2aa198;">(</span>3<span style="color: #2aa198;">)</span>   | NO   |     | 0       |       |
+----------------------+-------------+------+-----+---------+-------+
4 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>这种显示方式有时候会导致宽带过长,我们可以使用\G来替代分号,从而让每个field
的结果单独占一行
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW COLUMNS IN CHARACTER_SETS\G
SHOW COLUMNS IN CHARACTER_SETS\G
*************************** 1. row ***************************
  Field: CHARACTER_SET_NAME
   Type: varchar<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span>
   Null: NO
    Key:
Default:
  Extra:
*************************** 2. row ***************************
  Field: DEFAULT_COLLATE_NAME
   Type: varchar<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span>
   Null: NO
    Key:
Default:
  Extra:
*************************** 3. row ***************************
  Field: DESCRIPTION
   Type: varchar<span style="color: #2aa198;">(</span>60<span style="color: #2aa198;">)</span>
   Null: NO
    Key:
Default:
  Extra:
*************************** 4. row ***************************
  Field: MAXLEN
   Type: bigint<span style="color: #2aa198;">(</span>3<span style="color: #2aa198;">)</span>
   Null: NO
    Key:
Default: 0
  Extra:
4 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-4" class="outline-4">
<h4 id="sec-5-1-4">Creating the Database</h4>
<div class="outline-text-4" id="text-5-1-4">
<ul class="org-ul">
<li>创建数据库的命令非常简单
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; CREATE DATABASE JobSearchPlus;
CREATE DATABASE JobSearchPlus;
Query OK, 1 row affected <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; SHOW DATABASES;
SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| JobSearchPlus      |
| mysql              |
| performance_schema |
| sys                |
| toy_development    |
| toy_test           |
| vwops_development  |
| vwops_test         |
+--------------------+
9 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>大多数情况下,我们是运行脚本,而不是手动来创建数据库的,所以为了确保我们创建
的数据库之前没有重名的数据库,我们可以使用如下的代码来判断
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; CREATE DATABASE IF NOT EXISTS JobSearchPlus;
CREATE DATABASE IF NOT EXISTS JobSearchPlus;
Query OK, 1 row affected, 1 warning <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>创建数据库的时候,在原来,需要认真考虑的一个数据库的特性是数据库的character
set(以及内部的collation).前面我们创建了数据库,但是没指定,在没指定的情况下,
会有默认值.我们先来看看如何读取默认值
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT * FROM information_schema.SCHEMATA WHERE schema_name = <span style="color: #2aa198;">"JobSearchPlus"</span>;
SELECT * FROM information_schema.SCHEMATA WHERE schema_name = <span style="color: #2aa198;">"JobSearchPlus"</span>;
+--------------+---------------+----------------------------+------------------------+----------+
| CATALOG_NAME | SCHEMA_NAME   | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |
+--------------+---------------+----------------------------+------------------------+----------+
| def          | jobsearchplus | utf8                       | utf8_general_ci        | NULL     |
+--------------+---------------+----------------------------+------------------------+----------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>所谓character set是指数据库能够存储的字符串的种类,所有的character set如下.
注意Maxlen,这说明某个字符串最多使用几个bytes来存储.
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW CHARACTER SET;
SHOW CHARACTER SET;
+----------+---------------------------------+---------------------+--------+
| Charset  | Description                     | Default collation   | Maxlen |
+----------+---------------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |
| dec8     | DEC West European               | dec8_swedish_ci     |      1 |
| cp850    | DOS West European               | cp850_general_ci    |      1 |
| hp8      | HP West European                | hp8_english_ci      |      1 |
| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |
| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |
| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |
| ascii    | US ASCII                        | ascii_general_ci    |      1 |
| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |
| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |
| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |
| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |
| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |
| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |
| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |
| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |
| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |
| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |
| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |
| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |
| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 |
| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |
| cp866    | DOS Russian                     | cp866_general_ci    |      1 |
| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |
| macce    | Mac Central European            | macce_general_ci    |      1 |
| macroman | Mac West European               | macroman_general_ci |      1 |
| cp852    | DOS Central European            | cp852_general_ci    |      1 |
| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |
| utf8mb4  | UTF-8 Unicode                   | utf8mb4_general_ci  |      4 |
| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |
| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |
| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |
| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |
| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |
| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |
| binary   | Binary pseudo charset           | binary              |      1 |
| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |
| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |
| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |
| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |
+----------+---------------------------------+---------------------+--------+
41 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>我们知道Unicode最多的情况下会使用4个bytes来存储的(虽然使用4个的情况不多),
但是我们会看到我们默认的utf8 character set的MaxLen竟然只有3!
<pre class="example">
+----------+---------------------------------+--------+
| Charset  | Description                     | Maxlen |
+----------+---------------------------------+--------+
| utf8     | UTF-8 Unicode                   |      3 |
+----------+---------------------------------+--------+
</pre>
</li>
<li>这是早期mysql的不佳实践,为了减少存储而使用3个bytes来存储utf8.对于使用4个
bytes的字符串干脆就不支持.所以,新的数据库我们应该默认使用utf8mb4!
<pre class="example">
+----------+---------------------------------+--------+
| Charset  | Description                     | Maxlen |
+----------+---------------------------------+--------+
| utf8mb4  | UTF-8 Unicode                   |      4 |
+----------+---------------------------------+--------+
</pre>
</li>
<li>再来看看另外一个概念collations:所谓collation是指在character set确认的情况
下,如何来比较(比较了也就能排序)两个字符.
</li>
<li>说起来collation这个概念有些搞笑的意思,因为两个字符如何比较,那不是有规范来
定义么.按照规范来不就可以了.但是真正的情况是,mysql一开始真的不是安装规范来
的!为的,也只是一点cpu速度的提升,比如utf8默认的collation
utf8mb4_general_ci就真的没有满足规范,所以在比较法语德语的时候可能会出现问题!
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW COLLATION WHERE Charset = <span style="color: #2aa198;">'utf8mb4'</span>;
SHOW COLLATION WHERE Charset = <span style="color: #2aa198;">'utf8mb4'</span>;
+------------------------+---------+-----+---------+----------+---------+
| Collation              | Charset | Id  | Default | Compiled | Sortlen |
+------------------------+---------+-----+---------+----------+---------+
| utf8mb4_general_ci     | utf8mb4 |  45 | Yes     | Yes      |       1 |
| utf8mb4_bin            | utf8mb4 |  46 |         | Yes      |       1 |
| utf8mb4_unicode_ci     | utf8mb4 | 224 |         | Yes      |       8 |
| utf8mb4_icelandic_ci   | utf8mb4 | 225 |         | Yes      |       8 |
| utf8mb4_latvian_ci     | utf8mb4 | 226 |         | Yes      |       8 |
| utf8mb4_romanian_ci    | utf8mb4 | 227 |         | Yes      |       8 |
| utf8mb4_slovenian_ci   | utf8mb4 | 228 |         | Yes      |       8 |
| utf8mb4_polish_ci      | utf8mb4 | 229 |         | Yes      |       8 |
| utf8mb4_estonian_ci    | utf8mb4 | 230 |         | Yes      |       8 |
| utf8mb4_spanish_ci     | utf8mb4 | 231 |         | Yes      |       8 |
| utf8mb4_swedish_ci     | utf8mb4 | 232 |         | Yes      |       8 |
| utf8mb4_turkish_ci     | utf8mb4 | 233 |         | Yes      |       8 |
| utf8mb4_czech_ci       | utf8mb4 | 234 |         | Yes      |       8 |
| utf8mb4_danish_ci      | utf8mb4 | 235 |         | Yes      |       8 |
| utf8mb4_lithuanian_ci  | utf8mb4 | 236 |         | Yes      |       8 |
| utf8mb4_slovak_ci      | utf8mb4 | 237 |         | Yes      |       8 |
| utf8mb4_spanish2_ci    | utf8mb4 | 238 |         | Yes      |       8 |
| utf8mb4_roman_ci       | utf8mb4 | 239 |         | Yes      |       8 |
| utf8mb4_persian_ci     | utf8mb4 | 240 |         | Yes      |       8 |
| utf8mb4_esperanto_ci   | utf8mb4 | 241 |         | Yes      |       8 |
| utf8mb4_hungarian_ci   | utf8mb4 | 242 |         | Yes      |       8 |
| utf8mb4_sinhala_ci     | utf8mb4 | 243 |         | Yes      |       8 |
| utf8mb4_german2_ci     | utf8mb4 | 244 |         | Yes      |       8 |
| utf8mb4_croatian_ci    | utf8mb4 | 245 |         | Yes      |       8 |
| utf8mb4_unicode_520_ci | utf8mb4 | 246 |         | Yes      |       8 |
| utf8mb4_vietnamese_ci  | utf8mb4 | 247 |         | Yes      |       8 |
+------------------------+---------+-----+---------+----------+---------+
26 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>按照规范实现的collation是utf8_unicode_ci
</li>
<li>前面说character set和collation是以前数据库创建需要考虑的问题,那么今天我们就
不需要考虑了么?答案是真的不需要,我们只需要一股脑使用utf8mb4 + utf8_unicode_ci
就可以了
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; CREATE DATABASE JobSearchPlus CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
CREATE DATABASE JobSearchPlus CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
Query OK, 1 row affected <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; SELECT * FROM information_schema.SCHEMATA WHERE schema_name = <span style="color: #2aa198;">"JobSearchPlus"</span>;
SELECT * FROM information_schema.SCHEMATA WHERE schema_name = <span style="color: #2aa198;">"JobSearchPlus"</span>;
+--------------+---------------+----------------------------+------------------------+----------+
| CATALOG_NAME | SCHEMA_NAME   | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |
+--------------+---------------+----------------------------+------------------------+----------+
| def          | jobsearchplus | utf8mb4                    | utf8mb4_unicode_ci     | NULL     |
+--------------+---------------+----------------------------+------------------------+----------+
1 row<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-5" class="outline-4">
<h4 id="sec-5-1-5">Database Users and Security</h4>
<div class="outline-text-4" id="text-5-1-5">
<ul class="org-ul">
<li>如果你是本地修改数据库的话,那么使用root用户是最好的,永远不会有权限的问题.
但是真正的数据库在使用的时候都是要创建不同的用户,拥有不同的权限的.
</li>
<li>需要注意的是,MySQL的用户和密码是和操作系统的用户名密码完全独立的(这点和SQLServer
不一样).所有的用户都存储在`mysql` database的`user`table里面.如果我们使用最
常见的[database].[table].[column]形式来表示的话,就是mysql.user.user
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT user, host from mysql.user;
SELECT user, host from mysql.user;
+-----------+-----------+
| user      | host      |
+-----------+-----------+
| mysql.sys | localhost |
| root      | localhost |
+-----------+-----------+
2 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>为什么我们要打印两个field呢?因为mysql的权限其实是这两个field的结合体,也就
是说只有从`host`登录的`user`才有相应的权限.
</li>
<li>换句话说,我们的user和host两个column联合起来起到了composite primary key的作
用,而且其他的table也会把这两个primary key作为用户table的外键.
</li>
<li>通过列出数据库中所有的列,发现mysql.user表确实没有常规的那种单一的primary key
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW COLUMNS FROM mysql.user;
SHOW COLUMNS FROM mysql.user;
+------------------------+-----------------------------------+------+-----+-----------------------+-------+
| Field                  | Type                              | Null | Key | Default               | Extra |
+------------------------+-----------------------------------+------+-----+-----------------------+-------+
| Host                   | char<span style="color: #2aa198;">(</span>60<span style="color: #2aa198;">)</span>                          | NO   | PRI |                       |       |
| User                   | char<span style="color: #2aa198;">(</span>32<span style="color: #2aa198;">)</span>                          | NO   | PRI |                       |       |
| Select_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Insert_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Update_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Delete_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Drop_priv              | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Reload_priv            | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Shutdown_priv          | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Process_priv           | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| File_priv              | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Grant_priv             | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| References_priv        | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Index_priv             | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Alter_priv             | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Show_db_priv           | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Super_priv             | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_tmp_table_priv  | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Lock_tables_priv       | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Execute_priv           | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Repl_slave_priv        | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Repl_client_priv       | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_view_priv       | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Show_view_priv         | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_routine_priv    | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Alter_routine_priv     | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_user_priv       | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Event_priv             | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Trigger_priv           | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| Create_tablespace_priv | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| ssl_type               | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">''</span>,<span style="color: #2aa198;">'ANY'</span>,<span style="color: #2aa198;">'X509'</span>,<span style="color: #2aa198;">'SPECIFIED'</span><span style="color: #2aa198;">)</span> | NO   |     |                       |       |
| ssl_cipher             | blob                              | NO   |     | NULL                  |       |
| x509_issuer            | blob                              | NO   |     | NULL                  |       |
| x509_subject           | blob                              | NO   |     | NULL                  |       |
| max_questions          | int<span style="color: #2aa198;">(</span>11<span style="color: #2aa198;">)</span> unsigned                  | NO   |     | 0                     |       |
| max_updates            | int<span style="color: #2aa198;">(</span>11<span style="color: #2aa198;">)</span> unsigned                  | NO   |     | 0                     |       |
| max_connections        | int<span style="color: #2aa198;">(</span>11<span style="color: #2aa198;">)</span> unsigned                  | NO   |     | 0                     |       |
| max_user_connections   | int<span style="color: #2aa198;">(</span>11<span style="color: #2aa198;">)</span> unsigned                  | NO   |     | 0                     |       |
| plugin                 | char<span style="color: #2aa198;">(</span>64<span style="color: #2aa198;">)</span>                          | NO   |     | mysql_native_password |       |
| authentication_string  | text                              | YES  |     | NULL                  |       |
| password_expired       | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
| password_last_changed  | timestamp                         | YES  |     | NULL                  |       |
| password_lifetime      | smallint<span style="color: #2aa198;">(</span>5<span style="color: #2aa198;">)</span> unsigned              | YES  |     | NULL                  |       |
| account_locked         | enum<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'N'</span>,<span style="color: #2aa198;">'Y'</span><span style="color: #2aa198;">)</span>                     | NO   |     | N                     |       |
+------------------------+-----------------------------------+------+-----+-----------------------+-------+
45 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>既然是两个field作为key,那么可以说单一一个field不能"单独"定义一个用户.比如
下面的例子中,即便我们都使用joe来登录数据库,但是你从localhost登录,还是从
otherdomain.com登录会对应不同的'用户',权限也就不一样
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">user</th>
<th scope="col" class="left">host</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">joe</td>
<td class="left">localhost</td>
</tr>

<tr>
<td class="left">joe</td>
<td class="left">otherdomain.com</td>
</tr>

<tr>
<td class="left">guest</td>
<td class="left">%</td>
</tr>
</tbody>
</table>
</li>
<li>第三个用户也很特别,来自于% host,也就是说可以从任何IP进行登录.需要注意的是
user table里面的host是用来在登录的时候,对用户做一次判断的,所以可以是这种wildcard
值,而不一定是确定的值
</li>
<li>mysql.user table是mysql认证的第一步,面对所有试图的登录,mysql都会用这个表来
进行检查
</li>
<li>mysql认证的第二个部分,是当已经登录的client进行SQL或者mysql内置等命令的时候,
要去user表里面查找某个用户是否有相应的权限.后面我们会看到如何设置这个权限
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-6" class="outline-4">
<h4 id="sec-5-1-6">Changing the Root Password</h4>
<div class="outline-text-4" id="text-5-1-6">
<ul class="org-ul">
<li>mysql在某些发行版上的root密码为空,这是一个非常大的安全隐患,所以安装数据库
后马上确认root密码是否为空是非常重要的.
</li>
<li>使用如下命令能够直接进入,说明密码真的是空
<div class="org-src-container">

<pre class="src src-sh">mysql -uroot
</pre>
</div>
</li>
<li>可以使用如下命令就能为root@localhost设置一个密码
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SET PASSWORD FOR <span style="color: #2aa198;">'root'</span>@<span style="color: #2aa198;">'localhost'</span> = PASSWORD<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'newpassword'</span><span style="color: #2aa198;">)</span>;
SET PASSWORD FOR <span style="color: #2aa198;">'root'</span>@<span style="color: #2aa198;">'localhost'</span> = PASSWORD<span style="color: #2aa198;">(</span><span style="color: #2aa198;">'newpassword'</span><span style="color: #2aa198;">)</span>;
Query OK, 0 rows affected, 1 warning <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; exit;
<span style="color: #859900; font-weight: bold;">exit</span>;
Bye
hfeng@ mysql <span style="color: #2aa198;">(</span>master<span style="color: #2aa198;">)</span> $ mysql -uroot
mysql -uroot
ERROR 1045 <span style="color: #2aa198;">(</span>28000<span style="color: #2aa198;">)</span>: Access denied for user <span style="color: #2aa198;">'root'</span>@<span style="color: #2aa198;">'localhost'</span> <span style="color: #2aa198;">(</span>using password: NO<span style="color: #2aa198;">)</span>
hfeng@ mysql <span style="color: #2aa198;">(</span>master<span style="color: #2aa198;">)</span> $ mysql -uroot -pnewpassword
mysql -uroot -pnewpassword
mysql: <span style="color: #2aa198;">[</span>Warning<span style="color: #2aa198;">]</span> Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 19
Server version: 5.7.17 Homebrew

<span style="color: #268bd2;">Copyright</span> <span style="color: #2aa198;">(</span>c<span style="color: #2aa198;">)</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span style="color: #2aa198;">'help;'</span> or <span style="color: #2aa198;">'\h'</span> for help. Type <span style="color: #2aa198;">'\c'</span> to clear the current input statement.

mysql&gt;
</pre>
</div>
</li>
<li>各种GUI软件在root登录的时候更改root密码总是会报错,所以更改root密码这件事,
还是命令行更靠谱
</li>
<li>还有一种方法是把超级管理员改名,改成root以外的名字,但是我觉得这个虽然会一定
程度迷惑hacker,但是会更迷惑队友.
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; RENAME USER <span style="color: #2aa198;">'root'</span>@<span style="color: #2aa198;">'localhost'</span> to <span style="color: #2aa198;">'primary'</span>@<span style="color: #2aa198;">'localhost'</span>;
</pre>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-7" class="outline-4">
<h4 id="sec-5-1-7">Adding New Accounts and Assigning Privileges</h4>
<div class="outline-text-4" id="text-5-1-7">
<ul class="org-ul">
<li>当你创建database的时候,你肯定不希望以后都使用root账户来控制每个database,而
是希望最好每个database都有自己的账号系统.要做到这样需要两步:
<ul class="org-ul">
<li>创建账号
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; CREATE USER <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span> IDENTIFIED BY <span style="color: #2aa198;">'password'</span>;
CREATE USER <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span> IDENTIFIED BY <span style="color: #2aa198;">'password'</span>;
Query OK, 0 rows affected <span style="color: #2aa198;">(</span>0.01 sec<span style="color: #2aa198;">)</span>

mysql&gt; SELECT user, host FROM mysql.user ;
SELECT user, host FROM mysql.user ;
+-----------+-----------+
| user      | host      |
+-----------+-----------+
| martin    | localhost |
| mysql.sys | localhost |
| root      | localhost |
+-----------+-----------+
3 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>为账号GRANT权限
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE ON JobSearchPlus.* TO <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
GRANT SELECT, INSERT, UPDATE, DELETE ON JobSearchPlus.* TO <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
Query OK, 0 rows affected <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; SELECT Host, Db, User, Select_priv, Insert_priv , Update_priv , Delete_priv , Create_priv FROM mysql.db ;
SELECT Host, Db, User, Select_priv, Insert_priv , Update_priv , Delete_priv , Create_priv FROM mysql.db ;
+-----------+---------------+-----------+-------------+-------------+-------------+-------------+-------------+
| Host      | Db            | User      | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv |
+-----------+---------------+-----------+-------------+-------------+-------------+-------------+-------------+
| localhost | sys           | mysql.sys | N           | N           | N           | N           | N           |
| localhost | jobsearchplus | martin    | Y           | Y           | Y           | Y           | N           |
+-----------+---------------+-----------+-------------+-------------+-------------+-------------+-------------+
2 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</li>
<li>GRANT是Mysql的内置命令,其原理是修改mysql.user的相关域(并且马上自动FLUSH
PRIVILEGES).我们当然可以使用SQL来直接更改mysql.db table,但是不推荐使用SQL
因为GRANT更不容易出错,而且自动回调用FLUSH PRIVILEGES
</li>
<li>这个时候,去查看mysql.db表,就不如GUI的界面清楚了.一般GUI程序都会有Schema
Privileges来显示某个用户的权限
</li>
<li>有"添加权限"必然有"取消权限"
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SELECT Host, Db, User, Delete_priv FROM mysql.db ;
SELECT Host, Db, User, Delete_priv FROM mysql.db ;
+-----------+---------------+-----------+-------------+
| Host      | Db            | User      | Delete_priv |
+-----------+---------------+-----------+-------------+
| localhost | sys           | mysql.sys | N           |
| localhost | jobsearchplus | martin    | Y           |
+-----------+---------------+-----------+-------------+
2 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; REVOKE DELETE ON JobSearchPlus.* FROM <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
REVOKE DELETE ON jobsearchplus.* FROM <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
Query OK, 0 rows affected <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>

mysql&gt; SELECT Host, Db, User, Delete_priv FROM mysql.db ;
SELECT Host, Db, User, Delete_priv FROM mysql.db ;
+-----------+---------------+-----------+-------------+
| Host      | Db            | User      | Delete_priv |
+-----------+---------------+-----------+-------------+
| localhost | sys           | mysql.sys | N           |
| localhost | jobsearchplus | martin    | N           |
+-----------+---------------+-----------+-------------+
2 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
<li>我们还可以查询某个用户的权限
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW GRANTS FOR <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
SHOW GRANTS FOR <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>;
+---------------------------------------------------------------------------+
| Grants for martin@localhost                                               |
+---------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span>                                |
| GRANT SELECT, INSERT, UPDATE ON <span style="color: #6c71c4; font-weight: bold;">`jobsearchplus`</span><span style="color: #657b83; font-weight: bold;">.</span>* TO <span style="color: #2aa198;">'martin'</span>@<span style="color: #2aa198;">'localhost'</span> |
+---------------------------------------------------------------------------+
2 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Chapter 6: Tables and Indexes</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Introduction</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>即便mysql里面存在很多很好用的GUI工具,但是你要知道这些工具的本质其实还是让你
手动操作,它转换成各种SQL语句然后发送.所以本质和你在mysql command line写SQL
是一样的,只不过GUI不容易出错
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Storage Engines</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>Mysql的一大优点就是它能够同时支持多个database storage engine
</li>
<li>storage engine的作用是管理table和它们存储在local computer的存储形式
</li>
<li>storage engine的作用最小单位是table,也就是说一个database里面的两个表可能是
不同的engine
</li>
<li>在Mysql v5.5.5以前,mysql默认的storage engine是MyISAM,其最大可存储的容量大小
是256TB,考虑到大部分的操作系统和文件系统的能力,这个大小限制已经"高"出很多了
</li>
<li>MyISAM的特点让它适合作为data warehouse,data warehouse的特点是:
<ul class="org-ul">
<li>数据量大
</li>
<li>高频率快速读取已经存在的数据
</li>
<li>低频率的增加或者更新
</li>
<li>支持数据压缩,所以在server上占用更少的空间
</li>
</ul>
</li>
<li>MyISAM的缺点也很明显,第一它不支持外键约束!
</li>
<li>如果某种数据库这种支持外键,从而能够保证primary key和foreign key的话,我们说
这种数据库支持referential integrity
</li>
<li>举个例子,我们有tableA里面的itemB有一个外键指向tableC里面的itemD,这个itemD可
以完全不存在.
</li>
<li>或者说一开始这个itemB指向这itemD,但是itemD被删除了,itemB没有"相应地"被删除,
但是数据库却不报错.
</li>
<li>从v5.5.5开始,默认的storage engine变成了InnoDB:
<ul class="org-ul">
<li>最大数据支持变成了64TB
</li>
<li>但是支持外键约束(所以也就保证了referential integrity)
</li>
<li>支持事务(也就保证了数据完整性)
</li>
<li>innode 还带来了一个全新的叫做clustered index的feature,其作用是在物理上安装
index来排序数据,从而加快搜索的速度
</li>
<li>mysql上面还是有其他的engine的,只不过用的人不多
<div class="org-src-container">

<pre class="src src-sh">mysql&gt; SHOW ENGINES;
SHOW ENGINES;
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
| MEMORY             | YES     | Hash based, stored<span style="color: #859900; font-weight: bold;"> in</span> memory, useful for temporary tables      | NO           | NO   | NO         |
| BLACKHOLE          | YES     | /dev/null storage engine <span style="color: #2aa198;">(</span>anything you write to it disappears<span style="color: #2aa198;">)</span> | NO           | NO   | NO         |
| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
9 rows<span style="color: #859900; font-weight: bold;"> in</span> set <span style="color: #2aa198;">(</span>0.00 sec<span style="color: #2aa198;">)</span>
</pre>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">Models and Schemas</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>使用MySQL workbench,你可以使用如下两种方式来创建数据库:
<ul class="org-ul">
<li>打开File &gt;&gt; new Model.这会打开一个新的model editor,然后按照我们前面说的data
model的步骤一步一步的去做
</li>
<li>使用各种方法(比如SQL)创建好数据库以后,反推EER diagram,这叫reverse engineering
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4">MySQL Workbench</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-sec-6-4-1" class="outline-4">
<h4 id="sec-6-4-1">Getting Started</h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li>创建链接什么的就很简单了,会了命令行以后,GUI只不过是找到地方输入命令行的信
息就可以了
</li>
<li>创建完mysql connection以后,界面会把connection workspace放在左边,右边是query
editor(这里可以输入SQL得到你想要的结果)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-4-2" class="outline-4">
<h4 id="sec-6-4-2">Creating the Tables</h4>
<div class="outline-text-4" id="text-6-4-2">
<ul class="org-ul">
<li>我们前面已经创建了jobsearch_plus(使用全小写的名字是为了能够让windows和unix
都兼容).如果想再jobsearch_plus下面进行操作的话,必须加上下面这句
<div class="org-src-container">

<pre class="src src-sql">USE jobsearch_plus;
</pre>
</div>
</li>
<li>在workbench里面一旦你创建了数据库,即便是空的数据库,下面也会有四个选项:
<ul class="org-ul">
<li>Tables
</li>
<li>Views
</li>
<li>Stored Procedures
</li>
<li>Functions
</li>
</ul>
</li>
<li>如今想创建table直接在Tables上右键就可以了.创建完了以后首先是要写上table的
总体setting(mac上需要点一下下拉框)
<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Name</th>
<th scope="col" class="left">Collation</th>
<th scope="col" class="left">Engine</th>
<th scope="col" class="left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">leads</td>
<td class="left">utf8mb4-utf8mb4_unicode_ci</td>
<td class="left">InnoDB</td>
<td class="left">Main job leads table</td>
</tr>
</tbody>
</table>
</li>
<li>设定完table的main setting后,该是设计每个field了,workbench里面每个column的
的设置有如下:
<ul class="org-ul">
<li>Column Name: 用来区分不同column.要求和编程语言里面的变量差不多:不能使用
关键字,使用A-Z,0-9
</li>
<li>Data Type: column的类型,其实就是使用多少内存来存储一个column
</li>
<li>Primary Key: 判断是不是table的主键.设置这个以后自动会设置NN(Not Null)和
UQ(Unqiue)
</li>
<li>Not Null(NN):某个column如果是Not Null的话,那么每次都要给这个column值,否
则插入违法
</li>
<li>Unique Index(UQ):设置某个column是否要求唯一,一旦设置了某个column唯一的话,
数据库也会自动在这个column上面建立索引(indx)
</li>
<li>Is Binary Column(BIN): 用来设置某个column为non-numeric field.因为二进制
文件可能含有有对字符来说是非法字符的内容
</li>
<li>Unsigned Data Type(UN): non-negative number
</li>
<li>Zero Fill(ZF): 对于numeric field来说,如果没有值,设置了这个ZF的话,会自动
填充0
</li>
<li>Auto Increment(AF): 主要用于PK键,会每次自动+1
</li>
<li>Default: 设置某个field的默认值(如果不给值的话,就使用默认值,ZF就是一种默
认值,默认为0)
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

         <!-- Disqus Comment BEGIN -->
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'harrifeng';

              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

         <!-- Disqus Comment END -->
</div>
</body>
</html>
